"use strict";angular.module("everywordApp",["ngCookies","ngResource","ngSanitize","btford.socket-io","ui.router","ui.bootstrap","ncy-angular-breadcrumb","videosharing-embed","angular.validators","infinite-scroll"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(a,b,c,d){b.otherwise("/"),c.html5Mode(!0),d.interceptors.push("authInterceptor")}]).factory("authInterceptor",["$rootScope","$q","$cookieStore","$location",function(a,b,c,d){return{request:function(a){return a.headers=a.headers||{},c.get("token")&&(a.headers.Authorization="Bearer "+c.get("token")),a},responseError:function(a){return 401===a.status?(d.path("/login"),c.remove("token"),b.reject(a)):b.reject(a)}}}]).run(["$rootScope","$location","Auth",function(a,b,c){a.$on("$stateChangeStart",function(a,d){c.isLoggedInAsync(function(c){d.authenticate&&!c&&(a.preventDefault(),b.path("/login"))})})}]),angular.module("everywordApp").controller("LoginCtrl",["$scope","Auth","$location","$window",function(a,b,c,d){a.user={},a.errors={},a.login=function(d){a.submitted=!0,d.$valid&&b.login({email:a.user.email,password:a.user.password}).then(function(){c.path("/main")})["catch"](function(b){a.errors.other=b.message})},a.loginOauth=function(a){d.location.href="/auth/"+a}}]),angular.module("everywordApp").controller("SettingsCtrl",["$scope","User","Auth",function(a,b,c){a.errors={},a.changePassword=function(b){a.submitted=!0,b.$valid&&c.changePassword(a.user.oldPassword,a.user.newPassword).then(function(){a.message="Password successfully changed."})["catch"](function(){b.password.$setValidity("mongoose",!1),a.errors.other="Incorrect password",a.message=""})}}]),angular.module("everywordApp").controller("SignupCtrl",["$scope","Auth","$location","$window",function(a,b,c,d){a.user={},a.errors={},a.register=function(d){a.submitted=!0,d.$valid&&b.createUser({name:a.user.name,email:a.user.email,password:a.user.password}).then(function(){c.path("/")})["catch"](function(b){b=b.data,a.errors={},angular.forEach(b.errors,function(b,c){d[c].$setValidity("mongoose",!1),a.errors[c]=b.message})})},a.loginOauth=function(a){d.location.href="/auth/"+a}}]),angular.module("everywordApp").controller("AdminCtrl",["$scope","$http","Auth","User",function(a,b,c,d){a.users=d.query(),a["delete"]=function(b){d.remove({id:b._id}),angular.forEach(a.users,function(c,d){c===b&&a.users.splice(d,1)})}}]),angular.module("everywordApp").config(["$stateProvider",function(a){a.state("admin",{url:"/admin",templateUrl:"app/admin/admin.html",controller:"AdminCtrl"})}]),angular.module("everywordApp").config(["$stateProvider",function(a){a.state("login",{url:"/login",templateUrl:"app/account/login/login.html",controller:"LoginCtrl",ncyBreadcrumb:{skip:!0}}).state("signup",{url:"/signup",templateUrl:"app/account/signup/signup.html",controller:"SignupCtrl",ncyBreadcrumb:{skip:!0}}).state("settings",{url:"/settings",templateUrl:"app/account/settings/settings.html",controller:"SettingsCtrl",authenticate:!0,ncyBreadcrumb:{skip:!0}}).state("home",{url:"/",templateUrl:"app/home/home.html",controller:"HomeCtrl",ncyBreadcrumb:{label:"Everyword"}}).state("main",{url:"/main",templateUrl:"app/main/main.html",controller:"MainCtrl",ncyBreadcrumb:{label:"Home"}}).state("group",{url:"/group/{groupid}",templateUrl:"app/groups/group_main.html",controller:"GroupMainCtrl",ncyBreadcrumb:{label:"{{groupName}}",parent:"main"}}).state("groups",{url:"/groups",templateUrl:"app/groups/groups.html",controller:"GroupsCtrl",ncyBreadcrumb:{label:"Groups",parent:"main"}}).state("following",{url:"/following",templateUrl:"app/following/following_main.html",controller:"FollowingCtrl",ncyBreadcrumb:{label:"Following",parent:"main"}}).state("testaments",{url:"/testaments",templateUrl:"app/testaments/testaments.html",controller:"TestamentsCtrl",ncyBreadcrumb:{label:"Testaments",parent:"main"}}).state("ot",{url:"/books/ot",templateUrl:"app/reading/books/books.html",controller:"BooksCtrl",ncyBreadcrumb:{label:"{{testament | uppercase}}",parent:"testaments"},resolve:{testament:function(){return"ot"}}}).state("nt",{url:"/books/nt",templateUrl:"app/reading/books/books.html",controller:"BooksCtrl",ncyBreadcrumb:{label:"{{testament | uppercase}}",parent:"testaments"},resolve:{testament:function(){return"nt"}}}).state("chapter",{url:"/chapters/{testament}/{book}",templateUrl:"app/reading/chapter/chapter.html",controller:"ChapterCtrl",ncyBreadcrumb:{label:"{{book}}",parent:function(a){return a.testament}}}).state("scripture",{url:"/scripture/{testament}/{book}/{chapter}",templateUrl:"app/reading/scripture/scripture.html",controller:"ScriptureCtrl",ncyBreadcrumb:{label:"{{chapter}}",parent:"chapter"}}).state("verse",{url:"/scripture/{testament}/{book}/{chapter}/{verse}",templateUrl:"app/reading/scripture/scripture.html",controller:"ScriptureCtrl",ncyBreadcrumb:{label:"{{chapter}}",parent:"chapter"}})}]),angular.module("everywordApp").controller("FollowingCtrl",["$scope","$http","$location","socket","Auth","User","$uibModal",function(a,b,c,d,e,f,g){if(!e.isLoggedIn())return void c.path("/login");a.model={following:[]};var h=a.model;a.currentUser=e.getCurrentUser(),a.users=[],f.query(function(b){for(var c=0;c<b.length;c++)b[c]._id!==a.currentUser._id&&a.users.push(b[c])}),b.get("/api/homebases/"+a.currentUser._id+"/following?all=true").success(function(a){console.log("response"+a);for(var b in a){var c=a[b];h.following.push(c)}}),a.editFollowing=function(){var c=g.open({animation:!0,templateUrl:"app/following/following.html",controller:"FollowingModalCtrl",resolve:{following:function(){return a.model.following||[]},users:function(){return a.users}}});c.result.then(function(c){var d=[];for(var e in c)d.push(c[e]._id);b.put("/api/homebases/"+a.currentUser._id,{following:d}).success(function(a){console.log("Successfully updated Homebase "+a._id),h.following=c})},function(){console.info("Modal dismissed at: "+new Date)})},a.unfollow=function(c){var d=h.following.map(function(a){return a._id});if(-1!==h.following.indexOf(c)){var e=d.indexOf(c._id);h.following.splice(e,1)}d=h.following.map(function(a){return a._id}),b.put("/api/homebases/"+a.currentUser._id,{following:d}).success(function(a){console.log("Successfully updated Homebase "+a._id)})}}]).controller("FollowingModalCtrl",["$scope","$uibModalInstance","following","users",function(a,b,c,d){a.following=[].concat(c);var e=function(a){return a._id};a.users=d,a.selected={follow:""},a.isFollowing=function(b){return-1!==a.following.map(e).indexOf(b._id)},a.follow=function(b){a.following.push(b)},a.unfollow=function(b){var c=a.following.map(e).indexOf(b._id);c>-1&&a.following.splice(c,1)},a.ok=function(){b.close(a.following)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("everywordApp").controller("GroupMainCtrl",["$scope","$http","$location","$stateParams","$sce","socket","BibleService","Auth","User","$uibModal","ProgressBar",function(a,b,c,d,e,f,g,h,i,j,k){function l(c){for(var d,e=/(?:^|\s)(?:#)([a-zA-Z\d]+)/gm,f=[];d=e.exec(c);)f.push("#"+d[1]);for(var g=0;g<f.length;g++){var h=f[g];b.post("/api/tags",{user:a.currentUser._id,tag:h,date:new Date}).success(function(a){console.log("tag added")})}}a.groupId=d.groupid,a.members=[],a.requests=[],a.invited=[],a.verses=[],a.feed=[],a.users=[],a.syncUserIds=[],a.visibleFeed=[],a.newMessage="",a.selectedUser="";var m=function(b,c,d){var e={_id:c._id,user:c.user,date:c.date,comment:c};if("deleted"===b){var f=d.indexOf(e);d.splice(f,1)}else{var f=d.indexOf(c);d.splice(f,1,e)}a.loadMore()},n=function(b,c,d){var e={_id:c._id,user:c.user,date:c.date,media:c};if("deleted"===b){var f=d.indexOf(e);d.splice(f,1)}else{var f=d.indexOf(c);d.splice(f,1,e)}a.loadMore()},o=function(b,c,d){var e={_id:c._id,user:c.user,date:c.date,reference:c};if("deleted"===b){var f=d.indexOf(e);d.splice(f,1)}else{var f=d.indexOf(c);d.splice(f,1,e)}a.loadMore()},p=function(){a.group=null,b.get("/api/groups/"+a.groupId).success(function(b){a.group=b,a.group.creator=b.creator,a.group.groupName=b.name;var c=b.memberIds;if(c)for(var d in c){var e=c[d];f.syncUpdates("comment"+e,a.feed,m),f.syncUpdates("media"+e,a.feed,n),f.syncUpdates("references"+e,a.feed,o),a.syncUserIds.push(e)}a.feed=[],a.visibleFeed=[],a.verses=[];var g=b.feed;a.currentUser=h.getCurrentUser();var i=0,j=function(b){a.getScripture(b[i]._id).success(function(c){var d=b[i];d.postedBy=d.user.name,d.likes=d.comment?d.comment.likes||0:0,c?d.anno=c:d.anno=void 0,a.isViewable(d)&&(a.feed.push(d),10>=i&&a.visibleFeed.push(d),d.anno&&a.verses.push(d.anno)),i++,i<b.length?j(b):(a.verses=a.groupVerses(),a.loading=!1,console.log("done loading"))}).error(function(a){})};j(g)}),b.get("/api/groups/"+a.groupId+"/members").success(function(b){angular.forEach(b,function(a,b){this.push(a)},a.members)}),b.get("/api/groups/"+a.groupId+"/requests").success(function(b){angular.forEach(b,function(a,b){this.push(a)},a.requests)}),b.get("/api/groups/"+a.groupId+"/invited").success(function(b){angular.forEach(b,function(a,b){this.push(a)},a.invited)})};p(),a.isViewable=function(b){return b.comment?!b.comment.isPrivate||b.comment.group===a.groupId:!0},a.trustSrc=function(a){return e.trustAsResourceUrl(a)},a.loadMore=function(b){if(b)a.visibleFeed=[].concat(a.feed.slice(0,10));else{var c=a.visibleFeed,d=c[c.length-1],e=a.feed.indexOf(d)+1,f=a.feed.slice(e,e+10);for(var g in f)a.visibleFeed.push(f[g])}},a.addMessage=function(){var c=a.currentUser;l(a.newMessage),c&&b.post("/api/comments",{user:c._id,text:a.newMessage,date:new Date,isPrivate:!0,group:a.groupId}).success(function(b){var c={_id:b._id,user:b.user,date:b.date,comment:b,isPrivate:!0,group:a.groupId};a.feed.push(c),a.loadMore()}),console.log("Save "+a.newMessage),a.newMessage=""},a.getScripture=function(a){return b.get("/api/annotations/0/find?annoEntryId="+a)},a.gotoAnnotation=function(a){b.get("/api/annotations/0/find?annoEntryId="+a).success(function(a){if(a){var b="/scripture/"+a.testament+"/"+a.book+"/"+a.chapter;c.path(b)}})},a.showScripture=function(a,b){var c="#reference"+a,d=b.book+" "+b.chapter+":"+b.verse;$(c).tooltip({title:d,placement:"bottom"}),$(c).tooltip("show")};a.groupVerses=function(){var b={};for(var c in a.verses){var d=a.verses[c],e=d.book+" "+d.chapter+":"+d.verse;e in b||(b[e]=d)}return b},a.clearUserFilter=function(){a.selectedUser=""},a.filterByUser=function(b){a.selectedUser=b},a.acceptUser=function(c){b.post("/api/messages/findMessage",{to:a.currentUser._id,from:c._id,subject:"Request to join Group"}).success(function(b){b&&a.acceptRequest(b)})},a.acceptRequest=function(a){var c=a.action,d=c.url,e=c.requestBody,f={method:c.requestType,url:d};e&&(f.data=e),b(f).then(function(){a.action.completed=!0,b.put("/api/messages/"+a._id,a).success(function(a){p()})})},a.removeMember=function(c){b.put("/api/groups/"+a.groupId+"/members/delete",{members:[c._id]}).success(function(b){a.members=b.members,p()})},a.updateComment=function(b,c){var d=a.feed.map(function(a){return a._id}).indexOf(b._id),e=a.feed[d];e.comment=c,a.loadMore(!0)},a.removeComment=function(b){var c=a.feed.map(function(a){return a._id}).indexOf(b._id);a.feed.splice(c,1),a.loadMore(!0)}}]),angular.module("everywordApp").controller("GroupsCtrl",["$scope","$http","$location","socket","Auth","User","$uibModal",function(a,b,c,d,e,f,g){if(!e.isLoggedIn())return void c.path("/login");a.model={showForm:!1,groups:[],pending:[],invitedMembers:[],invitedEmails:[],invitees:[],groupMembers:[]},a.groupName=null,a.groupDescription=null;var h=a.model;a.currentUser=e.getCurrentUser(),a.model.groupMembers=[a.currentUser.name],a.users=[],f.query(function(b){for(var c=0;c<b.length;c++)b[c]._id!==a.currentUser._id&&a.users.push(b[c])}),d.syncUpdates("group"+a.currentUser._id,h.groups,function(c,d,e){if("deleted"===c){var f=h.groups.map(function(a){return a._id});b.put("/api/homebases/"+a.homebase._id,{groups:f}).success(function(a){console.log("Successfully updated Homebase "+a._id)})}}),b.get("/api/homebases/"+a.currentUser._id+"/groups?all=true").success(function(b){console.log("response"+b),a.homebase=b;for(var c in b.groups){var d=b.groups[c];h.groups.push(d)}}),a.toggleForm=function(b){return b?(h.editGroup=b,h.showForm=!0,a.groupName=b.name,void(a.groupDescription=b.info)):(a.groupName=null,a.groupDescription=null,h.editGroup=null,h.showForm=!1,void(h.showForm=!h.showForm))},a.showGroups=function(){var c=g.open({animation:!0,templateUrl:"app/groups/join_group.html",controller:"JoinGroupCtrl",resolve:{currentUser:function(){return a.currentUser},mygroups:function(){return h.groups},groups:function(){return b.get("/api/groups").success(function(a){return a})}}});c.result.then(function(c){var d=c.remove,e=c.selected,f=c.mygroups;if(0!==d.length){for(var g in d){var i=d[g],j=h.groups.indexOf(i);j>-1&&h.groups.splice(j,1);for(var k in i.members)i.members[k]._id===a.currentUser._id&&i.members.splice(k,1);b.put("/api/groups/"+i._id+"/members",{members:i.members}).success(function(a){console.log("Successfully updated group "+a._id)})}var l=f.map(function(a){return a._id});b.put("/api/homebases/"+a.homebase._id,{groups:l}).success(function(a){console.log("Successfully updated Homebase "+a._id)})}for(var m in e){var i=e[m];b.post("/api/messages",{to:i.creator,from:a.currentUser._id,subject:"Request to join Group",body:a.currentUser.name+" has requested to join your group <strong>"+i.name+"</strong>",hasAction:!0,action:{requestType:"PUT",url:"/api/groups/"+i._id+"/members",requestBody:{members:[a.currentUser._id]}}}).success(function(c){b.put("/api/groups/"+i._id,{requests:[a.currentUser._id]}).success(function(a){console.log("Successfully updated group "+a._id)})})}},function(){console.info("Modal dismissed at: "+new Date)})},a.addGroup=function(d,e){var f=$("#sendEmail").is(":checked");b.post("/api/groups",{name:d,creator:a.currentUser._id,info:e,invited:h.invitedMembers,active:!0}).success(function(d){h.groupId=d._id,h.showForm=!1;for(var e in h.invitedMembers){var g=h.invitedMembers[e];f===!0&&h.invitedEmails.push(g.email),b.post("/api/messages",{to:g._id,from:a.currentUser._id,subject:"Group Invite",body:a.currentUser.name+" has invited you to join their group: <strong>"+d.name+"</strong>. With message:<br/>"+h.inviteMessage,hasAction:!0,action:{requestType:"PUT",url:"/api/groups/"+d._id+"/members",requestBody:{members:[g._id]}}})}h.invitedMembers=[];for(var i in h.invitedEmails){var j=h.invitedEmails[i];b.post("/api/messages/sendEmail",{to:j,from:a.currentUser,subject:"Everyword Invite",group:d.name,message:h.inviteMessage,url:c.host(),link:c.absUrl()})}h.invitedEmails=[]})},a.deleteGroup=function(a){b["delete"]("/api/groups/"+a._id)},a.editMembers=function(c){h.editGroup=c;var d=g.open({animation:!0,templateUrl:"app/groups/group_members.html",controller:"MembersCtrl",resolve:{members:function(){return b.get("/api/groups/"+c._id+"/members").success(function(a){return a})},invited:function(){return b.get("/api/groups/"+c._id+"/invited").success(function(a){return a})},requests:function(){return b.get("/api/groups/"+c._id+"/requests").success(function(a){return a})},users:function(){return a.users}}});d.result.then(function(d){var e=(d.current,d.invited),f=d.remove;for(var g in e){var i=e[g];b.post("/api/messages",{to:i._id,from:a.currentUser._id,subject:"Group Invite",body:a.currentUser.name+" has invited you to join their group: <strong>"+h.editGroup.name+"</strong>",hasAction:!0,action:{requestType:"PUT",url:"/api/groups/"+h.editGroup._id+"/members",requestBody:{members:[i._id]}}}).success(function(a){b.put("/api/groups/"+c._id,{invited:[i._id]}).success(function(a){console.log("Successfully updated group "+a._id)})})}if(f.length>0){var j=f.map(function(a){return a._id});b.put("/api/groups/"+h.editGroup._id+"/members/delete",{members:j}).success(function(a){h.groupMembers=a.members})}},function(){console.info("Modal dismissed at: "+new Date)})},a.inviteMembers=function(b){var c=g.open({animation:!0,templateUrl:b?"app/groups/invite_emails.html":"app/groups/invite_members.html",controller:"InviteMembersCtrl",resolve:{currentUser:function(){return a.currentUser},users:function(){return a.users}}});c.result.then(function(a){h.inviteMessage=a.message;for(var b in a.selected)h.invitedMembers.push(a.selected[b]);h.invitedEmails=[].concat(a.emails)},function(){console.info("Modal dismissed at: "+new Date)})}}]).controller("JoinGroupCtrl",["$scope","$uibModalInstance","currentUser","mygroups","groups",function(a,b,c,d,e){a.currentUser=c,a.pending=e.data.filter(function(a){return-1!==a.requests.indexOf(c._id)}),a.mygroups=d.concat(a.pending);var f=a.mygroups.map(function(a){return a._id});a.groups=e.data.filter(function(a){return-1===f.indexOf(a._id)}),a.selected=[],a.remove=[],a.joinGroup=function(b){a.selected.push(b)},a.leaveGroup=function(b){var c=a.mygroups.indexOf(b);c>-1&&a.mygroups.splice(c,1),a.remove.push(b)},a.myGroup=function(b){return b.creator===a.currentUser._id},a.ok=function(){b.close({mygroups:a.mygroups,selected:a.selected,remove:a.remove})},a.cancel=function(){b.dismiss("cancel")}}]).controller("MembersCtrl",["$scope","$uibModalInstance","members","invited","requests","users",function(a,b,c,d,e,f){var g=c.data;a.invited=d.data,a.requests=e.data,a.members=g,a.emails=[];var h=[];a.invitees=[];var i=function(a){return a._id};a.removeMember=function(b){var c=a.members.map(i).indexOf(b._id);c>-1&&a.members.splice(c,1),h.push(b)},a.inviteMember=function(b){a.invitees.push(b);var c=a.users.map(i).indexOf(b._id);c>-1&&a.users.splice(c,1)},a.isPending=function(b){return-1!==a.invited.map(i).indexOf(b._id)||-1!==a.requests.map(i).indexOf(b._id)||-1!==a.invitees.map(i).indexOf(b._id)},a.isMember=function(b){return-1!==a.members.map(i).indexOf(b._id)},a.users=f.filter(function(b){return!a.isPending(b)}),a.ok=function(){b.close({current:a.members,invited:a.invitees,remove:h})},a.cancel=function(){b.dismiss("cancel")}}]).controller("InviteMembersCtrl",["$scope","$uibModalInstance","currentUser","users",function(a,b,c,d){a.users=d.filter(function(a){return"admin"!==a.role}),a.selected=[],a.emails=[],a.addEmail=function(b){a.emails.push(b),a.inviteEmail=""},a.selectUser=function(b){a.selected.push(b)},a.unselectUser=function(b){var c=a.selected.indexOf(b);c>-1&&a.selected.splice(c,1)},a.ok=function(){b.close({message:a.message,selected:a.selected,emails:a.emails})},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("everywordApp").controller("HomeCtrl",["$scope","$location","User",function(a,b,c){a.usersCount=0,c.query(function(b){a.usersCount=b.length}),a.gotoLogin=function(){console.log("image clicked!"),b.path("/login")}}]),angular.module("everywordApp").controller("MainCtrl",["$scope","$http","$location","$state","socket","BibleService","Auth","User","$uibModal","ProgressBar",function(a,b,c,d,e,f,g,h,i,j){a.loading=!0,a.homebase=null,a.feed=[],a.users=[],a.syncUserIds=[],a.visibleFeed=[],a.selectedTag="",a.selectedUser="",a.groups=[];var k=function(){var b=a.syncUserIds;for(var c in b)e.unsyncUpdates("comment"+b[c]),e.unsyncUpdates("media"+b[c]),e.unsyncUpdates("reference"+b[c])},l=function(b,c,d){var e={_id:c._id,user:c.user,date:c.date,comment:c};if("deleted"===b){var f=d.indexOf(e);d.splice(f,1)}else{var f=d.indexOf(c);d.splice(f,1,e)}a.loadMore(!0)},m=function(b,c,d){var e={_id:c._id,user:c.user,date:c.date,media:c};if("deleted"===b){var f=d.indexOf(e);d.splice(f,1)}else{var f=d.indexOf(c);d.splice(f,1,e)}a.loadMore(!0)},n=function(b,c,d){var e={_id:c._id,user:c.user,date:c.date,reference:c};if("deleted"===b){var f=d.indexOf(e);d.splice(f,1)}else{var f=d.indexOf(c);d.splice(f,1,e)}a.loadMore(!0)},o=function(){k(),a.syncUserIds=[],a.feed=[],a.currentUser=g.getCurrentUser(),b.get("/api/homebases/"+a.currentUser._id).success(function(c){console.log("response"+c),a.homebase=c.homebase;var d=c.userIds;if(d)for(var f in d){var g=d[f];e.syncUpdates("comment"+g,a.feed,l),e.syncUpdates("media"+g,a.feed,m),e.syncUpdates("references"+g,a.feed,n),a.syncUserIds.push(g)}b.get("/api/homebases/"+a.currentUser._id+"/groups").success(function(b){a.homebase.groups=b.groups}),b.get("/api/homebases/"+a.currentUser._id+"/following").success(function(b){a.homebase.following=b}),b.get("/api/homebases/"+a.currentUser._id+"/tags").success(function(b){a.homebase.tags=b}),b.get("/api/homebases/"+a.currentUser._id+"/feed").success(function(b){var c=0;if(b){b.sort(function(a,b){var c=a.date?Date.parse(a.date):Date.now(),d=b.date?Date.parse(b.date):Date.now();return d-c});var d=function(b){a.getScripture(b[c]._id).success(function(e){var f=b[c];f.postedBy=f.user.name,f.likes=f.comment?f.comment.likes||0:0,f.comment&&(f.group=f.comment.group,f.isPrivate=f.comment.isPrivate),e&&(f.anno=e),a.isViewable(f)&&a.visibleFeed.push(f),c++,c<b.length?d(b):a.loading=!1}).error(function(a){})};b&&b.length>0&&d(b)}})})};a.loadMore=function(c){if(!a.loading){a.loading=!0;var d=a.visibleFeed,e=d[d.length-1],f=c?new Date:e.date,g=c?"":"?after="+f.toString();b.get("/api/homebases/"+a.currentUser._id+"/feed"+g).success(function(b){c&&(a.visibleFeed=[]);var d=0;if(b){b.sort(function(a,b){var c=a.date?Date.parse(a.date):Date.now(),d=b.date?Date.parse(b.date):Date.now();return d-c});var e=function(b){a.getScripture(b[d]._id).success(function(c){var f=b[d];f.postedBy=f.user.name,f.likes=f.comment?f.comment.likes||0:0,f.comment&&(f.group=f.comment.group,f.isPrivate=f.comment.isPrivate),c&&(f.anno=c),a.isViewable(f)&&a.visibleFeed.push(f),d++,d<b.length?e(b):a.loading=!1}).error(function(a){})};b&&b.length>0&&e(b)}})}},a.gotoAnnotation=function(a){b.get("/api/annotations/0/find?annoEntryId="+a).success(function(a){if(a){var b="/scripture/"+a.testament+"/"+a.book+"/"+a.chapter+"/"+a.verse;c.path(b)}})},a.getScripture=function(a){return b.get("/api/annotations/0/find?annoEntryId="+a)},a.showScripture=function(a,b){if(b){var c=b.book+" "+b.chapter+":"+b.verse,d="#reference"+a;$(d).tooltip({title:c,placement:"right"}),$(d).tooltip("show")}},a.showGroup=function(a,b){if(b){var c=b.name,d="#groupLink"+a;$(d).tooltip({title:c,placement:"right"}),$(d).tooltip("show")}},a.isViewable=function(b){return b&&b.isPrivate?b.isPrivate&&(b.user._id===a.homebase.login||b.group&&-1!==a.groups.indexOf(b.group._id)):!0},setTimeout(function(){g.isLoggedInAsync(function(b){b?(o(),h.query(function(b){for(var c=0;c<b.length;c++)b[c]._id!==a.currentUser._id&&a.users.push(b[c])})):c.path("/login")})},10),a.showTags=function(){var c=i.open({animation:!0,templateUrl:"app/tags/tags.html",controller:"TagsCtrl",size:"sm",resolve:{tags:function(){return b.get("/api/tags").success(function(a){return a})},mytags:function(){return a.homebase.tags}}});c.result.then(function(c){a.homebase.tags=c;var d=a.homebase.tags.map(function(a){return a._id});b.put("/api/homebases/"+a.currentUser._id,{tags:d}).success(function(a){console.log("Successfully updated Homebase "+a._id)}).error(function(a){console.log(a)})},function(){console.info("Modal dismissed at: "+new Date)})},a.deleteThing=function(a){b["delete"]("/api/things/"+a._id)},a.beginReading=function(){b.get("/api/biblesvc").success(function(a){console.log("KJV: "+angular.toJson(a))})},a.unfollow=function(c){var d=a.homebase.following.map(function(a){return a._id});if(-1!==a.homebase.following.indexOf(c)){var e=d.indexOf(c._id);a.homebase.following.splice(e,1)}d=a.homebase.following.map(function(a){return a._id}),b.put("/api/homebases/"+a.currentUser._id,{following:d}).success(function(b){console.log("Successfully updated Homebase "+b._id),a.loadMore(!0)})},a.clearUserFilter=function(){a.selectedUser=""},a.filterByUser=function(b){a.selectedUser=b},a.$on("$destroy",k),a.reload=function(){a.loadMore(!0)}}]).directive("tagLinks",["$compile",function(a){var b=function(a){for(var b="",c=0;c<a.length;c++){var d="<a href=\"#\" ng-class=\"{'active': selectedTag ==='"+a[c].tag+'\'}" ng-click="selectTag('+c+')">'+a[c].tag+"</a>\n";b+=d}return b};return{restict:"E",scope:{tags:"=",selectedTag:"="},link:function(c,d,e){c.selectTag=function(a){var b=c.tags[a];c.selectedTag=b.tag},c.$watch("tags",function(e){var f=e||[];d.html(b(f)).show(),a(d.contents())(c)})}}}]),angular.module("everywordApp").controller("MessagesCtrl",["$scope","$http","$location","socket","Auth",function(a,b,c,d,e){a.currentUser=e.getCurrentUser(),a.homebase=null,a.actionComplete=!1,b.get("/api/homebases/"+a.currentUser._id+"/messages").success(function(b){a.homebase=b,a.messages=b.messages}),a.currentMessage=null,a.setCurrentMessage=function(b){a.currentMessage=b,b.hasAction&&(a.actionComplete=b.action.completed)},a.performAction=function(c,d){var e=c.url,f=c.requestBody;d&&(f.rejected=!0);var g={method:c.requestType,url:e};f&&(g.data=f),b(g).then(function(){d?b["delete"]("/api/messages/"+a.currentMessage._id).success(function(b){var c=a.messages.indexOf(a.currentMessage);a.messages.splice(c,1)}):(a.currentMessage.action.completed=!0,b.put("/api/messages/"+a.currentMessage._id,a.currentMessage).success(function(b){a.actionComplete=!0}))})}}]).filter("unsafe",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),angular.module("everywordApp").config(["$stateProvider",function(a){a.state("messages",{url:"/messages",templateUrl:"app/messages/messages.html",controller:"MessagesCtrl",ncyBreadcrumb:{label:"Messages",parent:"main"}})}]),angular.module("everywordApp").controller("BooksCtrl",["$scope","$state","testament","BibleService",function(a,b,c,d){a.testament=c,a.testamentTitle=d.getTestament(a.testament),a.books=[],a.errors={},d.getBooks(a.testament).then(function(b){a.books=b})["catch"](function(b){a.errors.other=b.message})}]),angular.module("everywordApp").controller("ChapterCtrl",["$scope","$stateParams","BibleService",function(a,b,c){a.testament=b.testament,a.book=b.book,a.chapters=[],c.getChapters(a.testament,a.book).then(function(b){a.chapters=b})["catch"](function(b){a.errors.other=b.message})}]),angular.module("everywordApp").directive("ewCommentForm",function(){return{templateUrl:"app/reading/scripture/comments/comment-form.html",restrict:"EA",scope:{showGroupMenu:"&",newComment:"=",addComment:"&"},controller:["$scope",function(a){a.model={groupOnly:!1,privateComment:!1,showGroups:!1},a.groupFootnote="Select Group";var b=a.model;a.add=function(){a.addComment()(b.privateComment)},a.toggleVisibility=function(c,d){d?a.showGroupMenu()(function(c){b.groupOnly=null!==c,b.privateComment=null!==c,a.groupFootnote=c?c.name:"Select Group"}):a.groupFootnote="Select Group",b.privateComment=c,b.groupOnly=d}}]}}),angular.module("everywordApp").directive("ewComment",function(){return{scope:{comment:"=",user:"=",updateCallback:"&",deleteCallback:"&"},controller:["$scope","$http",function(a,b){a.fIds=[],a.remarkForm={content:null,isShowing:!1},a.isEditing=!1,a.editComment={isPrivate:a.comment.isPrivate,text:a.comment.text},a.toggleRemarkForm=function(){a.remarkForm.isShowing=!a.remarkForm.isShowing};var c=a.remarkForm;a.addRemark=function(){a.add()(c.content,a.comment),a.remarkForm.isShowing=!1},a.toggleEditComment=function(){a.isEditing=!a.isEditing},a.cancelEditComment=function(){a.isEditing=!1,a.editComment.text=a.comment.text},a.updateComment=function(){a.edit()(a.comment,a.editComment),a.isEditing=!1},a.deleteComment=function(){a["delete"]()(a.comment)},a.isFollowing=function(b){return-1!==a.fIds.indexOf(b._id)},a.follow=function(c){var d=a.fIds;d.push(c._id),b.put("/api/homebases/"+a.user._id,{following:d}).success(function(a){console.log("Successfully updated Homebase "+a._id)})},a.like=function(){var c=a.comment.likes?a.comment.likes+1:1;b.put("/api/comments/"+a.comment._id,{likes:c}).success(function(b){a.comment=b,console.log("Successfully updated comments "+b._id)})},a.addRemark=function(c,d){console.log("Send "+c),a.user&&b.post("/api/messages",{to:d.user._id,from:a.user._id,subject:"Comment Remark",body:'I made following remark on your comment "<em>'+d.text+'</em>":<br/><strong>'+c+"</strong><br/>Do you accept?",hasAction:!0,action:{requestType:"POST",url:"/api/remarks/",requestBody:{user:user._id,remark:c,comment:d._id}}})},a.deleteComment=function(c){b["delete"]("/api/comments/"+c._id).success(function(b){a.deleteCallback()(c)})},a.updateComment=function(c){console.log(c+" updated");var d=a.editComment;a.user&&b.put("/api/comments/"+c._id,{user:a.user._id,text:d.text,date:new Date,isPrivate:d.isPrivate}).success(function(b){a.updateCallback()(c,b),a.isEditing=!1})}}],templateUrl:"app/reading/scripture/comments/comments.html",restrict:"EA",link:function(a,b,c){a.includeHeading="undefined"!=typeof c.withHeading}}}),angular.module("everywordApp").directive("ewMedia",function(){return{templateUrl:"app/reading/scripture/media/media.html",restrict:"EA",scope:{media:"=",save:"&"},controller:["$scope","$document","$sce","$uibModal",function(a,b,c,d){var e=b[0];a.inputUrl=null,a.validUrl=!0,a.description="",a.showMenu=!1,a.toggleMenu=function(){var a=$("#action")[0],b=$("#action").parent();b.hasClass("open")?(b.trigger($.Event("hide.bs.dropdown",{relatedTarget:a})),b.removeClass("open").trigger("hidden.bs.dropdown",a)):(b.trigger($.Event("show.bs.dropdown",{relatedTarget:a})),b.addClass("open").trigger("shown.bs.dropdown",a))},a.showCommentDialog=function(b){var c=d.open({animation:!0,templateUrl:"commentTemplate.html",controller:"MediaCommentCtrl",size:"sm"});c.result.then(function(c){a.description=c,b()},function(){console.info("Modal dismissed at: "+new Date)})},a.handleUrlDrop=function(b){b.stopPropagation(),b.preventDefault();var c=b.dataTransfer.getData("text/uri-list"),d=b.dataTransfer.files;a.showCommentDialog(function(){if(d&&d.length>0)return void h(d);var e=c&&c.length>0?c:null,f=e||b.target.medialUrl||a.mediaUrl;if(a.validUrl=a.validateUrl(f),a.validUrl){var g={url:f,type:"video",description:a.description};a.save()(g)}})},a.addUrl=function(){a.showCommentDialog(function(){if(a.validUrl=a.validateUrl(a.inputUrl),a.validUrl){a.inputUrl=a.inputUrl.replace("watch","embed");var b=(c.trustAsResourceUrl(a.inputUrl),{url:a.inputUrl,description:a.description,type:"video"});a.save()(b),a.inputUrl=""}})},a.validateUrl=function(a){if(void 0!=a||""!=a){var b=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=|\?v=)([^#\&\?]*).*/,c=a.match(b);return c&&11==c[2].length?!0:!1}};var f=function(a){a.stopPropagation(),a.preventDefault(),a.dataTransfer.dropEffect="copy"};a.handlePaste=function(){console.log("Url pasted "+a.mediaUrl)};var g=function(b){var c=b.target.files;a.showCommentDialog(function(){h(c)})},h=function(b){for(var c,d=0;c=b[d];d++)if(c.type.match("image.*")){var e=new FileReader;e.onload=function(b){return function(c){var d={data:b,type:b.type,url:c.target.result,name:b.name,description:a.description};a.save()(d)}}(c),e.readAsDataURL(c)}},i=e.getElementById("drop_zone");i.addEventListener("dragover",f,!1),i.addEventListener("drop",a.handleUrlDrop,!1),e.getElementById("files").addEventListener("change",g,!1)}]}}).controller("MediaCommentCtrl",["$scope","$uibModalInstance",function(a,b){a.description="",a.ok=function(){b.close(a.description)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("everywordApp").controller("ScriptureCtrl",["$scope","$http","$q","$stateParams","$window","$location","$anchorScroll","$parse","socket","Auth","ProgressBar",function(a,b,c,d,e,f,g,h,i,j,k){function l(c){for(var d,e=/(?:^|\s)(?:#)([a-zA-Z\d]+)/gm,f=[];d=e.exec(c);)f.push("#"+d[1]);for(var g=0;g<f.length;g++){var h=f[g];b.post("/api/tags",{user:a.currentUser._id,tag:h,date:new Date}).success(function(a){console.log("tag added")})}}k.show(),a.loading=!0,a.model={comments:[],newComment:"",verseSelected:null,privateComment:!1,references:[],referenceLink:"",referenceDescription:"",media:[],groupOnly:!1,selectedGroup:null};var m=a.model;a.openAnnotation=!1,a.currentUser=j.getCurrentUser(),a.testament=d.testament,a.book=d.book,a.chapter=d.chapter,d.verse&&(a.highlightedVerse=parseInt(d.verse)),a.currentVersion="kjv",a.tabs=[{title:"Footnotes",image:"../../../assets/images/9e0b5b1c.blue_footnote.png",content:"app/reading/scripture/partials/footnotes.html",
gotData:!1,action:function(b){return a.showFootnotes(b)}},{title:"Comments",image:"../../../assets/images/f8b8b244.blue_comments.png",content:"app/reading/scripture/partials/comment.html",active:!0,gotData:!1,action:function(b){return a.showComments(b)}},{title:"References",image:"../../../assets/images/0916789b.blue_references.png",content:"app/reading/scripture/partials/references.html",gotData:!1,action:function(b){return a.showReferences(b)}},{title:"Media",image:"../../../assets/images/967a360a.blue_videos.png",content:"app/reading/scripture/partials/media.html",gotData:!1,action:function(b){return a.showMedia(b)}}],b.get("/api/homebases/"+a.currentUser._id).success(function(c){console.log("response"+c),a.homebase=c.homebase,b.get("/api/homebases/"+a.currentUser._id+"/following").success(function(b){a.homebase.following=b})});var n=(angular.element(e.document).find("div.verses"),function(b){a.verses=[],a.prevChapter=b.prev,a.nextChapter=b.next;var c=0,d=function(b){a.annotationCounts(b[c].verse).success(function(e){console.log("Loading..."),e?(console.log("verse: "+b[c].verse+" count: "+e.count),b[c].annoCount=e.count):b[c].annoCount=0,a.verses.push(b[c]),c++,c<b.length?d(b):(a.loading=!1,k.hide(),console.log("done loading"))}).error(function(a){k.hide()})};d(b.verses)});b.get("/api/biblesvc/"+a.book+"/"+a.chapter).success(function(a){n(a)}).error(function(a){setTimeout(function(){k.hide()},1e3)}),a.tabChanged=function(){var b=a.active();b.action(b.gotData)},a.active=function(){return a.tabs.filter(function(a){return a.active})[0]},a.annotationCounts=function(c){return b.get("/api/annotations/"+a.book+"/"+a.chapter+"/"+c+"/count/"+a.currentUser._id)},a.getChapter=function(c){k.show(),a.loading=!0,b.get("/api/biblesvc/"+a.currentVersion+"/"+c.book+"/"+c.chapter).success(function(b){a.book=c.book,a.chapter=c.chapter,n(b)})},a.getVersion=function(c){k.show(),a.loading=!0,a.currentVersion=c,m.verseSelected=null,"NET"!==c?b.get("/api/biblesvc/"+c+"/"+a.book+"/"+a.chapter).success(function(a){n(a)}):(a.showData=function(b){console.log(JSON.stringify(b)),a.verses=b},b.jsonp("http://labs.bible.org/api/?passage="+a.book+"+"+a.chapter+"&type=json&callback=myCallback"))},a.scrollToVerse=function(b){a.highlightedVerse=null;var c="#verse"+b.verse;$("html, body").animate({scrollTop:$(c).offset().top-100},200)},a.showAnnotations=function(b,c){if(m.newComment="",m.verseSelected===b){m.verseSelected=null,a.openAnnotation=!1;for(var d in a.tabs)a.tabs[d].gotData=!1}else{m.verseSelected=b,a.openAnnotation=!0;var d=a.active();d&&d.action(!1);for(var d in a.tabs)a.tabs[d].gotData=!1}},a.showFootnotes=function(c){c||(m.footnotes=[],b.post("/api/annotations/"+a.book+"/"+a.chapter+"/"+m.verseSelected.verse+"/footnotes",{version:a.currentVersion,testament:a.testament}).success(function(b){m.verseSelected.annotationId=b._id||void 0;var c=a.active();c&&(c.gotData=!0),m.footnotes=[].concat(b.footnotes)}))},a.isViewable=function(b){return b.isPrivate?b.isPrivate&&b.user._id===a.currentUser._id:!0},a.showComments=function(c){c||(m.comments=[],b.get("/api/annotations/"+a.book+"/"+a.chapter+"/"+m.verseSelected.verse+"/comments").success(function(b){if(b.comments)for(var c in b.comments){var d=b.comments[c];d.isPrivate&&d.user._id!==a.currentUser._id||m.comments.push(d)}m.verseSelected.annotationId=b._id||void 0;var e=a.active();e&&(e.gotData=!0)}))},a.showReferences=function(c){c||(m.references=[],m.referenceLink="",m.referenceDescription="",b.get("/api/annotations/"+a.book+"/"+a.chapter+"/"+m.verseSelected.verse+"/references").success(function(b){if(b.references)for(var c in b.references){var d=b.references[c];m.references.push(d)}m.verseSelected.annotationId=b._id||void 0;var e=a.active();e&&(e.gotData=!0)}))},a.showMedia=function(c){c||(m.media=[],b.get("/api/annotations/"+a.book+"/"+a.chapter+"/"+m.verseSelected.verse+"/media").success(function(b){if(b.media)for(var c in b.media){var d=b.media[c];d.image&&(d.url=d.image.url),m.media.push(d)}m.verseSelected.annotationId=b._id||void 0;var e=a.active();e&&(e.gotData=!0)}))};var o=function(b){a.annotationCounts(b.verse).success(function(a){b.annoCount=a.count})};a.addComment=function(c){console.log(m.newComment+" added");var d=a.currentUser;l(m.newComment),d&&b.post("/api/comments",{user:d._id,text:m.newComment,date:new Date,isPrivate:c,group:m.selectedGroup}).success(function(c){m.comments.push(c);var d=m.comments.map(function(a){return a._id});m.verseSelected.annotationId?b.put("/api/annotations/"+m.verseSelected.annotationId,{book:a.book,chapter:a.chapter,verse:m.verseSelected.verse,comments:d}).success(function(){o(m.verseSelected)}):b.post("/api/annotations",{book:a.book,chapter:a.chapter,verse:m.verseSelected.verse,comments:d}).success(function(a){m.verseSelected.annotationId=a._id,o(m.verseSelected)})}),console.log("Save "+m.newComment),m.newComment=""},a.addRemark=function(c,d){console.log("Send "+c);var e=a.currentUser;e&&b.post("/api/messages",{to:d.user._id,from:e._id,subject:"Comment Remark",body:'I made following remark on your comment "<em>'+d.text+'</em>":<br/><strong>'+c+"</strong><br/>Do you accept?",hasAction:!0,action:{requestType:"POST",url:"/api/remarks/",requestBody:{user:e._id,remark:c,comment:d._id}}})},a.addReference=function(){console.log(m.referenceLink+" added");var c=a.currentUser;c&&b.post("/api/references",{user:c._id,url:m.referenceLink,description:m.referenceDescription}).success(function(c){m.references.push(c);var d=m.references.map(function(a){return a._id});m.verseSelected.annotationId?b.put("/api/annotations/"+m.verseSelected.annotationId,{book:a.book,chapter:a.chapter,verse:m.verseSelected.verse,references:d}).success(function(){o(m.verseSelected)}):b.post("/api/annotations",{book:a.book,chapter:a.chapter,verse:m.verseSelected.verse,references:d}).success(function(a){m.verseSelected.annotationId=a._id,o(m.verseSelected)})}),m.referenceLink="",m.referenceDesciption=""},a.addMedia=function(c){console.log(c.name+" added");var d=a.currentUser,e=function(c){c.image&&(c.url=c.image.url),m.media.push(c);var d=m.media.map(function(a){return a._id});m.verseSelected.annotationId?b.put("/api/annotations/"+m.verseSelected.annotationId,{book:a.book,chapter:a.chapter,verse:m.verseSelected.verse,media:d}).success(function(){o(m.verseSelected)}):b.post("/api/annotations",{book:a.book,chapter:a.chapter,verse:m.verseSelected.verse,media:d}).success(function(a){m.verseSelected.annotationId=a._id,o(m.verseSelected)})};if(d){var f=new FormData;f.append("url",c.url),f.append("name",c.name),f.append("description",c.description),f.append("type",c.type),f.append("user",d._id);var g={method:"POST",url:"/api/media",data:f,headers:{"Content-Type":void 0}};b(g).success(function(a){e(a)}).error(function(a){console.log(a)})}console.log("Save "+c.name)},a.deleteComment=function(c){var d=a.model.comments.indexOf(c);d>-1&&a.model.comments.splice(d,1);var e=m.comments.map(function(a){return a._id});m.verseSelected.annotationId?b.put("/api/annotations/"+m.verseSelected.annotationId,{book:a.book,chapter:a.chapter,verse:m.verseSelected.verse,comments:e}).success(function(){o(m.verseSelected)}):b.post("/api/annotations",{book:a.book,chapter:a.chapter,verse:m.verseSelected.verse,comments:e}).success(function(a){m.verseSelected.annotationId=a._id,o(m.verseSelected)})},a.updateComment=function(c,d){console.log(c+" updated");var e=a.currentUser;if(e){var f=a.model.comments.indexOf(c);f>-1&&(a.model.comments[f]=d);var g=m.comments.map(function(a){return a._id});m.verseSelected.annotationId?b.put("/api/annotations/"+m.verseSelected.annotationId,{book:a.book,chapter:a.chapter,verse:m.verseSelected.verse,comments:g}).success(function(){o(m.verseSelected)}):b.post("/api/annotations",{book:a.book,chapter:a.chapter,verse:m.verseSelected.verse,comments:g}).success(function(a){m.verseSelected.annotationId=a._id,o(m.verseSelected)})}console.log("Save "+d),m.newComment=""},a.showGroups=function(d){var f=d||angular.noop;a.groupSelected=c.defer(),b.get("/api/homebases/"+a.currentUser._id+"/groups").success(function(b){a.groups=b.groups;var c=angular.element(e.document).find("#group-menu");c&&c.width(250)}),a.groupSelected.promise.then(f)},a.hideGroups=function(b){var c=angular.element(e.document).find("#group-menu");c&&c.width(0),a.groupSelected&&a.groupSelected.resolve(b)}}]),angular.module("everywordApp").controller("TagsCtrl",["$scope","$uibModalInstance","tags","mytags",function(a,b,c,d){a.tags=c.data,a.selected={};for(var e=0;e<d.length;e++){var f=d[e];a.selected[f._id]=f}a.selectedIds=d.map(function(a){return a._id}),a.addTag=function(b){a.selected[b._id]=b},a.removeTag=function(b){delete a.selected[b._id]},a.ok=function(){var c=[];for(var d in a.selected)c.push(a.selected[d]);b.close(c)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("everywordApp").config(["$stateProvider",function(a){a.state("tags",{url:"/tags",templateUrl:"app/tags/tags.html",controller:"TagsCtrl"})}]),angular.module("everywordApp").controller("TestamentsCtrl",["$scope",function(a){a.message="Hello"}]),angular.module("everywordApp").factory("BibleService",["$http","$q",function(a,b){var c={};return{getBooks:function(d,e){var f=e||angular.noop,g=b.defer();return a.get("/api/biblesvc/"+d).success(function(a){return c[d]=a,g.resolve(a),f()}).error(function(a){return this.logout(),g.reject(a),f(a)}.bind(this)),g.promise},getChapters:function(a,d){var e=b.defer();if(void 0===c[a])this.getBooks(a).then(function(){var b=c[a].filter(function(a){return a.name===d});e.resolve(b[0].chapters)});else{var f=c[a].filter(function(a){return a.name===d});e.resolve(f[0].chapters)}return e.promise},getTestament:function(a){var b={ot:"Old Testament",nt:"New Testament"};return b[a]}}}]),angular.module("everywordApp").factory("Auth",["$location","$rootScope","$http","User","$cookieStore","$q",function(a,b,c,d,e,f){var g={};return e.get("token")&&(g=d.get()),{login:function(a,b){var h=b||angular.noop,i=f.defer();return c.post("/auth/local",{email:a.email,password:a.password}).success(function(a){return e.put("token",a.token),g=d.get(),i.resolve(a),h()}).error(function(a){return this.logout(),i.reject(a),h(a)}.bind(this)),i.promise},logout:function(){e.remove("token"),g={}},createUser:function(a,b){var c=b||angular.noop,h=f.defer();return d.checkEmail(a,function(a){if(a){var b={data:{errors:{email:{message:"Email already registered"}}}};return h.reject(b),c(b)}d.save(a,function(b){return e.put("token",b.token),g=d.get(),h.resolve(b),c(a)},function(a){return this.logout(),h.reject(a),c(a)}.bind(this))}.bind(this)),h.promise},changePassword:function(a,b,c){var e=c||angular.noop;return d.changePassword({id:g._id},{oldPassword:a,newPassword:b},function(a){return e(a)},function(a){return e(a)}).$promise},getCurrentUser:function(){return g},isLoggedIn:function(){return g.hasOwnProperty("role")},isLoggedInAsync:function(a){g.hasOwnProperty("$promise")?g.$promise.then(function(){a(!0)})["catch"](function(){a(!1)}):a(g.hasOwnProperty("role")?!0:!1)},isAdmin:function(){return"admin"===g.role},getToken:function(){return e.get("token")}}}]),angular.module("everywordApp").factory("User",["$resource",function(a){return a("/api/users/:id/:controller",{id:"@_id"},{changePassword:{method:"PUT",params:{controller:"password"}},get:{method:"GET",params:{id:"me"}},query:{method:"GET",isArray:!0},checkEmail:{method:"POST",params:{id:"email"}},show:{method:"GET",isArray:!1}})}]),angular.module("everywordApp").factory("Modal",["$rootScope","$modal",function(a,b){function c(c,d){var e=a.$new();return c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"components/modal/modal.html",windowClass:d,scope:e})}return{confirm:{"delete":function(a){return a=a||angular.noop,function(){var b,d=Array.prototype.slice.call(arguments),e=d.shift();b=c({modal:{dismissable:!0,title:"Confirm Delete",html:"<p>Are you sure you want to delete <strong>"+e+"</strong> ?</p>",buttons:[{classes:"btn-danger",text:"Delete",click:function(a){b.close(a)}},{classes:"btn-default",text:"Cancel",click:function(a){b.dismiss(a)}}]}},"modal-danger"),b.result.then(function(b){a.apply(b,d)})}}}}}]),angular.module("everywordApp").directive("mongooseError",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){b.on("keydown",function(){return d.$setValidity("mongoose",!0)})}}}),angular.module("everywordApp").controller("NavbarCtrl",["$scope","$location","$http","Auth",function(a,b,c,d){a.menu=[{title:"Home",link:"/main"}],a.isCollapsed=!0,a.isLoggedIn=d.isLoggedIn,a.isAdmin=d.isAdmin,a.getCurrentUser=d.getCurrentUser,a.messages=[],a.isLoggedIn()&&c.get("/api/homebases/"+a.getCurrentUser()._id+"/messages").success(function(b){a.messages=b.messages}),a.logout=function(){d.logout(),b.path("/login")},a.groups=function(){b.path("/groups")},a.following=function(){b.path("/following")},a.isActive=function(a){return a===b.path()}}]),angular.module("everywordApp").factory("ProgressBar",["$rootScope","$uibModal",function(a,b){function c(c,d){var e=a.$new();return c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"components/progressbar/progressbar.html",windowClass:d,scope:e,size:"sm"})}var d=null;return{show:function(a,b){"undefined"==typeof b&&(b={}),"undefined"==typeof a&&(a="Loading"),d=c()},hide:function(){d&&d.dismiss()}}}]),angular.module("everywordApp").factory("socket",["socketFactory",function(a){var b=io("",{path:"/socket.io-client"}),c=a({ioSocket:b});return{socket:c,syncUpdates:function(a,b,d){d=d||angular.noop,c.on(a+":save",function(a){var c=_.find(b,{_id:a._id}),e=b.indexOf(c),f="created";c?(b.splice(e,1,a),f="updated"):b.push(a),d(f,a,b)}),c.on(a+":remove",function(a){var c="deleted";_.remove(b,{_id:a._id}),d(c,a,b)})},unsyncUpdates:function(a){c.removeAllListeners(a+":save"),c.removeAllListeners(a+":remove")},syncQueries:function(a,b,d){d=d||angular.noop,c.on(a,function(a){a&&b.push(a),d(a,b)})}}}]),angular.module("everywordApp").run(["$templateCache",function(a){a.put("app/account/login/login.html",'<!-- <div ng-include="\'components/navbar/navbar.html\'"></div> --><div class=container><div class=row><div class=col-sm-12><h1>Login</h1><!--\n      <p>Accounts are reset on server restart from <code>server/config/seed.js</code>. Default account is <code>test@test.com</code> / <code>test</code></p>\n      <p>Admin account is <code>admin@admin.com</code> / <code>admin</code></p>\n--></div><div class=col-sm-12><form class=form name=form ng-submit=login(form) novalidate><div class=form-group><label>Email</label><input type=email name=email class=form-control ng-model=user.email required></div><div class=form-group><label>Password</label><input type=password name=password class=form-control ng-model=user.password required></div><div class="form-group has-error"><p class=help-block ng-show="form.email.$error.required && form.password.$error.required && submitted">Please enter your email and password.</p><p class=help-block ng-show="form.email.$error.email && submitted">Please enter a valid email.</p><p class=help-block>{{ errors.other }}</p></div><div><button class="btn btn-default btn-lg btn-login" type=submit>Login</button> <a class="btn btn-lg btn-register" href=/signup>Register</a></div><!--         <hr>\n        <div>\n          <a class="btn btn-facebook" href="" ng-click="loginOauth(\'facebook\')">\n            <i class="fa fa-facebook"></i> Connect with Facebook\n          </a>\n          <a class="btn btn-google-plus" href="" ng-click="loginOauth(\'google\')">\n            <i class="fa fa-google-plus"></i> Connect with Google+\n          </a>\n        </div>\n --></form></div></div><hr></div>'),a.put("app/account/settings/settings.html",'<!-- <div ng-include="\'components/navbar/navbar.html\'"></div> --><div class=container><div class=row><div class=col-sm-12><h1>Change Password</h1></div><div class=col-sm-12><form class=form name=form ng-submit=changePassword(form) novalidate><div class=form-group><label>Current Password</label><input type=password name=password class=form-control ng-model=user.oldPassword mongoose-error><p class=help-block ng-show=form.password.$error.mongoose>{{ errors.other }}</p></div><div class=form-group><label>New Password</label><input type=password name=newPassword class=form-control ng-model=user.newPassword ng-minlength=3 required><p class=help-block ng-show="(form.newPassword.$error.minlength || form.newPassword.$error.required) && (form.newPassword.$dirty || submitted)">Password must be at least 3 characters.</p></div><p class=help-block>{{ message }}</p><button class="btn btn-lg btn-primary" type=submit>Save changes</button></form></div></div></div>'),a.put("app/account/signup/signup.html",'<!-- <div ng-include="\'components/navbar/navbar.html\'"></div> --><div class=container><div class=row><div class=col-sm-12><h1>Sign up</h1></div><div class=col-sm-12><form class=form name=form ng-submit=register(form) novalidate><div class=form-group ng-class="{ \'has-success\': form.name.$valid && submitted,\n                                            \'has-error\': form.name.$invalid && submitted }"><label>Name</label><input name=name class=form-control ng-model=user.name required><p class=help-block ng-show="form.name.$error.required && submitted">A name is required</p></div><div class=form-group ng-class="{ \'has-success\': form.email.$valid && submitted,\n                                            \'has-error\': form.email.$invalid && submitted }"><label>Email</label><input type=email name=email class=form-control ng-model=user.email required mongoose-error><p class=help-block ng-show="form.email.$error.email && submitted">Doesn\'t look like a valid email.</p><p class=help-block ng-show="form.email.$error.required && submitted">What\'s your email address?</p><p class=help-block ng-show=form.email.$error.mongoose>{{ errors.email }}</p></div><div class=form-group ng-class="{ \'has-success\': form.password.$valid && submitted,\n                                            \'has-error\': form.password.$invalid && submitted }"><label>Password</label><input type=password name=password class=form-control ng-model=user.password ng-minlength=3 required mongoose-error><p class=help-block ng-show="(form.password.$error.minlength || form.password.$error.required) && submitted">Password must be at least 3 characters.</p><p class=help-block ng-show=form.password.$error.mongoose>{{ errors.password }}</p></div><div><button class="btn btn-default btn-lg btn-register" type=submit>Sign up</button></div><!--         <hr>\n        <div>\n          <a class="btn btn-facebook" href="" ng-click="loginOauth(\'facebook\')">\n            <i class="fa fa-facebook"></i> Connect with Facebook\n          </a>\n          <a class="btn btn-google-plus" href="" ng-click="loginOauth(\'google\')">\n            <i class="fa fa-google-plus"></i> Connect with Google+\n          </a>\n        </div>\n --></form></div></div><hr></div>'),a.put("app/admin/admin.html",'<!-- <div ng-include="\'components/navbar/navbar.html\'"></div> --><div class=container><p>The delete user and user index api routes are restricted to users with the \'admin\' role.</p><ul class=list-group><li class=list-group-item ng-repeat="user in users"><strong>{{user.name}}</strong><br><span class=text-muted>{{user.email}}</span> <a ng-click=delete(user) class=trash><span class="glyphicon glyphicon-trash pull-right"></span></a></li></ul></div>'),a.put("app/following/following.html",'<div class=modal-header><div class=row><div class=col-xs-4><h3 class=modal-title>Edit Following</h3></div><div class=col-xs-4><form class=form-horizontal role=form><div class=form-group><label class="control-label col-sm-2" for=userName>Search:</label><div class=col-sm-10><input id=query placeholder="Enter search text" ng-model=query onfocus="pxtrack.emit(\'counter\', \'1\')"></div></div></form></div></div></div><div class=modal-body style=text-align:center><div class=row><div class=col-sm-6><div class="panel panel-default"><div class=panel-heading>Following</div><div class=panel-body><ul class=list-unstyled><li ng-repeat="member in following track by $index"><div class=row><div class=col-xs-6>{{ member.name }}</div><div class=col-xs-2><button class="btn btn-primary" ng-click=unfollow(member)>Unfollow</button></div></div></li></ul></div></div></div><div class=col-sm-6><div class="panel panel-default"><div class=panel-heading>Available Users</div><div class=panel-body><ul class=list-unstyled><li ng-repeat="user in users | filter:query track by $index"><div class=row ng-hide="isFollowing(user) || user.role===&quot;admin&quot;"><div class=col-xs-6>{{ user.name }}</div><div class=col-xs-2><button class="btn btn-primary" ng-click=follow(user)>Follow</button></div></div></li></ul></div></div></div></div></div><div class=modal-footer style=text-align:left><button class="btn btn-primary" type=button ng-click=ok()>OK</button> <button class="btn btn-warning" type=button ng-click=cancel()>Cancel</button></div>'),a.put("app/following/following_main.html",'<div class="container p-t" id=grouparea><div class="row areaheader"><h1>Following</h1><div class=row><div style=padding-left:15px><button type=button class="btn btn-primary groupbutton" ng-click=editFollowing()>Add</button></div><!-- 		<div class="col-xs-6 col-md-2 vcenter">\n			\n		</div>\n		<div class="col-xs-6 col-md-2 vcenter" >\n		</div>\n --></div><hr></div><div class="panel panel-default vcenter" ng-if="model.following.length>0"><div class=panel-body><ul class="media-list media-list-users list-group"><li class=list-group-item ng-repeat="f in model.following"><div class=media><a class=media-left href=#><img class=img-circle src=../../assets/images/d8794517.avatar_placeholder.png></a><div class=media-body><button class="btn btn-primary btn-sm pull-right" ng-click=unfollow(f);><span class="icon icon-remove-user"></span> Unfollow</button> <strong>{{::f.name}}</strong><!-- 		               <small>{{::f.email}}</small> --></div></div></li></ul></div></div></div><script>document.body.style.backgroundColor = "#F5F5F5";</script>'),a.put("app/groups/create_group.html",'<div class=modal-header><h3 class=modal-title>Edit Members</h3></div><div class=modal-body><form class=form-horizontal role=form ng-show=model.showForm><div class=form-group><label class="control-label col-sm-2" for=groupName>Name:</label><div class=col-sm-10><input class=form-control id=groupName placeholder="Enter Group Name" ng-model=groupName></div></div><div class=form-group><label class="control-label col-sm-2" for=groupDescription>Description:</label><div class=col-sm-10><input class=form-control id=groupDescription placeholder="Enter Description" ng-model=groupDescription></div></div><div class=form-group><div class="col-sm-offset-2 col-sm-10"><div class=row><div class=col-sm-4><a href=# class=text-primary ng-click=inviteMembers()>Invite Members</a></div><div class="col-sm-2 checkbox"><label><input type=checkbox id=sendEmail>Send email</label></div><div class="col-sm-2 checkbox"><label><input type=checkbox>Active</label></div></div></div></div><div class=form-group><div class="col-sm-offset-2 col-sm-10"><button type=button class="btn btn-primary" ng-click=addGroup(groupName,groupDescription)>Submit</button></div></div></form></div><div class=modal-footer style=text-align:center><button class="btn btn-primary" type=button ng-click=ok()>OK</button> <button class="btn btn-warning" type=button ng-click=cancel()>Cancel</button></div>'),a.put("app/groups/group_main.html",'<script>document.body.style.backgroundColor = "#f2f3f7";</script><div class="container p-t-md"><div class="row areaheader"><h1>{{group.groupName}}</h1><hr></div><div class=row><div class=col-md-3><div class="panel panel-default visible-sm-block visible-md-block visible-lg-block"><div class=panel-body><h5 class=m-t-0>Members <small><a ui-sref=groups>Edit</a></small></h5><ul class="media-list media-list-stream"><li class="media m-b"><a class=media-left href=#><img class="avatar-list-item img-circle" src=../../assets/images/d8794517.avatar_placeholder.png></a><div class=media-body><strong>{{group.creator.name}}</strong><div class=media-body-actions><button class="btn btn-default-outline btn-sm disabled" ng-click=""><span class="icon icon-user"></span>Owner</button></div></div></li><li class="media m-b" ng-repeat="member in members"><a class=media-left href=#><img class="avatar-list-item img-circle" src=../../assets/images/d8794517.avatar_placeholder.png></a><div class=media-body><strong>{{member.name}}</strong><div class=media-body-actions><button class="btn btn-primary-outline btn-sm" ng-click=removeMember(member)><span class="icon icon-remove-user"></span>Remove</button></div></div></li></ul></div></div><div class="panel panel-default visible-sm-block visible-md-block visible-lg-block"><div class=panel-body><h5 class=m-t-0>Invited <small><a ui-sref=groups>Edit</a></small></h5><ul class="media-list media-list-stream"><li class="media m-b" ng-repeat="invitee in invited"><a class=media-left href=#><img class="avatar-list-item img-circle" src=../../assets/images/d8794517.avatar_placeholder.png></a><div class=media-body><strong>{{invitee.name}}</strong><!--             			<div class="media-body-actions"> --><!--             				<button class="btn btn-primary-outline btn-sm" ng-click=""> --><!--             					<span class="icon icon-remove-user"></span>wi --><!--             				</button> --><!--             			</div> --></div></li></ul></div></div><div class="panel panel-default visible-sm-block visible-md-block visible-lg-block"><div class=panel-body><h5 class=m-t-0>Requests <small><a ui-sref=groups>Edit</a></small></h5><ul class="media-list media-list-stream"><li class="media m-b" ng-repeat="requester in requests"><a class=media-left href=#><img class="avatar-list-item img-circle" src=../../assets/images/d8794517.avatar_placeholder.png></a><div class=media-body><strong>{{requester.name}}</strong><div class=media-body-actions><button class="btn btn-primary-outline btn-sm" ng-click=acceptUser(requester)><span class="icon icon-add-user"></span>Accept</button></div></div></li></ul></div></div><div class="panel panel-default m-b-md visible-sm-block visible-md-block visible-lg-block"><div class=panel-body><h5 class=m-t-0>Verses</h5><ul class="media-list media-list-stream"><li class="media m-b" ng-repeat="(scripture,verse) in verses"><a href=/scripture/{{verse.testament}}/{{verse.book}}/{{verse.chapter}}/{{verse.verse}}><span class="fa fa-book"></span> {{scripture}}</a></li></ul></div></div></div><div class=col-md-7><div ng-if="selectedUser!==\'\'" class=pull-left><a href=# ng-click=clearUserFilter()>All</a></div><br ng-if="selectedUser!==\'\'"><ul class="list-group media-list media-list-stream" infinite-scroll=loadMore() infinite-scroll-disabled=loading infinite-scroll-distance=2><li class="media list-group-item p-a"><div class=input-group><input class=form-control placeholder=Message ng-model=newMessage><div class=input-group-btn><!-- 	              <button ng-if=\'newMessage === ""\' type="button" class="btn btn-default"> --><!-- 	                <span class="icon icon-camera"></span> --><!-- 	              </button> --><button class="btn btn-primary pull-left" ng-disabled="newMessage ===&quot;&quot;" ng-click=addMessage()>Post</button></div></div></li><li class="media list-group-item p-a" ng-repeat="f in visibleFeed | filter:{\'postedBy\':selectedUser} | orderBy:\'-date\' track by $index"><a class=media-left href=#><img class="avatar-list-item img-circle" src=../../assets/images/d8794517.avatar_placeholder.png></a><div class=media-body><div class=media-heading><a ng-if="f.anno!==undefined" id=reference{{f._id}} href=# ng-mouseover="showScripture(f._id, f.anno)" ng-click=gotoAnnotation(f._id) class=pull-right><span class="glyphicon glyphicon-book"></span></a><h5><a href="" ng-click=filterByUser(f.user.name)>{{f.user.name}}</a> - {{f.date|date}}</h5></div><div ng-if=f.comment ew-comment comment=f.comment following="homebase.following || []" user=currentUser update-callback=updateComment delete-callback=removeComment></div><!--                 <p ng-if="f.comment">{{f.comment.text}}</p> --><div ng-if=f.media><p>{{f.media.description}}</p><div ng-if=f.media.image><img class=img-responsive src={{f.media.image.url}} title="{{f.media.name|unsafe}}"></div><div class="embed-responsive embed-responsive-4by3" ng-if="f.media.type===\'video\'"><embed-video ng-href={{::f.media.url}} controls>Watch</embed-video></div></div></div></li></ul></div><div class=col-sm-2><div class=row></div></div></div></div>'),a.put("app/groups/group_members.html",'<div class=modal-header><h3 class=modal-title>Edit Members</h3><!--     <span uib-dropdown on-toggle="toggled(open)">\n      <a href id="members-dropdown" class="text-primary" uib-dropdown-toggle>\n        Invite Members\n      </a>\n      <ul uib-dropdown-menu aria-labelledby="members-dropdown">\n        <li ng-repeat="u in users">\n	    <div class="row">\n	    	<div class="col-xs-2"></div>\n	    	<div class="col-xs-4">{{u.name}}</div>\n	        <div class="col-xs-2">\n          		<a href="#" ng-click="inviteMember(u);">Invite</a>\n	        </div>\n	     </div>	            \n        </li>\n      </ul>\n    </span>\n    <span uib-dropdown auto-close="outsideClick" on-toggle="toggled(open)">\n      <a href id="email-dropdown" class="text-primary" uib-dropdown-toggle>\n        Invite Emails\n      </a>\n      <ul uib-dropdown-menu aria-labelledby="email-dropdown">\n      	<li>\n	    <div class="input-group input-group-sm">\n	      <input type="text" class="form-control" ng-model="newEmail" placeholder="Enter email...">\n	      <span class="input-group-btn">\n	        <button class="btn btn-default" type="button" ng-click="emails.push(newEmail); newEmail=\'\'">Add</button>\n	      </span>\n	    </div>      		\n      	</li>\n        <li ng-repeat="e in emails">\n	    <div class="row">\n	    	<div class="col-xs-2"></div>\n	    	<div class="col-xs-4">{{e}}</div>\n	     </div>\n        </li>\n      </ul>\n    </span>\n--></div><div class=modal-body><div class=row><div class=col-sm-6><div class="panel panel-default"><div class=panel-heading>Members</div><div class=panel-body><ul class=list-unstyled><li ng-repeat="member in members.concat(invited).concat(requests).concat(invitees) track by $index"><div class=row><div class=col-xs-6>{{ member.name }}</div><div class=col-xs-2><a href=# ng-show="members.indexOf(member)!==-1" ng-click="$event.preventDefault(); removeMember(member)">Remove</a><p class=text-muted ng-show=isPending(member)>Pending</p></div></div></li></ul></div></div></div><div class=col-sm-6><div class="panel panel-default"><div class=panel-heading>Available Users</div><div class=panel-body><ul class=list-unstyled><li ng-repeat="user in users track by $index"><div class=row ng-show="!isMember(user) && user.role !== \'admin\'"><div class=col-xs-6>{{ user.name }}</div><div class=col-xs-2><a href=# class="btn btn-primary" ng-click=inviteMember(user)>Invite</a></div></div></li></ul></div></div></div></div></div><div class=modal-footer style=text-align:center><button class="btn btn-primary" type=button ng-click=ok()>OK</button> <button class="btn btn-warning" type=button ng-click=cancel()>Cancel</button></div>'),a.put("app/groups/groups.html",'<div class="container p-t" id=grouparea><div class="row areaheader"><h1>Groups</h1><div class=row style=padding-left:15px><button type=button class="col-xs-2 btn btn-primary groupbutton" ng-click=toggleForm()>Create Group</button><!--   	<div class="col-xs-2">\n  	<button type="button" class="btn btn-primary hidden-xs groupbutton" ng-click="toggleForm()" >Create Group</button>\n  	</div>\n --> <button type=button class="col-xs-2 btn btn-primary groupbutton" ng-click=showGroups()>Join Group</button></div><hr></div><div class=row><form class=form-horizontal role=form ng-show=model.showForm><div class=form-group><label class="control-label col-sm-2" for=groupName>Name:</label><div class=col-sm-10><input class=form-control id=groupName placeholder="Enter Group Name" ng-model=groupName></div></div><div class=form-group><label class="control-label col-sm-2" for=groupDescription>Description:</label><div class=col-sm-10><input class=form-control id=groupDescription placeholder="Enter Description" ng-model=groupDescription></div></div><div class=form-group><div class="col-sm-offset-2 col-sm-10"><div class=row><div class="col-sm-4 invitemembers"><a href=# class=text-primary ng-click=inviteMembers()>Invite Members</a><div class=well><ul class=list-unstyled><li ng-repeat="member in model.invitedMembers">{{member.name}}</li></ul></div></div><div class="col-sm-4 invitemembers"><a href=# class=text-primary ng-click=inviteMembers(true)>Invite by Email</a><div class=well><ul class=list-unstyled><li ng-repeat="email in model.invitedEmails">{{email}}</li></ul></div></div><!-- 		      <div class="col-sm-2 checkbox"> --><!-- 		        <label><input type="checkbox">Active</label> --><!-- 		      </div> --></div></div></div><div class=form-group><div class="col-sm-offset-2 col-sm-10"><button type=button ng-disabled=!groupName class="btn btn-primary" ng-click=addGroup(groupName,groupDescription)>Submit</button></div></div></form></div><div class=row><div id=groupList><div class="panel panel-default" ng-repeat="group in model.groups"><div class=panel-heading><a href=/group/{{group._id}}>{{group.name}}</a> <button type=button ng-hide="group.creator !== currentUser._id" ng-click=deleteGroup(group) class=close>&times;</button></div><div class="panel-body groups"><span class=text-primary>Description:</span><p style=overflow-y:hidden;text-overflow:ellipsis>{{group.info}}</p><a href=# class=text-primary ng-click=editMembers(group) ng-show="group.creator === currentUser._id">Edit Members</a></div><!--   		<li><a ng-click=\'toggleForm(group)\' class="text-primary" style=\'text-decoration:none;\'>{{group.name}}</a></li> --></div></div></div></div><script>document.body.style.backgroundColor = "#F5F5F5";</script>'),
a.put("app/groups/invite_emails.html",'<div class=modal-header><h3 class=modal-title>Invite Members</h3></div><div class=modal-body><form role=form><div class=form-group><label for=message>Message:</label><input class=form-control id=message ng-model=message></div><br><label for=emailForm>Add email to invite:</label><div class=row><div class=col-sm-8><input class=form-control ng-model=inviteEmail></div><button class="btn btn-primary col-sm-2" type=button id=emailForm ng-click=addEmail(inviteEmail)>Add</button></div><br><div class=well style=height:100px><ul class=list-unstyled ng-repeat="member in emails"><li>{{member}}</li></ul></div></form></div><div class=modal-footer style=text-align:center><button class="btn btn-primary" type=button ng-click=ok()>OK</button> <button class="btn btn-warning" type=button ng-click=cancel()>Cancel</button></div>'),a.put("app/groups/invite_members.html",'<div class=modal-header><h3 class=modal-title>Invite Members</h3></div><div class=modal-body><form role=form><div class=form-group><label for=message>Message:</label><input class=form-control id=message ng-model=message></div><br><label for=sel2>Select User(s):</label><!--       <select multiple class="form-control" id="sel2" --><!--           ng-options="" ng-model="selected"> --><!--       </select> --><div class=list-group><div class="list-group-item row" ng-repeat="user in users track by user._id"><div class="col-sm-4 text-center">{{ user.name }}</div><div class=col-sm-4 ng-show="selected.indexOf(user) === -1"><a href=# class="btn btn-primary btn-block" ng-click=selectUser(user)>Select</a></div><div class=col-sm-4 ng-show="selected.indexOf(user) !== -1"><span class="text-muted pull-left">Selected</span> <button type=button ng-click=unselectUser(user) class=close>&times;</button></div></div></div></form></div><div class=modal-footer style=text-align:center><button class="btn btn-primary" type=button ng-click=ok()>OK</button> <button class="btn btn-warning" type=button ng-click=cancel()>Cancel</button></div>'),a.put("app/groups/join_group.html",'<div class=modal-header><div class=row><div class=col-xs-4><h3 class=modal-title>Join Group</h3></div><div class=col-xs-4><form class=form-horizontal role=form><div class=form-group><label class="control-label col-sm-2" for=groupName>Search:</label><div class=col-sm-10><input id=query placeholder="Enter search text" ng-model=query onfocus="pxtrack.emit(\'counter\', \'1\')"></div></div></form><!-- 			  <select ng-model="orderList" onchange="pxtrack.emit(\'counter\', \'2\')">\n			    <option value="name">By name</option>\n			    <option value="-age">Newest</option>\n			    <option value="age">Oldest</option>\n			  </select>\n --></div></div></div><div class=modal-body style=text-align:center><div class=row><div class=col-sm-6><div class="panel panel-default"><div class=panel-heading>Current Groups</div><div class=panel-body><ul class=list-unstyled><li ng-repeat="group in mygroups track by $index"><div class=row><div class=col-xs-6>{{ group.name }}</div><div class=col-xs-2 ng-if="!myGroup(group) && pending.indexOf(group)===-1"><button class="btn btn-primary" ng-click=leaveGroup(group)>Leave</button></div><div class=col-xs-2 ng-if="!myGroup(group) && pending.indexOf(group)!==-1"><button class="btn btn-info disabled" style=margin-left:10px>Pending</button></div><div class=col-xs-2 ng-if=myGroup(group)><button class="btn btn-info disabled" style=margin-left:10px>Owner</button></div></div></li></ul></div></div></div><div class=col-sm-6><div class="panel panel-default"><div class=panel-heading>Available Groups</div><div class=panel-body><ul class=list-unstyled><li ng-repeat="group in groups | filter:query  track by $index"><div class=row><div class=col-xs-6>{{ group.name }}</div><div class=col-xs-2 ng-show="selected.indexOf(group)===-1"><button class="btn btn-primary" ng-click=joinGroup(group)>Join</button></div><div class=col-xs-2 ng-show="selected.indexOf(group)!==-1"><button class="btn btn-default disabled">Pending</button></div></div></li></ul></div></div></div></div></div><div class=modal-footer style=text-align:left><button class="btn btn-primary" type=button ng-click=ok()>OK</button> <button class="btn btn-warning" type=button ng-click=cancel()>Cancel</button></div>'),a.put("app/home/home.html",'<div class=col-sm-12><div id=video-container><video autoplay muted loop id=bgvid><source type=video/mp4 src=../../assets/videos/EverywordSplashVideo.mp4></source></video><div id=button-container><a ui-sref=main><img src=../../assets/images/a4cdd864.GetStarted.png class=centerImage></a></div><div id=userCount>{{usersCount}} users and growing</div><div id=main-menu><ul class=list-unstyled><li><a href=https://youtu.be/zAbTj7pLCqY data-lity>How It Works</a></li><!-- 				<li><a href="#">Explore Everyword</a></li> --><!-- 				<li><a href="#">About Us</a></li> --><!-- 				<li><a href="#">Contact Us</a></li> --><!-- 				<li><a href="#">Our Founders</a></li> --></ul></div></div></div><!-- poster="../../assets/images/4126c743.everyword_logo.png" -->'),a.put("app/main/main.html",'<script>document.body.style.backgroundColor = "#f2f3f7";</script><div class="container p-t-lg"><div class=row><div class=col-md-3><div class="panel panel-default panel-profile m-b-sm"><div class="panel-heading text-center" style="background-image: url(../../assets/images/ed1cc350.open-bible.jpg)"><h3 class=profile-header-user><em>Begin Reading</em></h3></div><div class="panel-body text-center"><!-- 		      <a ui-sref=\'testaments\' class="btn btn-primary" style=\'text-decoration:none;margin:0;\'>Begin Reading</a> --><ul class=panel-menu><li class=panel-menu-item><a ui-sref=ot>Old<br>Testament</a></li><li class=panel-menu-item><a ui-sref=nt>New<br>Testament</a></li></ul></div></div><div class="panel panel-default visible-sm-block visible-md-block visible-lg-block"><div class=panel-body ng-hide=true><p class=text-uppercase>Places</p><ul class=list-unstyled><li><a href=# style=text-decoration:none>Last Visited</a></li><li><a href=# style=text-decoration:none>Notebook</a></li></ul></div></div><div class="panel panel-default visible-sm-block visible-md-block visible-lg-block"><div class=panel-body><h5 class=m-t-0>Groups <small><a ui-sref=groups>Edit</a></small></h5><ul class="media-list media-list-stream"><li class="media m-b" ng-repeat="group in homebase.groups| limitTo: 10"><a href=/group/{{group._id}}><span class="fa fa-users"></span> {{group.name}}</a></li></ul><a ui-sref=groups ng-if="homebase.groups.length>10"><small>More</small></a></div></div><div class="panel panel-default m-b-md visible-sm-block visible-md-block visible-lg-block"><div class=panel-body><h5 class=m-t-0>Following <small><a ui-sref=following>Edit</a></small></h5><ul class="media-list media-list-stream"><li class="media m-b" ng-repeat="follow in homebase.following | limitTo: 10 track by $index"><a class=media-left href=#><img class="avatar-list-item img-circle" src=../../assets/images/d8794517.avatar_placeholder.png></a><div class=media-body><strong><a href="" ng-click="selectedUser=follow.name;filterByUser(follow.name)">{{follow.name}}</a></strong><div class=media-body-actions><button class="btn btn-primary-outline btn-sm" ng-click=unfollow(follow);><span class="icon icon-remove-user"></span>Unfollow</button></div></div></li></ul><a ui-sref=following ng-if="homebase.following.length>10"><small>More</small></a></div></div><div class="panel panel-default panel-link-list visible-sm-block visible-md-block visible-lg-block"><div class=panel-body><h5 class=m-t-0>Hashtags <small><a href=# ng-click=showTags()>Edit</a></small>&nbsp;&nbsp;<small><a href=# ng-click="selectedTag=\'\'">Clear</a></small></h5><tag-links tags=homebase.tags selected-tag=selectedTag></tag-links></div></div></div><div class=col-md-7><div class="panel panel-default panel-link-list visible-xs-block"><div class=panel-body><h5 class=m-t-0>Hashtags <small><a href=# ng-click=showTags()>Edit</a></small>&nbsp;&nbsp;<small><a href=# ng-click="selectedTag=\'\'">Clear</a></small></h5><tag-links tags=homebase.tags selected-tag=selectedTag></tag-links></div></div><div ng-if="selectedUser!==\'\'" class=pull-left><a href=# ng-click=clearUserFilter()>All</a></div><br ng-if="selectedUser!==\'\'"><ul class="list-group media-list media-list-stream" infinite-scroll=loadMore() infinite-scroll-disabled=loading infinite-scroll-distance=2><!-- 	        <li class="media list-group-item p-a">\n	          <div class="input-group">\n	            <input type="text" class="form-control" placeholder="Message">\n	            <div class="input-group-btn">\n	              <button type="button" class="btn btn-default">\n	                <span class="icon icon-camera"></span>\n	              </button>\n	            </div>\n	          </div>\n	        </li>\n --><li class="media list-group-item p-a" ng-repeat="f in visibleFeed | filter:selectedTag | filter:{\'postedBy\':selectedUser} track by $index"><a class=media-left href=#><img class="avatar-list-item img-circle" src=../../assets/images/d8794517.avatar_placeholder.png></a><div class=media-body><div class=media-heading><span class=pull-right><a ng-if=f.group id=groupLink{{f._id}} ng-mouseover=showGroup(f._id,f.group) href=/group/{{f.group._id}}><span class="fa fa-users"></span></a><br><a ng-if="f.anno!==undefined" id=reference{{f._id}} href=# ng-mouseover="showScripture(f._id, f.anno)" ng-click=gotoAnnotation(f._id)><span class="glyphicon glyphicon-book"></span></a></span><h5><a href="" ng-click="selectedUser=f.user.name;filterByUser(f.user.name)">{{f.user.name}}</a> - {{f.date|date}}</h5></div><div ng-if=f.comment ew-comment comment=f.comment following="homebase.following || []" user=currentUser update-callback=reload delete-callback=reload></div><!--                 <p ng-if="f.comment">{{f.comment.text}}</p> --><p ng-if=f.reference>{{f.reference.description}}<br><a href={{f.reference.url}} target=_blank>{{f.reference.url}}</a></p><div ng-if=f.media><p>{{f.media.description}}</p><div ng-if=f.media.image><img class=img-responsive data-action=zoom data-width=1050 data-height=700 src={{f.media.image.url}} title="{{f.media.name|unsafe}}"></div><div class="embed-responsive embed-responsive-4by3" ng-if="f.media.type===\'video\'"><embed-video ng-href={{::f.media.url}} controls>Watch</embed-video></div></div></div></li><!--             </div> --><!--             </div> --></ul></div><!--     </div> --><div class=col-sm-2><div class=row><!--       	<label class="text-primary" style="color: #000; font-weight: 500; text-transform: uppercase;">Messages</label><br> --><!--       	<span> --><!--           <a ui-sref=\'messages\'> --><!--             <img src="../../assets/images/d7e7c2ee.blue_message.png" alt="Messages" style="width:50px;height:50px;border:0;"> --><!--           	({{homebase.messages.length}}) --><!--           	<br/> --><!--           </a> --><!--       	</span> --></div></div><!--     <div class="col-sm-2"> --><!--       <span>Ad pane</span> --><!--     </div> --></div><!-- Modal --><!--   <div class="modal fade" id="tagsModal" role="dialog"> --><!--     <div class="modal-dialog"> --><!--       Modal content --><!--       <div class="modal-content"> --><!--         <div class="modal-header"> --><!--           <button type="button" class="close" data-dismiss="modal">&times;</button> --><!--          	 <h4 class="modal-title">Modal Header</h4> --><!--         </div> --><!--         <div class="modal-body"> --><!--           <p>Some text in the modal.</p> --><!--         </div> --><!--         <div class="modal-footer"> --><!--           <button type="button" class="btn btn-default" data-dismiss="modal">Close</button> --><!--         </div> --><!--       </div> --><!--     </div> --><!--   </div> --></div><!-- \n<header class="hero-unit" id="banner">\n  <div class="container">\n    <h1>\'Allo, \'Allo!</h1>\n    <p class="lead">Kick-start your next web app with Angular Fullstack</p>\n     <img src="assets/images/yeoman.png" alt="I\'m Yeoman">\n  </div>\n</header>\n\n<div class="container">\n  <div class="row">\n    <div class="col-lg-12">\n      <h1 class="page-header">Features:</h1>\n      <ul class="nav nav-tabs nav-stacked col-md-4 col-lg-4 col-sm-6" ng-repeat="thing in awesomeThings">\n        <li><a href="#" tooltip="{{thing.info}}">{{thing.name}}<button type="button" class="close" ng-click="deleteThing(thing)">&times;</button></a></li>\n      </ul>\n    </div>\n  </div>\n\n  <form class="thing-form">\n    <label>Syncs in realtime across clients</label>\n    <p class="input-group">\n      <input type="text" class="form-control" placeholder="Add a new thing here." ng-model="newThing">\n      <span class="input-group-btn">\n        <button type="submit" class="btn btn-primary" ng-click="addThing()">Add New</button>\n      </span>\n    </p>\n  </form>\n</div>\n\n<footer class="footer">\n  <div class="container">\n      <p>Angular Fullstack v2.1.1 |\n        <a href="https://twitter.com/tyhenkel">@tyhenkel</a> |\n         <a href="https://github.com/DaftMonk/generator-angular-fullstack/issues?state=open">Issues</a></p>\n  </div>\n</footer>\n-->'),a.put("app/messages/messages.html",'<div class="container p-t-md"><!-- 	<div class="col-md-2"> --><!-- 		<a href=\'\'>All Messages</a>&nbsp;&nbsp;<a href=\'\'>Unread Messages</a> --><ul class="col-md-2 list-group"><li class=list-group-item ng-repeat="message in messages"><a href=# ng-click=setCurrentMessage(message)>{{message.subject}}</a></li></ul><!-- 	</div> --><div class=col-md-8 ng-show="currentMessage!=null"><div class="panel panel-default"><div class=panel-heading><h3 class=panel-title>{{currentMessage.subject}}</h3></div><div class=panel-body><div class=page-header><h4>From: <small>{{currentMessage.from.name}}</small></h4></div><p ng-bind-html="currentMessage.body | unsafe"><br><div ng-show="currentMessage.hasAction && !actionComplete"><button type=button class="btn btn-primary" ng-click=performAction(currentMessage.action)>Accept</button>&nbsp;&nbsp; <button type=button class="btn btn-danger" ng-click=performAction(currentMessage.action,true)>Reject</button></div><div class="alert alert-success" ng-show=actionComplete><strong>Action Successful!</strong></div></p></div></div></div></div>'),a.put("app/reading/books/books.html",'<div class="container p-t-md"><h1 id=books-title>{{testamentTitle}} Books</h1><div class=outer-container><div class="row list-container"><ul class=list-inline><li ng-repeat="book in books"><div class=books><div class=book-div><a href=/chapters/{{testament}}/{{book.name}}><img ng-if="testament===\'ot\'" class=img-responsive src=../../../assets/images/6f3993ea.old_testament_bible.png><img ng-if="testament===\'nt\'" class=img-responsive src=../../../assets/images/b619d3b7.bible_2.png></a> <span class=book-name>{{book.name}}</span></div></div></li></ul></div></div></div>'),a.put("app/reading/chapter/chapter.html",'<div class="container p-t-md"><h1 id=chapters-title>{{book}} Chapters</h1><div class=outer-container><div class="row list-container"><ul class=list-inline><li ng-repeat="chapter in chapters" style=width:100px;height:100px><div class=chapters><div class=chapter-div><a href=/scripture/{{testament}}/{{book}}/{{chapter}}><img class=img-responsive src=../../../assets/images/c925a4ce.page_blank.png style=width:100%;height:100%><span class=chapter>{{chapter}}</span></a></div></div></li></ul></div></div></div>'),a.put("app/reading/scripture/comments/comment-form.html",'<div class="form-group panel panel-default"><div class=panel-body><textarea class=form-control placeholder="Add a new comment here." ng-model=newComment></textarea><br><div><button class="btn btn-primary pull-left" ng-show="newComment!=&quot;&quot;" ng-click=add()>Post</button><div class=pull-right><a href id=group-action ng-click=toggleVisibility(true,true);$event.stopPropagation() ng-show="newComment!=&quot;&quot;"><span ng-class="{\'text-primary\': model.groupOnly}" class="fa fa-users" uib-tooltip={{groupFootnote}} tooltip-append-to-body=true tooltip-placement=bottom></span></a><!-- 	   	 <ul id="group-menu" class="dropdown-menu p-a" uib-dropdown-menu role="menu" aria-labelledby="group-action"> --><!-- 	     	<li  role="menuitem" ng-repeat="g in groups"> --><!-- 			      <span class="pull-right"> --><!-- 			       		<a href="#"  ng-click="selectGroup(g);">Select</a> --><!-- 			      </span> --><!-- 			  	{{g.name}} --><!-- 	     	</li> --><!--       <li>Link 1</li> --><!--       <li>Link 2</li> --><!--       <li>Link 3</li> --><!--       <li>Link 4</li> --><!--       <li>Link 5</li> --><!--       <li>Link 6</li>  --><!--       <li>Link 7</li>  --><!--       <li>Link 8</li> --><!--       <li>Link 9</li> --><!--       <li>Link 10</li> --><!--       <li>Link 11</li> --><!--       <li>Link 13</li> --><!--       <li>Link 13</li> -->&nbsp;&nbsp;</div><a class=pull-right href ng-click=toggleVisibility(true,false);$event.stopPropagation() ng-show="newComment!=&quot;&quot;"><span ng-class="{\'text-primary\': model.privateComment && !model.groupOnly}" class="glyphicon glyphicon-eye-close" uib-tooltip="Only Visible to Me" tooltip-append-to-body=true tooltip-placement=bottom></span> &nbsp;&nbsp;</a> <a class=pull-right href ng-click=toggleVisibility(false,false);$event.stopPropagation() ng-show="newComment!=&quot;&quot;"><span ng-class="{\'text-primary\': !model.privateComment && !model.groupOnly}" class="glyphicon glyphicon-eye-open" uib-tooltip="Visible to All" tooltip-append-to-body=true tooltip-placement=bottom></span> &nbsp;&nbsp;</a></div></div></div>'),a.put("app/reading/scripture/comments/comments.html",'<a ng-if=includeHeading class=media-left href=#><img class="avatar-list-item img-circle" src=../../../../assets/images/d8794517.avatar_placeholder.png></a><div class=media-body><div ng-if=includeHeading class=media-heading><span class=text-primary>{{comment.user.name}}</span> <span class="text-muted pull-right">{{comment.date|date}}</span></div><div ng-if=!isEditing><p style=margin:0>{{comment.text}}&nbsp;&nbsp;&nbsp;&nbsp; <a ng-if=!isEditing href="" uib-tooltip=Edit tooltip-append-to-body=true tooltip-placement=bottom ng-hide="comment.user._id!==user._id" ng-click=toggleEditComment();$event.stopPropagation()><span class="glyphicon glyphicon-pencil" style=color:#428bca></span></a>&nbsp;&nbsp; <a ng-if=!isEditing href="" uib-tooltip=Delete tooltip-append-to-body=true tooltip-placement=bottom ng-hide="comment.user._id!==user._id" ng-click=deleteComment(comment);$event.stopPropagation()><span class="glyphicon glyphicon-remove" style=color:#428bca></span></a>&nbsp;&nbsp; <a ng-if=!isFollowing(comment.user) href="" uib-tooltip=Follow tooltip-append-to-body=true tooltip-placement=bottom ng-hide="comment.user._id===user._id" ng-click=follow(comment.user);$event.stopPropagation()><span class="glyphicon glyphicon-user" style=color:#428bca></span></a>&nbsp;&nbsp; <a href="" uib-tooltip=Remark tooltip-append-to-body=true tooltip-placement=bottom ng-hide="comment.user._id===user._id" ng-click=toggleRemarkForm();$event.stopPropagation()><span class="glyphicon glyphicon-comment" style=color:#428bca></span></a>&nbsp;&nbsp; <a href ng-hide="comment.user._id===user._id" uib-tooltip=Like tooltip-append-to-body=true tooltip-placement=bottom ng-click=like();$event.stopPropagation()><span style=color:#428bca>{{comment.likes}}<span class="glyphicon glyphicon-thumbs-up"></span></span></a></p>&nbsp;&nbsp;&nbsp;&nbsp;</div><div ng-if=isEditing><div class=form-group><textarea class=form-control ng-model=editComment.text></textarea><button style=margin-top:5px class="btn btn-primary pull-right" ng-click=cancelEditComment();$event.stopPropagation()>Cancel</button> <button style=margin-top:5px class="btn btn-primary pull-right" ng-enable="comment.text && comment.text!=\'\'" ng-click=updateComment(comment)>Update</button> <a class=pull-right href ng-click="editComment.isPrivate = !editComment.isPrivate;$event.stopPropagation()" ng-show="comment.text!=&quot;&quot;"><span ng-if=!editComment.isPrivate class="glyphicon glyphicon-eye-open" style=color:#428bca uib-tooltip="Visible to All" tooltip-append-to-body=true tooltip-placement=bottom></span> <span ng-if=editComment.isPrivate class="glyphicon glyphicon-eye-close" style=color:#428bca uib-tooltip="Only Visible to Me" tooltip-append-to-body=true tooltip-placement=bottom></span></a></div></div><ul ng-if=comments.remarks class="media-list m-b"><li class=media ng-repeat="remark in comment.remarks"><a class=media-left href=#><img class="avatar-list-item img-circle" src=../../../../assets/images/d8794517.avatar_placeholder.png></a><div class=media-body><strong>{{remark.user.name}} -</strong> {{remark.remark}}</div></li></ul></div><br><div ng-if=remarkForm.isShowing id=remarkForm{{comment._id}}><div class=form-group><textarea class=form-control placeholder="Add remark here." ng-model=remarkForm.content></textarea><button style=margin-top:5px class="btn btn-primary pull-right" ng-enable="remarkForm.content && remarkForm.content!=\'\'" ng-click=addRemark()>Post</button></div></div>'),a.put("app/reading/scripture/media/media.html",'<div class=annotation><form name=urlForm role=form><div class=input-group><input id=inputUrl class=form-control placeholder="Add a video link here or select image file." ng-model=inputUrl><div class=input-group-btn uib-dropdown><button id=action type=button data-toggle=dropdown data-target=# class="btn btn-primary" ng-click=$event.stopPropagation();toggleMenu()>Action<span class=caret></span></button><ul class=dropdown-menu uib-dropdown-menu role=menu aria-labelledby=action><li role=menuitem><button class="btn btn-link" ng-disabled=!inputUrl ng-click=addUrl()>Add video</button></li><li role=menuitem><span class="btn btn-link btn-file">Select Image...<input type=file id=files name=files[]></span></li></ul></div></div></form><div ng-show="inputUrl && !validateUrl(inputUrl)" class="alert alert-danger" role=alert><strong>Error!</strong>"{{inputUrl}}" Not valid url!</div><div id=drop_zone><img id=plus src="../../../../assets/images/ad55ea0c.media_download.png"><br>Drop videos or images here</div><div class=row ng-repeat="m in media"><div class=col-xs-2></div><div class="col-xs-8 nopadding"><div class=text-primary>{{m.description}}</div><div class=thumbnail ng-if=m.image><img class=img-responsive src={{m.url}} title="escape({{m.name}})"></div><div class="embed-responsive embed-responsive-16by9" ng-if="m.type===\'video\'"><embed-video ng-href={{m.url}} controls>Watch</embed-video></div><div style=padding-top:20px></div></div><div class="col-xs-2 nopadding"><a href=#><span class="glyphicon glyphicon-flag" aria-hidden=true>Flag</span></a></div></div><!-- 	<div class="row" ng-repeat=\'video in videos\'> --><!-- 		<div class=\'col-md-2\'></div> --><!-- 		<div class=\'col-md-8 nopadding\'> --><!-- 			<div class="text-primary">{{video.description}}</div> --><!-- 			<div class="embed-responsive embed-responsive-16by9"> --><!-- 				<embed-video ng-href="{{video.url}}" controls=0 >Watch</embed-video> --><!-- 			</div>	 --><!-- 		    <div style="padding-top:20px"></div> --><!-- 		</div>		 --><!-- 		<div class=\'col-md-2 nopadding\'> --><!-- 			<a href="#"> --><!-- 			  <span class="glyphicon glyphicon-flag" aria-hidden="true">Flag</span> --><!-- 			</a> --><!-- 		</div> --><!-- 	</div> --></div><script type=text/ng-template id=commentTemplate.html><div class="modal-header">\n    	<h4 class="modal-title">Enter comment or Description</h4>\n	</div>\n	<div class="modal-body">\n	   <textarea class="form-control" placeholder="Add comment here." ng-model="description"></textarea><br/>\n	</div>\n	<div class="modal-footer">\n    	<button class="btn btn-primary" type="button" ng-click="ok()">OK</button>\n    	<button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button>\n	</div></script>'),a.put("app/reading/scripture/partials/comment.html",'<div class=annotation id=comment-tab><!--   	<button class="btn btn-primary" type="button" ng-click="showGroups($event)">Show Groups</button> --><ew-comment-form show-group-menu=showGroups new-comment=model.newComment add-comment=addComment></ew-comment-form><ul class="list-group media-list media-list-stream"><li class="media list-group-item" ng-repeat="comment in model.comments track by $index | orderBy:\'-likes\'"><!--           {{comment.text}}    --><!--           {{comment.user.name}} --><div ng-if=isViewable(comment) ew-comment with-heading comment=comment following="homebase.following || []" user=currentUser update-callback=updateComment delete-callback=deleteComment></div><br></li></ul><div id=group-menu class="panel panel-default sidenav"><div class=panel-heading><strong>Groups</strong><a href="" class=close ng-click=hideGroups() aria-label=close>&times;</a></div><ul class=list-group><li class=list-group-item ng-repeat="g in groups"><span ng-show="model.selectedGroup && model.selectedGroup.name === g.name" class=badge style=background-color:#428bca><span class="glyphicon glyphicon-ok"></span></span> <a href="" ng-click="model.selectedGroup = g">{{g.name}}</a></li></ul><div class=panel-footer><button class="btn btn-primary btn-block" type=button ng-click=hideGroups(model.selectedGroup)>Done</button></div></div><script type=text/ng-template id=visibiltyPopoverTemplate.html><div class="form-group">\n          <ul  class="list-unstyled">\n            <li><a href="#" ng-click=\'toggleCommentVisiblity();  visibiltyPopover.isOpen = false\'>{{model.nextVisibility}}</a></li>            \n		  </ul>\n        </div></script></div>'),a.put("app/reading/scripture/partials/footnotes.html",'<div id=footnotes class=annotation><table class=table style=background:white;width:100% ng-repeat="fn in model.footnotes track by $index"><thead><tr><th>Word</th><th>Strong\'s Number</th><th>Original</th><th>Root</th><th>Definition</th><th>Transliteration</th></tr></thead><tbody><tr ng-repeat="note in fn.notes"><td><span class=text-primary>{{note.word}}</span></td><!--         <td> --><!-- table  class="table-condensed"--><!-- 	        	<tr>\n			        <th>Strong\'s Number</th>\n			        <th>Original</th>\n			        <th>Root</th>\n			        <th>Definition</th>\n			        <th>Transliteration</th>\n			   </tr>\n --><!-- tr ng-repeat="note in notes"--><td>{{note.strongs_num}}</td><td>{{note.original}}</td><td>{{note.lemma}}</td><td>{{note.strongs_def}}</td><td>{{note.transliteration}}</td><!-- /tr--><!--         	</table>\n       	</td>\n --></tr></tbody></table></div>'),a.put("app/reading/scripture/partials/media.html",'<ew-media media=model.media save=addMedia></ew-media><!-- <ew-media videos="model.media" save="addMedia"></ew-media> -->'),a.put("app/reading/scripture/partials/references.html",'<div class=annotation><form role=form><div class=form-group><input class=form-control placeholder="Add a reference link here." ng-model=model.referenceLink><br><textarea class=form-control placeholder="Describe reference link here." rows=4 ng-model=model.referenceDescription></textarea><br><button class="btn btn-primary" ng-click=addReference()>Add</button></div></form><ul class=list-unstyled ng-repeat="reference in model.references track by $index"><li><p>{{reference.description}}<br><a href={{reference.url}} target=_blank>{{reference.url}}</a></p></li></ul></div>'),a.put("app/reading/scripture/scripture.html",'<div class="container p-t-md"><div class=row><div class="col-sm-2 navigation"><h4 class="text-primary hidden-xs">Navigate</h4><div class=row><div class="panel-heading hidden-xs"><h5 class=text-uppercase><a href ng-click=getVersion(&quot;KJV&quot;) style=text-decoration:none>KJV</a></h5><h5 class=text-uppercase><a href ng-click=getVersion(&quot;ASV&quot;) style=text-decoration:none>ASV</a></h5><!-- h5 class="text-uppercase"><a href=\'\' ng-click=\'getVersion("NET")\' style=\'text-decoration:none;\'>NET</a></h5--></div><div class="btn-group visible-xs" role=group aria-label=Navigate><button type=button class="btn btn-default text-uppercase" ng-click=getVersion(&quot;KJV&quot;)>KJV</button> <button type=button class="btn btn-default text-uppercase" ng-click=getVersion(&quot;KJV&quot;)>ASV</button><!-- 			  <button type="button" class="btn btn-default">NET</button> --></div></div></div><div class="col-sm-8 verses st-content"><div id=passage><a ng-if="prevChapter!==undefined" href="" ng-click=getChapter(prevChapter) class=pull-left><span class="glyphicon glyphicon-chevron-left" style=color:#428bca uib-tooltip="{{prevChapter.book}} {{prevChapter.chapter}}" tooltip-append-to-body=true tooltip-placement=left></span></a> <a ng-if="nextChapter!==undefined" href="" ng-click=getChapter(nextChapter) class=pull-right><span class="glyphicon glyphicon-chevron-right" style=color:#428bca uib-tooltip="{{nextChapter.book}} {{nextChapter.chapter}}" tooltip-append-to-body=true tooltip-placement=right></span></a><h1>{{book}} {{chapter}}</h1><hr><div ng-show=!loading id=verselist class=list-unstyled><div ng-repeat="verse in verses" style=margin-bottom:8px><span uib-dropdown auto-close=disabled><a href="" id=verse{{verse.verse}} ng-class="{\'highlight\': verse.verse === highlightedVerse}" ng-click=showAnnotations(verse,$event);scrollToVerse(verse) uib-dropdown-toggle><span ng-hide=!verse.annoCount class="badge pull-right">{{verse.annoCount}}</span> {{verse.verse}} - {{verse.text}}</a><ul class=dropdown-menu uib-dropdown-menu template-url=tabs.html aria-labelledby=verseSpan{{verse.verse}}></ul></span></div></div></div></div></div><script type=text/ng-template id=tabs.html><li role="menuitem">\n		  <uib-tabset>		\n		    <uib-tab ng-repeat="tab in tabs" active="tab.active" ng-click="tabChanged()">\n				<uib-tab-heading>\n        			<img class="tab-image" uib-tooltip="{{tab.title}}" tooltip-append-to-body=\'true\' tooltip-placement=\'right\' src=\'{{tab.image}}\' >\n      			</uib-tab-heading>		      	\n		      	<div ng-include="tab.content" ng-click="$event.stopPropagation()"></div>\n		    </uib-tab>\n		  </uib-tabset>\n		  </li></script><script>function myCallback(data){\n			 var scope = $(\'#verselist\').scope();\n			 scope.showData(data);\n		}</script></div>'),a.put("app/tags/tags.html",'<div class=modal-header><div class=col-xs-8><div class=row><h3 class=modal-title>Available Tags</h3></div><div class=row><form class=form-horizontal role=form><div class=form-group><label class="control-label col-sm-2" for=tagName>Search:</label><div class=col-sm-10><input id=query placeholder="Enter search text" ng-model=query onfocus="pxtrack.emit(\'counter\', \'1\')"></div></div></form></div></div></div><div class=modal-body><ul class=list-unstyled><li ng-repeat="tag in tags | filter:query track by $index"><div class=row><div class=col-xs-6>{{ tag.tag }}</div><div class=col-xs-2><a href=# class=pull-right ng-click=addTag(tag) ng-if="selected[tag._id]===undefined"><!-- 	   	 				<span class="badge" style="background-color:#428bca"> --><span class="glyphicon glyphicon-unchecked"></span><!-- 	   	 				</span> --></a> <a href=# class=pull-right ng-click=removeTag(tag) ng-if="selected[tag._id]!==undefined"><!-- 	   	 				<span class="badge" style="background-color:#428bca"> --><span class="glyphicon glyphicon-check"></span><!-- 	   	 				</span> --></a></div><!--         		<div class="col-xs-2"><button class="btn btn-primary"  ng-click="addTag(tag)">Add</button></div> --></div></li></ul></div><div class=modal-footer><button class="btn btn-primary" type=button ng-click=ok()>OK</button> <button class="btn btn-warning" type=button ng-click=cancel()>Cancel</button></div>'),a.put("app/testaments/testaments.html",'<script>document.body.style.backgroundColor = "#f2f3f7";</script><div class="col-sm-12 p-t-md outer" style=background:#f2f3f7><div class=row><div class="col-sm-6 image-box"><a ui-sref=ot><!--             <div class="ot-image-inside"></div> --><img src=../../assets/images/6934c367.OldTestament_new.jpg class=img-responsive alt="Old Testament"></a></div><div class="col-sm-6 image-box"><a ui-sref=nt><!--             <div class="nt-image-inside"></div> --><img src=../../assets/images/abe5b438.NewTestament_new.jpg class=img-responsive alt="New Testament"></a></div></div></div>'),
a.put("components/modal/modal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class=modal-body><p ng-if=modal.text ng-bind=modal.text></p><div ng-if=modal.html ng-bind-html=modal.html></div></div><div class=modal-footer><button ng-repeat="button in modal.buttons" ng-class=button.classes ng-click=button.click($event) ng-bind=button.text class=btn></button></div>'),a.put("components/navbar/navbar.html",'<nav class="navbar navbar-inverse navbar-fixed-top app-navbar" ng-controller=NavbarCtrl style=margin-bottom:10px><div class=container><div class=navbar-header><button class=navbar-toggle type=button ng-click="isCollapsed = !isCollapsed"><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a href="/" class=navbar-brand>everyword</a><div class="button-group visible-xs pull-right" style=font-size:25px><button type=button class="btn btn-link" ng-click=groups()><span class="fa fa-users"></span></button> <button type=button class="btn btn-link" ng-click=following()><span class="icon icon-users"></span></button></div></div><div uib-collapse=isCollapsed class="navbar-collapse uib-collapse" id=navbar-main><ul class="nav navbar-nav"><li ng-repeat="item in menu" ng-class="{active: isActive(item.link)}"><a ng-href={{item.link}}>{{item.title}}</a></li><li ng-show=isAdmin() ng-class="{active: isActive(\'/admin\')}"><a href=/admin>Admin</a></li></ul><ul class="nav navbar-nav navbar-right m-r-0"><li ng-hide=isLoggedIn() ng-class="{active: isActive(\'/signup\')}"><a href=/signup>Sign up</a></li><li ng-hide=isLoggedIn() ng-class="{active: isActive(\'/login\')}"><a href=/login>Login</a></li><li ng-show=isLoggedIn()><p class=navbar-text>Hello {{ getCurrentUser().name }}</p></li><li ng-show=isLoggedIn()><a ui-sref=messages><span class="glyphicon glyphicon-envelope"></span> ({{messages.length}})</a></li><li ng-show=isLoggedIn() ng-class="{active: isActive(\'/settings\')}"><a href=/settings><span class="glyphicon glyphicon-cog"></span></a></li><li ng-show=isLoggedIn() ng-class="{active: isActive(\'/logout\')}"><a href="" ng-click=logout()>Logout</a></li></ul></div></div><div ncy-breadcrumb ng-hide=!isCollapsed></div></nav>'),a.put("components/progressbar/progressbar.html",'<div class=modal-header><h1>Loading...</h1></div><div class=modal-body><div class=progress><div class="progress-bar progress-bar-striped active" role=progressbar aria-valuenow=100 style=width:100%></div></div></div>')}]);