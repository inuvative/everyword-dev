"use strict";angular.module("everywordApp",["ngCookies","ngResource","ngSanitize","ngAnimate","btford.socket-io","ui.router","ui.bootstrap","ncy-angular-breadcrumb","videosharing-embed","angular.validators","infinite-scroll","ngTagsInput"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(a,b,c,d){b.otherwise("/"),c.html5Mode(!0),d.interceptors.push("authInterceptor")}]).factory("authInterceptor",["$rootScope","$q","$cookieStore","$location",function(a,b,c,d){return{request:function(a){return a.headers=a.headers||{},c.get("token")&&(a.headers.Authorization="Bearer "+c.get("token")),a},responseError:function(a){return 401===a.status?(d.path("/login"),c.remove("token"),b.reject(a)):b.reject(a)}}}]).run(["$rootScope","$location","Auth",function(a,b,c){a.$on("$stateChangeStart",function(a,d){c.isLoggedInAsync(function(c){d.authenticate&&!c&&(a.preventDefault(),b.path("/login"))})})}]),angular.module("everywordApp").controller("CreateAccountCtrl",["$scope","$uibModalInstance","$state","$location","$window","$http","Auth","MessageService",function(a,b,c,d,e,f,g,h){a.user={},a.errors={},a.showSignupForm=!1,a.passwordForgotten=!1,a.hasNotForgottenPassword=function(){return!a.passwordForgotten},a.login=function(c){a.submitted=!0,a.passwordForgotten=!1,c.$valid&&g.login({email:a.user.email,password:a.user.password}).then(function(){g.isLoggedInAsync(function(a){a&&b.close(g.getCurrentUser()),h.init(a)})})["catch"](function(b){a.submitted=!1,a.errors.other=b.message})},a.forgotPassword=function(b){a.submitted=!0,b.$valid&&g.forgotPassword({email:a.user.email}).then(function(b){var d=c.href("reset",{userid:b.id,token:b.token},{absolute:!0});f.post("/api/messages/sendEmail",{to:a.user.email,from:"everywordbible@gmail.com",subject:"Everyword Password Reset",resetPwd:!0,message:"",url:"www.everywordbible.com",link:d}),a.errors.other="A link to change your password has been emailed."})["catch"](function(b){a.errors.other=b.message,a.submitted=!1})},a.loginOauth=function(a){e.location.href="/auth/"+a},a.signup=function(){a.showSignupForm=!0},a.register=function(b){a.submitted=!0,b.$valid&&g.createUser({name:a.user.name,email:a.user.email,password:a.user.password}).then(function(){a.showSignupForm=!1})["catch"](function(c){c=c.data,a.errors={},angular.forEach(c.errors,function(c,d){b[d].$setValidity("mongoose",!1),a.errors[d]=c.message})})},a.ok=function(){b.close(a.description)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("everywordApp").factory("CreateAccountService",["$rootScope","$uibModal",function(a,b){function c(c,d){var e=a.$new();return c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"app/account/createAccount.tpl.html",windowClass:d,scope:e,controller:"CreateAccountCtrl"})}var d=null;return{showCreateAccountDialog:function(a,b){"undefined"==typeof b&&(b={}),d=c(),d.result.then(function(b){a(b)})},cancel:function(){d&&d.dismiss()}}}]),angular.module("everywordApp").controller("LoginCtrl",["$scope","Auth","MessageService","$state","$location","$window","$http",function(a,b,c,d,e,f,g){a.user={},a.errors={},a.passwordForgotten=!1,a.hasNotForgottenPassword=function(){return!a.passwordForgotten},a.login=function(d){a.submitted=!0,a.passwordForgotten=!1,d.$valid&&b.login({email:a.user.email,password:a.user.password}).then(function(){b.isLoggedInAsync(function(a){a&&b.isAdmin()?e.path("/admin"):e.path("/main"),c.init(a)})})["catch"](function(b){a.submitted=!1,a.errors.other=b.message})},a.forgotPassword=function(c){a.submitted=!0,c.$valid&&b.forgotPassword({email:a.user.email}).then(function(b){var c=d.href("reset",{userid:b.id,token:b.token},{absolute:!0});g.post("/api/messages/sendEmail",{to:a.user.email,from:"everywordbible@gmail.com",subject:"Everyword Password Reset",resetPwd:!0,message:"",url:"www.everywordbible.com",link:c}),a.errors.other="A link to change your password has been emailed."})["catch"](function(b){a.errors.other=b.message,a.submitted=!1})},a.loginOauth=function(a){f.location.href="/auth/"+a}}]).controller("ForgotCtrl",["$scope","Auth","$location","$state",function(a,b,c,d){a.user={}}]),angular.module("everywordApp").controller("ResetCtrl",["$scope","$stateParams","$state","Auth","Modal",function(a,b,c,d,e){a.errors={},a.user={},a.user.id=b.userid,a.user.token=b.token,a.resetPassword=function(b){a.submitted=!0;var f=a.user.newPassword===a.user.repeatPassword;f&&b.$valid&&d.resetPassword(a.user).then(function(){a.message="Password successfully reset.",a.submitted=!1,e.confirm.message(a.message,function(){c.go("login")})})["catch"](function(){b.password.$setValidity("mongoose",!1),a.errors.other="Invalid password",a.message="",a.submitted=!1})}}]),angular.module("everywordApp").controller("SettingsCtrl",["$scope","User","Auth",function(a,b,c){a.errors={},a.changePassword=function(b){a.submitted=!0,b.$valid&&c.changePassword(a.user.oldPassword,a.user.newPassword).then(function(){a.message="Password successfully changed."})["catch"](function(){b.password.$setValidity("mongoose",!1),a.errors.other="Incorrect password",a.message=""})}}]),angular.module("everywordApp").controller("SignupCtrl",["$scope","Auth","$location","$window",function(a,b,c,d){a.user={},a.errors={},a.register=function(d){a.submitted=!0,d.$valid&&b.createUser({name:a.user.name,email:a.user.email,password:a.user.password}).then(function(){c.path("/login")})["catch"](function(b){b=b.data,a.errors={},angular.forEach(b.errors,function(b,c){d[c].$setValidity("mongoose",!1),a.errors[c]=b.message})})},a.loginOauth=function(a){d.location.href="/auth/"+a}}]),angular.module("everywordApp").controller("AdminCtrl",["$scope","$http","$document","Auth","User","BibleService","$uibModal",function(a,b,c,d,e,f,g){a.users=e.query(),a.readings=[],b.get("/api/dailyreadings").success(function(b){a.readings=b}),a.showDailyReadings=!1,a.editDailyReading=function(c){var d=c?c.testament:"ot",e=g.open({animation:!0,templateUrl:"app/admin/editdailyreading.html",controller:"EditDailyReadingCtrl",size:"md",resolve:{books:function(){return f.getBooks(d).then(function(a){return a})},reading:function(){return c}}});e.result.then(function(d){c?b.put("/api/dailyreadings/"+c._id,d).success(function(b){var d=a.readings.indexOf(c);-1!==d&&(a.readings[d]=b)}):b.post("/api/dailyreadings",d).success(function(b){a.readings.push(b)})},function(){console.info("Modal dismissed at: "+new Date)})},a.deleteReading=function(c){b["delete"]("/api/dailyreadings/"+c._id).success(function(){var b=a.readings.indexOf(c);a.readings.splice(b,1)})},a.deleteUser=function(b){e.remove({id:b._id}),angular.forEach(a.users,function(c,d){c===b&&a.users.splice(d,1)})},a.generateEmailList=function(){var b=[["email","name"]],c=a.users;for(var d in a.users){var e=c[d];"user"===e.role&&b.push([e.email,e.name])}for(var f=[],g=0,h=b.length;h>g;++g)f.push(b[g].join(","));var i=f.join("%0A"),j=document.createElement("a");j.href="data:attachment/csv,"+i,j.target="_blank",j.download="emails.csv",document.body.appendChild(j),j.click()}}]).controller("EditDailyReadingCtrl",["$scope","$uibModalInstance","$http","BibleService","books","reading",function(a,b,c,d,e,f){if(a.books=e,a.selectedDate=new Date,f){if(a.selectedBook=e.find(function(a){return a.name===f.book}),a.selectedChapter=a.selectedBook.chapters.find(function(a){return Number(a)===f.chapter}),a.selectedDate=f.day,f.verses){a.selectedVerses=[];for(var g=f.verses.split("-"),h=parseInt(g[0])||0,i=g.length>1?parseInt(g[1]):h,j=h;i>=j;j++)a.selectedVerses.push(j)}a.selectedTestament=f.testament}else a.selectedBook=e[0],a.selectedTestament="ot";a.$watch("selectedChapter",function(){a.selectedChapter&&c.get("/api/biblesvc/"+a.selectedBook.name+"/"+a.selectedChapter).success(function(b){a.verses=b.verses.map(function(a){return a.verse})})}),a.$watch("selectedBook",function(){a.verses=[]}),a.removeTag=function(b){delete a.selected[b._id]},a.changeBooks=function(b){a.selectedTestament=b,d.getBooks(b).then(function(b){a.books=b,a.selectedChapter=null,a.selectedVerses=[],a.verses=[],a.selectedBook=b[0]})},a.ok=function(){var c={};c.update=null!=f,c.day=a.selectedDate,c.testament=a.selectedTestament,c.book=a.selectedBook.name,c.chapter=Number(a.selectedChapter);var d=a.selectedVerses.length;d?c.verses=d>1?a.selectedVerses[0]+"-"+a.selectedVerses[d-1]:a.selectedVerses[0]:c.verses=null,b.close(c)},a.cancel=function(){b.dismiss("cancel")},a.dateOptions={dateDisabled:!1,formatYear:"yy",startingDay:1},a.openCalendar=function(){a.calendar.opened=!0},a.setDate=function(b,c,d){a.selectedDate=new Date(b,c,d)},a.calendar={opened:!1}}]),angular.module("everywordApp").config(["$stateProvider",function(a){a.state("admin",{url:"/admin",templateUrl:"app/admin/admin.html",controller:"AdminCtrl"})}]),angular.module("everywordApp").config(["$stateProvider",function(a){a.state("login",{url:"/login",templateUrl:"app/account/login/login.html",controller:"LoginCtrl",ncyBreadcrumb:{skip:!0}}).state("signup",{url:"/signup",templateUrl:"app/account/signup/signup.html",controller:"SignupCtrl",ncyBreadcrumb:{skip:!0}}).state("reset",{url:"/reset?userid&token",templateUrl:"app/account/login/reset.html",controller:"ResetCtrl",ncyBreadcrumb:{skip:!0}}).state("settings",{url:"/settings",templateUrl:"app/account/settings/settings.html",controller:"SettingsCtrl",authenticate:!0,ncyBreadcrumb:{skip:!0}}).state("home",{url:"/",templateUrl:"app/home/home.html",controller:"HomeCtrl",ncyBreadcrumb:{skip:!0}}).state("support",{url:"/support",templateUrl:"app/home/support-us.html",controller:"SupportUsCtrl",ncyBreadcrumb:{label:"Support Us"}}).state("main",{url:"/main?guest",templateUrl:"app/main/main.html",controller:"MainCtrl",ncyBreadcrumb:{label:"Home"}}).state("group",{url:"/group/{groupid}",templateUrl:"app/groups/group_main.html",controller:"GroupMainCtrl",ncyBreadcrumb:{label:"{{groupName}}",parent:"main"}}).state("groups",{url:"/groups",templateUrl:"app/groups/groups.html",controller:"GroupsCtrl",ncyBreadcrumb:{label:"Groups",parent:"main"}}).state("following",{url:"/following",templateUrl:"app/following/following_main.html",controller:"FollowingCtrl",ncyBreadcrumb:{label:"Following",parent:"main"}}).state("testaments",{url:"/testaments",templateUrl:"app/testaments/testaments.html",controller:"TestamentsCtrl",ncyBreadcrumb:{label:"Testaments",parent:"main"}}).state("ot",{url:"/books/ot",templateUrl:"app/reading/books/books.html",controller:"BooksCtrl",ncyBreadcrumb:{label:"{{testament | uppercase}}",parent:"testaments"},resolve:{testament:function(){return"ot"}}}).state("nt",{url:"/books/nt",templateUrl:"app/reading/books/books.html",controller:"BooksCtrl",ncyBreadcrumb:{label:"{{testament | uppercase}}",parent:"testaments"},resolve:{testament:function(){return"nt"}}}).state("chapter",{url:"/chapters/{testament}/{book}",templateUrl:"app/reading/chapter/chapter.html",controller:"ChapterCtrl",ncyBreadcrumb:{label:"{{book}}",parent:function(a){return a.testament}}}).state("scripture",{url:"/scripture/{testament}/{book}/{chapter}",templateUrl:"app/reading/scripture/scripture.html",controller:"ScriptureCtrl",ncyBreadcrumb:{label:"{{chapter}}",parent:"chapter"}}).state("verse",{url:"/scripture/{testament}/{book}/{chapter}/{verse}",templateUrl:"app/reading/scripture/scripture.html",controller:"ScriptureCtrl",ncyBreadcrumb:{label:"{{chapter}}",parent:"chapter"}})}]),angular.module("everywordApp").controller("FollowingCtrl",["$scope","$http","$location","$filter","socket","Auth","User","$uibModal",function(a,b,c,d,e,f,g,h){if(!f.isLoggedIn())return void c.path("/login");a.model={following:[],followingIds:[]},a.userTable={rows:[]};var i=a.model;a.currentUser=f.getCurrentUser(),a.users=[],b.get("/api/homebases/"+a.currentUser._id+"/following?all=true").success(function(b){console.log("response"+b);for(var c in b){var d=b[c];a.getCounts(d),i.following.push(d),i.followingIds.push(d._id)}}),a.getCounts=function(a){b.get("/api/homebases/"+a._id+"/following?all=true").success(function(b){var c=b?b.length:0;a.following=c}),b.get("/api/homebases/"+a._id+"/followers?all=true").success(function(b){var c=b?b.length:0;a.followers=c}),b.get("/api/homebases/"+a._id+"/comments").success(function(b){var c=b?b.length:0;a.comments=c}),b.get("/api/homebases/"+a._id+"/likes").success(function(b){var c=b?b.length:0;a.likes=c})},a.addConnection=function(){a.showUsers=!0,a.users=[];var b=function(a){return a._id};i.following.map(b);g.query(function(b){for(var c=0;c<b.length;c++){var d=b[c];d._id!==a.currentUser._id&&(a.getCounts(d),a.users.push(d))}})},a.editFollowing=function(){var c=h.open({animation:!0,templateUrl:"app/following/following.html",controller:"FollowingModalCtrl",resolve:{following:function(){return a.model.following||[]},users:function(){return a.users}}});c.result.then(function(c){var d=[];for(var e in c)d.push(c[e]._id);b.put("/api/homebases/"+a.currentUser._id,{following:d}).success(function(a){console.log("Successfully updated Homebase "+a._id),i.following=c})},function(){console.info("Modal dismissed at: "+new Date)})},a.unfollow=function(c){var d=i.following.map(function(a){return a._id});if(-1!==d.indexOf(c._id)){var e=d.indexOf(c._id);i.following.splice(e,1)}d=i.following.map(function(a){return a._id}),b.put("/api/homebases/"+a.currentUser._id,{following:d}).success(function(a){console.log("Successfully updated Homebase "+a._id),i.followingIds=d})},a.follow=function(c){var d=i.following.map(function(a){return a._id});d.push(c._id),b.put("/api/homebases/"+a.currentUser._id,{following:d}).success(function(a){console.log("Successfully updated Homebase "+a._id),i.following.push(c),i.followingIds=d})}}]).controller("FollowingModalCtrl",["$scope","$uibModalInstance","following","users",function(a,b,c,d){a.following=[].concat(c);var e=function(a){return a._id};a.users=d,a.selected={follow:""},a.isFollowing=function(b){return-1!==a.following.map(e).indexOf(b._id)},a.follow=function(b){a.following.push(b)},a.unfollow=function(b){var c=a.following.map(e).indexOf(b._id);c>-1&&a.following.splice(c,1)},a.ok=function(){b.close(a.following)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("everywordApp").controller("GroupMainCtrl",["$scope","$http","$location","$stateParams","$sce","socket","BibleService","Auth","User","$uibModal","ProgressBar",function(a,b,c,d,e,f,g,h,i,j,k){function l(c){for(var d,e=/(?:^|\s)(?:#)([a-zA-Z\d]+)/gm,f=[];d=e.exec(c);)f.push("#"+d[1]);for(var g=0;g<f.length;g++){var h=f[g];b.post("/api/tags",{user:a.currentUser._id,tag:h,date:new Date}).success(function(a){console.log("tag added")})}}a.groupId=d.groupid,a.members=[],a.requests=[],a.invited=[],a.verses=[],a.feed=[],a.users=[],a.syncUserIds=[],a.visibleFeed=[],a.newMessage="",a.selectedUser="",a.following=[];var m=function(){var b=a.syncUserIds;for(var c in b)f.unsyncUpdates("comment"+b[c]),f.unsyncUpdates("media"+b[c]),f.unsyncUpdates("reference"+b[c])},n=function(b,c){a.getScripture(b._id).success(function(d){var e={_id:b._id,user:b.user,date:b.date,postedBy:b.user.name};e.likes="comment"===c?b.likes||0:0,"comment"===c&&e.comment,d&&(e.anno=d),a.isViewable(e)&&a.visibleFeed.push(e)})},o=function(a,b,c,d){if(c){c.comment=d;var e=b.indexOf(c);"deleted"===a&&b.splice(e,1)}else n(d,"comment")},p=function(a,b,c,d){if(c){c.comment=d;var e=b.indexOf(c);"deleted"===a&&b.splice(e,1)}else n(d,"media")},q=function(a,b,c,d){if(c){c.comment=d;var e=b.indexOf(c);"deleted"===a&&b.splice(e,1)}else n(d,"reference")},r=function(){a.loading=!0,a.group=null,a.currentUser=h.getCurrentUser(),b.get("/api/groups/"+a.groupId).success(function(c){a.group=c,a.group.creator=c.creator,a.group.groupName=c.name;var d=c.memberIds;d=d.filter(function(b){return b!==a.currentUser._id}),b.get("/api/homebases/"+c.creator._id+"/following").success(function(b){angular.forEach(b,function(a,b){this.push(a)},a.following)}),b.get("/api/homebases/"+a.currentUser._id+"/likes").success(function(b){a.currentUser.likes=b||[]}),a.feed=[],a.visibleFeed=[],a.verses=[],b.get("/api/groups/"+a.groupId+"/feed").success(function(b){var c=0;b.sort(function(a,b){var c=a.date?Date.parse(a.date):Date.now(),d=b.date?Date.parse(b.date):Date.now();return d-c});var e=function(b){a.getScripture(b[c]._id).success(function(g){var h=b[c];if(h.postedBy=h.user.name,h.likes=h.likes||0,g?h.anno=g:h.anno=void 0,a.isViewable(h)&&(a.visibleFeed.push(h),h.anno&&a.verses.push(h.anno)),c++,c<b.length)e(b);else{if(a.verses=a.groupVerses(),a.loading=!1,d)for(var i in d){var j=d[i];f.syncFeedUpdates("comment"+j,a.visibleFeed,o),f.syncFeedUpdates("media"+j,a.visibleFeed,p),f.syncFeedUpdates("references"+j,a.visibleFeed,q),a.syncUserIds.push(j)}console.log("done loading")}}).error(function(a){})};e(b)})}),b.get("/api/groups/"+a.groupId+"/members").success(function(b){angular.forEach(b,function(a,b){this.push(a)},a.members)}),b.get("/api/groups/"+a.groupId+"/requests").success(function(b){angular.forEach(b,function(a,b){this.push(a)},a.requests)}),b.get("/api/groups/"+a.groupId+"/invited").success(function(b){angular.forEach(b,function(a,b){this.push(a)},a.invited)})};r(),a.isViewable=function(b){return b.comment?b.comment.group&&b.comment.group._id===a.groupId:!0},a.trustSrc=function(a){return e.trustAsResourceUrl(a)},a.loadMore=function(c){if(c||!a.loading){a.loading=!0;var d=a.visibleFeed,e=d[d.length-1],f=c?new Date:e.date,g=c?"":"?after="+f.toString();b.get("/api/groups/"+a.groupId+"/feed"+g).success(function(d){b.get("/api/homebases/"+a.currentUser._id+"/likes").success(function(b){a.currentUser.likes=b}),c&&(a.visibleFeed=[]);var e=0;if(d){d.sort(function(a,b){var c=a.date?Date.parse(a.date):Date.now(),d=b.date?Date.parse(b.date):Date.now();return d-c});var f=function(b){a.getScripture(b[e]._id).success(function(c){var d=b[e];d.postedBy=d.user.name,d.likes=d.comment?d.comment.likes||0:0,d.comment&&(d.group=d.comment.group,d.isPrivate=d.comment.isPrivate),c&&(d.anno=c),a.isViewable(d)&&a.visibleFeed.push(d),e++,e<b.length?f(b):a.loading=!1}).error(function(a){})};d&&d.length>0&&f(d)}})}},a.addMessage=function(){var c=a.currentUser;l(a.newMessage),c&&b.post("/api/comments",{user:c._id,text:a.newMessage,date:new Date,isPrivate:!0,group:a.groupId}).success(function(b){var c={_id:b._id,user:b.user,date:b.date,comment:b,isPrivate:!0,group:a.groupId};a.visibleFeed.push(c),a.loadMore(!0)}),console.log("Save "+a.newMessage),a.newMessage=""},a.getScripture=function(a){return b.get("/api/annotations/0/find?annoEntryId="+a)},a.gotoAnnotation=function(a){b.get("/api/annotations/0/find?annoEntryId="+a).success(function(a){if(a){var b="/scripture/"+a.testament+"/"+a.book+"/"+a.chapter;c.path(b)}})},a.showScripture=function(a,b){var c="#reference"+a,d=b.book+" "+b.chapter+":"+b.verse;$(c).tooltip({title:d,placement:"bottom"}),$(c).tooltip("show")};a.groupVerses=function(){var b={};for(var c in a.verses){var d=a.verses[c],e=d.book+" "+d.chapter+":"+d.verse;e in b||(b[e]=d)}return b},a.clearUserFilter=function(){a.selectedUser=""},a.filterByUser=function(b){a.selectedUser=b},a.acceptUser=function(c){b.post("/api/messages/findMessage",{to:a.currentUser._id,from:c._id,subject:"Request to join Group"}).success(function(b){b&&a.acceptRequest(b)})},a.acceptRequest=function(a){var c=a.action,d=c.url,e=c.requestBody,f={method:c.requestType,url:d};e&&(f.data=e),b(f).then(function(){a.action.completed=!0,b.put("/api/messages/"+a._id,a).success(function(a){r()})})},a.removeMember=function(c){b.put("/api/groups/"+a.groupId+"/members/delete",{members:[c._id]}).success(function(b){a.members=b.members,r()})},a.updateComment=function(b,c){var d=a.visibleFeed.map(function(a){return a._id}).indexOf(b._id),e=a.visibleFeed[d];e.comment=c,a.loadMore(!0)},a.removeComment=function(b){var c=a.feed.map(function(a){return a._id}).indexOf(b._id);a.feed.splice(c,1),a.loadMore(!0)},a.updateLikes=function(b){a.currentUser.likes.push(b._id)},a.reload=function(){r()},a.$on("$destroy",m)}]),angular.module("everywordApp").controller("GroupsCtrl",["$scope","$http","$location","$window","$filter","socket","Auth","User","$uibModal","MessageService",function(a,b,c,d,e,f,g,h,i,j){if(!g.isLoggedIn())return void c.path("/login");a.model={showForm:!1,groups:[],pending:[],invitedMembers:[],invitedEmails:[],invitees:[],groupMembers:[]},a.isSmallDevice=d.innerWidth<768,a.groupName=null,a.groupDescription=null;var k=a.model;a.currentUser=g.getCurrentUser(),a.model.groupMembers=[a.currentUser.name],a.users=[],h.query(function(b){for(var c=0;c<b.length;c++)b[c]._id!==a.currentUser._id&&a.users.push(b[c])}),f.syncUpdates("group"+a.currentUser._id,k.groups,function(c,d,e){if("deleted"===c){var f=k.groups.map(function(a){return a._id});b.put("/api/homebases/"+a.homebase._id,{groups:f}).success(function(a){console.log("Successfully updated Homebase "+a._id)})}}),b.get("/api/homebases/"+a.currentUser._id+"/groups?all=true").success(function(b){console.log("response"+b),a.homebase=b;for(var c in b.groups){var d=b.groups[c];a.getContributions(d),k.groups.push(d)}}),a.toggleForm=function(b){return b?(k.editGroup=b,k.showForm=!0,a.groupName=b.name,void(a.groupDescription=b.info)):(a.groupName=null,a.groupDescription=null,k.editGroup=null,void(k.showForm=!k.showForm))},a.showAvailableGroups=function(){a.availGroups=[],b.get("/api/groups").success(function(b){for(var c in b){var d=b[c];d.creator!==a.currentUser._id&&(a.availGroups.push(d),a.getContributions(d))}}),k.showForm=!1,a.showAvailGroups=!0},a.getContributions=function(a){b.get("/api/groups/"+a._id+"/feedcount").success(function(b){a.contributions=b?b.count:0})},a.joinGroup=function(c){j.addMessage({to:c.creator,from:a.currentUser._id,subject:"Request to join Group",body:a.currentUser.name+" has requested to join your group <strong>"+c.name+"</strong>",hasAction:!0,action:{requestType:"PUT",url:"/api/groups/"+c._id+"/members",requestBody:{members:[a.currentUser._id]}}}).then(function(d){var e=c.requests,f=e.concat(a.currentUser);b.put("/api/groups/"+c._id,{requests:f}).success(function(a){console.log("Successfully updated group "+a._id),c.requests=a.requests})})},a.leaveGroup=function(c){var d=k.groups.indexOf(c);d>-1&&k.groups.splice(d,1);for(var e in c.members)c.members[e]._id===a.currentUser._id&&c.members.splice(e,1);b.put("/api/groups/"+c._id+"/members/delete",{members:[a.currentUser._id]}).success(function(a){console.log("Successfully updated group "+a._id)})},a.showGroups=function(){var c=i.open({animation:!0,templateUrl:"app/groups/join_group.html",controller:"JoinGroupCtrl",resolve:{currentUser:function(){return a.currentUser},mygroups:function(){return k.groups},groups:function(){return b.get("/api/groups").success(function(a){return a})}}});c.result.then(function(c){var d=c.remove,e=c.selected,f=c.mygroups;if(0!==d.length){for(var g in d){var h=d[g],i=k.groups.indexOf(h);i>-1&&k.groups.splice(i,1);for(var l in h.members)h.members[l]._id===a.currentUser._id&&h.members.splice(l,1);b.put("/api/groups/"+h._id+"/members",{members:h.members}).success(function(a){console.log("Successfully updated group "+a._id)})}var m=f.map(function(a){return a._id});b.put("/api/homebases/"+a.homebase._id,{groups:m}).success(function(a){console.log("Successfully updated Homebase "+a._id)})}for(var n in e){var h=e[n];j.addMessage({to:h.creator,from:a.currentUser._id,subject:"Request to join Group",body:a.currentUser.name+" has requested to join your group <strong>"+h.name+"</strong>",hasAction:!0,action:{requestType:"PUT",url:"/api/groups/"+h._id+"/members",requestBody:{members:[a.currentUser._id]}}}).then(function(c){b.put("/api/groups/"+h._id,{requests:[a.currentUser._id]}).success(function(a){console.log("Successfully updated group "+a._id)})})}},function(){console.info("Modal dismissed at: "+new Date)})},a.addGroup=function(c,d){var e=$("#sendEmail").is(":checked");b.post("/api/groups",{name:c,creator:a.currentUser._id,info:d,invited:k.invitedMembers,active:!0}).success(function(c){k.groupId=c._id,k.showForm=!1;for(var d in k.invitedMembers){var f=k.invitedMembers[d];e===!0&&k.invitedEmails.push(f.email),j.addMessage({to:f._id,from:a.currentUser._id,subject:"Group Invite",body:a.currentUser.name+" has invited you to join their group: <strong>"+c.name+"</strong>. With message:<br/>"+k.inviteMessage,hasAction:!0,action:{requestType:"PUT",url:"/api/groups/"+c._id+"/members",requestBody:{members:[f._id]}}})}k.invitedMembers=[];for(var g in k.invitedEmails){var h=k.invitedEmails[g];b.post("/api/messages/sendEmail",{to:h,from:a.currentUser,subject:"Everyword Invite",group:c.name,message:k.inviteMessage,url:"www.everywordbible.com",link:"http://www.everywordbible.com"})}k.invitedEmails=[]})},a.deleteGroup=function(a){b["delete"]("/api/groups/"+a._id)},a.editMembers=function(c){k.editGroup=c;var d=i.open({animation:!0,templateUrl:"app/groups/group_members.html",controller:"MembersCtrl",resolve:{members:function(){return b.get("/api/groups/"+c._id+"/members").success(function(a){return a})},invited:function(){return b.get("/api/groups/"+c._id+"/invited").success(function(a){return a})},requests:function(){return b.get("/api/groups/"+c._id+"/requests").success(function(a){return a})},emails:function(){return c.emails},users:function(){return a.users}}});d.result.then(function(d){var e=(d.current,d.invited),f=d.emails,g=d.remove,h=!1;for(var i in e){var l=e[i];k.editGroup.invited.push(l),h=!0,j.addMessage({to:l._id,from:a.currentUser._id,subject:"Group Invite",body:a.currentUser.name+" has invited you to join their group: <strong>"+k.editGroup.name+"</strong>",hasAction:!0,action:{requestType:"PUT",url:"/api/groups/"+k.editGroup._id+"/members",requestBody:{members:[l._id]}}})}for(var m in f){var n=f[m];k.editGroup.emails.push(n),h=!0,b.post("/api/messages/sendEmail",{to:n,from:a.currentUser,subject:"Everyword Invite",group:c.name,message:k.inviteMessage,url:"everywordbible.com",link:"http://www.everywordbible.com"})}if(g.length>0){var o=g.map(function(a){return a._id});b.put("/api/groups/"+k.editGroup._id+"/members/delete",{members:o}).success(function(a){k.groupMembers=a.members})}h&&b.put("/api/groups/"+c._id,k.editGroup).success(function(a){console.log("Successfully updated group "+a._id)})},function(){console.info("Modal dismissed at: "+new Date)})},a.inviteMembers=function(b){var c=i.open({animation:!0,templateUrl:b?"app/groups/invite_emails.html":"app/groups/invite_members.html",controller:"InviteMembersCtrl",resolve:{currentUser:function(){return a.currentUser},users:function(){return a.users},invited:function(){return k.invitedMembers},emails:function(){return k.invitedEmails}}});c.result.then(function(a){k.inviteMessage=a.message;for(var b in a.selected)k.invitedMembers.push(a.selected[b]);k.invitedEmails=k.invitedEmails.concat(a.emails)},function(){console.info("Modal dismissed at: "+new Date)})},a.clearForm=function(){k.invitedMembers=[],k.invitedEmails=[],a.groupName=null,a.groupDescription=null}}]).controller("JoinGroupCtrl",["$scope","$uibModalInstance","currentUser","mygroups","groups",function(a,b,c,d,e){a.currentUser=c,a.pending=e.data.filter(function(a){return-1!==a.requests.indexOf(c._id)}),a.mygroups=d.concat(a.pending);var f=a.mygroups.map(function(a){return a._id});a.groups=e.data.filter(function(a){return-1===f.indexOf(a._id)}),a.selected=[],a.remove=[],a.joinGroup=function(b){a.selected.push(b)},a.leaveGroup=function(b){var c=a.mygroups.indexOf(b);c>-1&&a.mygroups.splice(c,1),a.remove.push(b)},a.myGroup=function(b){return b.creator===a.currentUser._id},a.ok=function(){b.close({mygroups:a.mygroups,selected:a.selected,remove:a.remove})},a.cancel=function(){b.dismiss("cancel")}}]).controller("MembersCtrl",["$scope","$uibModalInstance","members","invited","requests","emails","users",function(a,b,c,d,e,f,g){var h=c.data;a.invited=d.data,a.requests=e.data,a.members=h,a.emails=f||[];var i=[];a.invitees=[];var j=function(a){return a._id};a.removeMember=function(b){var c=a.members.map(j).indexOf(b._id);c>-1&&a.members.splice(c,1),i.push(b)},a.inviteMember=function(b){a.invitees.push(b);var c=a.users.map(j).indexOf(b._id);c>-1&&a.users.splice(c,1)},a.inviteEmail=function(b){a.emails.push(b)},a.isPending=function(b){return-1!==a.invited.map(j).indexOf(b._id)||-1!==a.requests.map(j).indexOf(b._id)||-1!==a.invitees.map(j).indexOf(b._id)||-1!==a.emails.indexOf(b)},a.isMember=function(b){return-1!==a.members.map(j).indexOf(b._id)},a.users=g.filter(function(b){return!a.isPending(b)}),a.ok=function(){b.close({current:a.members,invited:a.invitees,emails:a.emails,remove:i})},a.cancel=function(){b.dismiss("cancel")}}]).controller("InviteMembersCtrl",["$scope","$uibModalInstance","currentUser","users","invited","emails",function(a,b,c,d,e,f){a.users=d.filter(function(a){return"admin"!==a.role}),a.invited=e,a.selected=[],a.emails=f,a.newEmails=[],a.addEmail=function(b){a.newEmails.push(b),a.inviteEmail=""},a.selectUser=function(b){a.selected.push(b)},a.unselectUser=function(b){var c=a.selected.indexOf(b);c>-1?a.selected.splice(c,1):(c=a.invited.indexOf(b),c>-1&&a.invited.splice(c,1))},a.ok=function(){b.close({message:a.message,selected:a.selected,emails:a.newEmails})},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("everywordApp").controller("HomeCtrl",["$scope","$location","$window","$http","User","Auth",function(a,b,c,d,e,f){a.usersCount=0,a.isLoggedIn=f.isLoggedIn,e.query(function(b){d.get("/api/groups/0/feedcount").success(function(b){a.contributions=b?b.count:0})}),a.gotoLogin=function(){console.log("image clicked!"),b.path("/login")},$("#home-container").height(c.innerHeight+40),c.onscroll=function(){c.scrollY>40?$("footer").removeClass("nav-down"):$("footer").addClass("nav-down")}}]),angular.module("everywordApp").controller("SupportUsCtrl",["$scope","$location","User",function(a,b,c){a.supporters=[{name:"Wes Turner",comment:""},{name:"Shauntae Hansen",comment:""},{name:"Tom & Marva Priday",comment:""},{name:"Jesse Jashinsky",comment:""},{name:"Kathy Washburn Bunn",comment:""},{name:"Katie Pope Rosell",comment:""},{name:"Bree Lazenby Watson",comment:""},{name:"Tasha",comment:""},{name:"Mary Cross",comment:""},{name:"Craig frogley",comment:""},{name:"Kevin J Knight",comment:""},{name:"Casey Crookston",comment:""},{name:"Emerson Fry",comment:""},{name:"Carol Archer",comment:""},{name:"Marwan Sameer Sulaiman",comment:""},{name:"Brynn Lewallen",comment:""},{name:"Bennett Mortenson",comment:""},{name:"Kelly Harmon",comment:""},{name:"Nathan Allan",comment:""},{name:"Jason Schmidt",comment:""},{name:"Christie Shill",comment:""},{name:"Rose Gochnour Serago",comment:""},{name:"Lara Nosal",comment:""},{name:"Dee Groberg",comment:""},{name:"Aaron Jolly",comment:""},{name:"Jennifer Griffith",comment:""},{name:"Phil Naylor",comment:""},{name:"Kendra Williamson",comment:""},{name:"Bryce Turner",comment:""},{name:"Keri Bloxham",comment:""},{name:"Anna Dunford",comment:""},{name:"Chantelle LaCouture",comment:""},{name:"Tyler & Emma Sabey",comment:""},{name:"Aly Lambert",comment:""},{name:"Christopher Bradford",comment:""},{name:"Mariah Overlock",comment:""},{name:"Michaelann Gardner",comment:""},{name:"Chris Leishman",comment:""},{name:"Scott & Cheryl Gurney",comment:""},{name:"Lori Laurent Smith",comment:""},{name:"Donlu Thayer",comment:""},{name:"Hannah",comment:""},{name:"Viki",comment:""},{name:"Thomas Groberg",comment:""},{name:"Sarah Messina",comment:""},{name:"Stephen Kenny",comment:""},{name:"Christy Farmer",comment:""},{name:"Paul Sabey",comment:""},{name:"Lauren",comment:""},{name:"Conor Hilton",comment:'everyword:"Genius annotations, but for The Bible, not song lyrics."'},{name:"Joseph Groberg",comment:""},{name:"Tyler McGettigan",comment:""},{name:"Jessica Chen",comment:""},{name:"Chanele",comment:""},{name:"Brandon Martin",comment:""},{name:"J Brian Andersen",comment:""},{name:"Joanne Vorkink",comment:""},{name:"John T. Doolittle",comment:""},{name:"Ally Davis",comment:""},{name:"Paul Schmidt",comment:""},{name:"Andrew Scot Proctor",comment:""},{name:"Jared Searle",comment:""},{name:"janet wright",comment:""},{name:"Dan Madsen",
comment:""},{name:"Zach Ridd",comment:""},{name:"Elaine Janis",comment:""},{name:"Adam Davis",comment:""},{name:"Paul D Taylor",comment:""},{name:"Taylor Stratton",comment:""},{name:"Christine Sabey",comment:""},{name:"Robby Tuttle",comment:""},{name:"Jane Garner",comment:""},{name:"Paige Barron",comment:""},{name:"Jim Sabey",comment:""},{name:"Roger Allen",comment:""},{name:"Tyler Bagley",comment:""},{name:"Ronda H. Groberg",comment:""},{name:"Courtney & Jonathan Judd",comment:""},{name:"Kelly Sanchez",comment:""},{name:"Kim",comment:""},{name:"Kaitlyn Johnson",comment:""},{name:"Dawn Stratton",comment:""},{name:"Robert Justus",comment:""},{name:"Jennifer Johnson",comment:""},{name:"Emily Pulham",comment:""},{name:"Lisa Brown",comment:""},{name:"Brenda Sabey",comment:""},{name:"John H Groberg",comment:""},{name:"Camryn Gallacher",comment:""},{name:"Peggy Jurado",comment:""},{name:"Paul O",comment:""},{name:"Matthew Smith",comment:""},{name:"Rachel Barzee",comment:""},{name:"Camille Armitstead",comment:""},{name:"Diane Gibbons",comment:""},{name:"Rebekah",comment:""},{name:"Koen van de Glind",comment:""},{name:"Emily Kay Brookhart",comment:""},{name:"Rebecca Watson",comment:""},{name:"Kathleen Crapo",comment:""},{name:"Michael R. Matheson",comment:""},{name:"Sarah ray",comment:""},{name:"Pamela Duffy",comment:""},{name:"Gail Berkey",comment:""},{name:"Michelle Aller",comment:""},{name:"grant whiteside",comment:""},{name:"Joakim Schön",comment:""},{name:"Lisa Comstock",comment:""},{name:"Mary and Bud Corkin",comment:""},{name:"Brian Sabey",comment:""},{name:"Brent Ludwig",comment:""},{name:"Gary Blaylock",comment:""},{name:"Anne",comment:""},{name:"Peter Anderson",comment:""},{name:"Bruce Young and Margaret Blair Young",comment:'"The Bible looks forward to a world where all men will treat each other not as rival brothers but as real brothers, a world in which the cultural violence that has divided and separated human communities in the past will be entirely revealed and abolished." (René Girard)'},{name:"Rebecca Gardner",comment:""},{name:"Don Wortley",comment:""},{name:"Elyse Harrison",comment:""},{name:"Mark Sabey",comment:'"Man shall live by every word that proceedeth from the mouth of God."'},{name:"Daniel Sabey",comment:""},{name:"Daniel Jackson",comment:""},{name:"Richard Payne",comment:""},{name:"Lindsey Madsen",comment:'"Then he said to me, "Son of man, eat this scroll I am giving you and fill your stomach with it." So I ate it, and it tasted as sweet as honey in my mouth."'},{name:"David Sabey",comment:""},{name:"Amber Blair",comment:""},{name:"Brook Metcalfe",comment:""},{name:"Dia Darcey Sabey",comment:""},{name:"Danielle Sabey",comment:""},{name:"James Messina",comment:""},{name:"Matt Sabey",comment:""}]}]),angular.module("everywordApp").controller("DailyReadingCtrl",["$scope","$http","$uibModalInstance","Auth","reference","verses","following","groups","showAnnotations",function(a,b,c,d,e,f,g,h,i){a.book=e.book,a.chapter=e.chapter,a.currentUser=d.getCurrentUser(),a.following=g,a.groups=h,a.loading=!0,a.showAnnotations=i,a.selectedVerse=null;var j=function(c){return b.post("/api/annotations/"+a.book+"/"+a.chapter+"/"+c+"/count/"+a.currentUser._id,{groups:a.groupIds})},k=function(b){a.verses=[];var c=0,d=function(b){j(b[c].verse).success(function(e){console.log("Loading..."),e?(b[c].commentsCount=e.commentCount,b[c].referencesCount=e.referenceCount,b[c].mediaCount=e.mediaCount,b[c].annoCount=e.commentCount+e.referenceCount+e.mediaCount):b[c].annoCount=0,a.verses.push(b[c]),c++,c<b.length?d(b):(a.loading=!1,console.log("done loading"),i&&setTimeout(function(b){a.selectedVerse=b},2e3,a.verses[0]))}).error(function(b){a.loading=!1})};d(b)};if(e.verses){var l=e.verses.split("-"),m=parseInt(l[0])||0,n=l.length>1?parseInt(l[1]):m;k(f.filter(function(a){return a.verse>=m&&a.verse<=n}))}else k(f);a.verseSelected=function(b){return a.selectedVerse===b},a.updateAnnoCounts=function(a){j(a.verse).success(function(b){a.commentsCount=b.commentCount,a.referencesCount=b.referenceCount,a.mediaCount=b.mediaCount,a.annoCount=b.commentCount+b.referenceCount+b.mediaCount})},a.scrollToVerse=function(a){var b=$("#passage").scrollTop(),c="#verse"+a.verse;$("#passage").animate({scrollTop:b+$(c).parent().offset().top-100},200)},a.close=function(){c.dismiss("cancel")}}]),angular.module("everywordApp").controller("MainCtrl",["$scope","$http","$q","$location","$state","$window","socket","BibleService","Auth","User","$uibModal","ProgressBar",function(a,b,c,d,e,f,g,h,i,j,k,l){a.loading=!0,a.homebase=null,a.feed=[],a.users=[],a.syncUserIds=[],a.visibleFeed=[],a.isSmallDevice=f.innerWidth<768,a.selectedUser="",a.groups=[],a.isGuest=e.is("main",{guest:!0}),a.showWelcome=a.isGuest,a.featuredComment=null;var m=new Date;a.showChristmasMessage=new Date(2016,11,1)<=m&&m<=new Date(2016,11,25,23,59,59),a.showChristmasMessage?(b.get("../../assets/reading_list.json").success(function(b){var c=b;for(var d in c){var e=new Date(d);if(m.getDate()===e.getDate())return void(a.readingOfDay={day:d,verses:c[d]})}}).error(function(a){console.log(a)}),b.get("../../assets/featured_commenters.json").success(function(c){var d=c;a.featuredComment=d[m.getDate()+""],a.featuredComment.day=m.getDate(),b.post("/api/devotionals",a.featuredComment).success(function(b){b.user,a.featuredComment.scriptures;a.featuredComment.user=b.user,a.featuredComment.comment=b.comment,a.featuredComment.media=b.media})}).error(function(a){console.log(a)})):b.get("/api/dailyreadings").success(function(b){var c=b.reduce(function(a,b){return(a[b.day]||(a[b.day]=[])).push(b),a},{});for(var d in c){var e=new Date(d);if(m.getDate()===e.getDate())return void(a.readingOfDay={day:d,verses:c[d]})}}).error(function(a){console.log(a)}),b.get("/api/devotionals/votd").success(function(b){var c=b.votd&&b.votd.reference?b.votd.reference:"",d=/(\d* *[\w\s]+) (\d+:*\d*-*\d*)/g;if(c=d.exec(c),c&&c.length){var e=c[1],f=Number(c[2].split(":")[0]),g=c[2].split(":")[1];c={book:e,chapter:f,verses:g}}a.verseOfTheDay={day:new Date,verse:c,text:b.votd.content}}),a.tags={selectedTag:""};var n=function(){var b=a.syncUserIds;for(var c in b)g.unsyncUpdates("comment"+b[c]),g.unsyncUpdates("media"+b[c]),g.unsyncUpdates("reference"+b[c])},o=function(b,c){a.getScripture(b._id).success(function(d){var e={_id:b._id,user:b.user,date:b.date,postedBy:b.user.name};e.likes=b.likes||0,e.isPrivate=b.isPrivate,"comment"===c&&(e.group=b.group),d&&(e.anno=d),a.isViewable(e)&&a.visibleFeed.push(e)})},p=function(a,b,c,d){if(c){c.comment=d;var e=b.indexOf(c);"deleted"===a&&b.splice(e,1)}else o(d,"comment")},q=function(a,b,c,d){if(c){c.media=d;var e=b.indexOf(c);"deleted"===a&&b.splice(e,1)}else o(d,"media")},r=function(a,b,c,d){if(c){c.reference=d;var e=b.indexOf(c);"deleted"===a&&b.splice(e,1)}else o(d,"reference")},s=function(){n(),a.syncUserIds=[],a.feed=[],a.currentUser=i.getCurrentUser(),console.log("currentUser: "+a.currentUser),b.get("/api/homebases/"+a.currentUser._id).success(function(c){console.log("response"+c),a.homebase=c.homebase;var d=c.userIds;b.get("/api/homebases/"+a.currentUser._id+"/groups").success(function(b){a.homebase.groups=b.groups||[],a.groups=b.groups.map(function(a){return a._id})}),b.get("/api/homebases/"+a.currentUser._id+"/following").success(function(b){a.homebase.following=b||[]}),b.get("/api/homebases/"+a.currentUser._id+"/tags").success(function(b){a.homebase.tags=b||[]}),b.get("/api/homebases/"+a.currentUser._id+"/likes").success(function(b){a.currentUser.likes=b||[]}),b.get("/api/homebases/"+a.currentUser._id+"/feed").success(function(b){var c=0;if(!b)return void(a.showWelcome=!0);b.sort(function(a,b){var c=a.date?Date.parse(a.date):Date.now(),d=b.date?Date.parse(b.date):Date.now();return d-c});var e=function(b){a.getScripture(b[c]._id).success(function(f){var h=b[c];if(h.postedBy=h.user.name,h.likes=h.likes||0,h.comment&&(h.group=h.comment.group,h.isPrivate=h.comment.isPrivate),f&&(h.anno=f),a.isViewable(h)&&a.visibleFeed.push(h),c++,c<b.length)e(b);else if(a.loading=!1,d)for(var i in d){var j=d[i];g.syncFeedUpdates("comment"+j,a.visibleFeed,p),g.syncFeedUpdates("media"+j,a.visibleFeed,q),g.syncFeedUpdates("references"+j,a.visibleFeed,r),a.syncUserIds.push(j)}}).error(function(a){})};b&&b.length>0?e(b):a.showWelcome=!0})})};a.loadMore=function(c){if(c||!a.loading){a.loading=!0;var d=a.visibleFeed,e=d[d.length-1],f=c?new Date:e.date,g=c?"":"?after="+f.toString();b.get("/api/homebases/"+a.currentUser._id+"/feed"+g).success(function(d){b.get("/api/homebases/"+a.currentUser._id+"/likes").success(function(b){a.currentUser.likes=b}),c&&(a.visibleFeed=[]);var e=0;if(d){d.sort(function(a,b){var c=a.date?Date.parse(a.date):Date.now(),d=b.date?Date.parse(b.date):Date.now();return d-c});var f=function(b){a.getScripture(b[e]._id).success(function(c){var d=b[e];d.postedBy=d.user.name,d.likes=d.likes||0,d.comment&&(d.group=d.comment.group,d.isPrivate=d.comment.isPrivate),c&&(d.anno=c),a.isViewable(d)&&a.visibleFeed.push(d),e++,e<b.length?f(b):a.loading=!1}).error(function(a){})};d&&d.length>0&&f(d)}})}};var t=function(a){b.get("/api/annotations/0/find?annoEntryId="+a).success(function(a){if(a){var b="/scripture/"+a.testament+"/"+a.book+"/"+a.chapter+"/"+a.verse;d.path(b)}})};a.gotoAnnotation=t,a.getScripture=function(a){return b.get("/api/annotations/0/find?annoEntryId="+a)},a.showScripture=function(a,b){if(b){var c=b.book+" "+b.chapter+":"+b.verse,d="#reference"+a;$(d).tooltip({title:c,placement:"right"}),$(d).tooltip("show")}},a.showGroup=function(a,b){if(b){var c=b.name,d="#groupLink"+a;$(d).tooltip({title:c,placement:"right"}),$(d).tooltip("show")}},a.isViewable=function(b){return b.isPrivate||b.group?b.isPrivate&&(b.user._id===a.homebase.login||b.group&&-1!==a.groups.indexOf(b.group._id)):!0},setTimeout(function(){i.isLoggedInAsync(function(b){b?(s(),j.query(function(b){for(var c=0;c<b.length;c++)b[c]._id!==a.currentUser._id&&a.users.push(b[c])})):a.isGuest?i.login({email:"guest@guest.com",password:"guest"}).then(function(){setTimeout(s,1e3)})["catch"](function(a){}):d.path("/login")})},10),a.showTags=function(){var c=k.open({animation:!0,templateUrl:"app/tags/tags.html",controller:"TagsCtrl",size:"sm",resolve:{tags:function(){return b.get("/api/tags").success(function(a){return a})},mytags:function(){return a.homebase.tags}}});c.result.then(function(c){a.homebase.tags=c;var d=a.homebase.tags.map(function(a){return a._id});b.put("/api/homebases/"+a.currentUser._id,{tags:d}).success(function(a){console.log("Successfully updated Homebase "+a._id)}).error(function(a){console.log(a)})},function(){console.info("Modal dismissed at: "+new Date)})},a.deleteThing=function(a){b["delete"]("/api/things/"+a._id)},a.beginReading=function(){b.get("/api/biblesvc").success(function(a){console.log("KJV: "+angular.toJson(a))})},a.unfollow=function(c){var d=a.homebase.following.map(function(a){return a._id});if(-1!==a.homebase.following.indexOf(c)){var e=d.indexOf(c._id);a.homebase.following.splice(e,1)}d=a.homebase.following.map(function(a){return a._id}),b.put("/api/homebases/"+a.currentUser._id,{following:d}).success(function(b){console.log("Successfully updated Homebase "+b._id),a.loadMore(!0)})},a.clearFilter=function(){a.selectedUser="",a.tags.selectedTag=""},a.filterByUser=function(b){a.selectedUser=b},a.$on("$destroy",n),a.reload=function(){a.loadMore(!0)},a.updateLikes=function(b){a.currentUser.likes.push(b._id)},a.$watch("tags.selectedTag",function(b){console.log("selectedTag: "+a.tags.selectedTag)}),a.viewFeaturedComment=function(){var b=k.open({animation:!0,templateUrl:"app/main/featuredComment.html",controller:["$scope","$uibModalInstance","featured","user","following","annotation",function(a,b,c,d,e,f){a.featured=c,a.anno=f.data,a.comment=c.comment,a.media=c.media,a.featured.date=a.comment?a.comment.date:a.media.date,a.user=d,a.following=e,a.gotoAnnotation=t,a.updateLikes=function(b){a.user.likes.push(b._id)},a.close=function(){b.dismiss("cancel")}}],size:"md",resolve:{featured:function(){return a.featuredComment},user:function(){return a.currentUser},following:function(){return a.homebase.following},annotation:function(){var b=a.featuredComment.comment||a.featuredComment.media;return a.getScripture(b._id)}}});b.result.then(function(a){},function(){console.info("Modal dismissed at: "+new Date)})},a.viewDailyReading=function(d,e){var f=k.open({animation:!0,templateUrl:"app/main/dailyReading.html",controller:"DailyReadingCtrl",size:"md",resolve:{reference:function(){return d},verses:function(){var a=b.get("/api/biblesvc/"+d.book+"/"+d.chapter),e=c.defer();return a.then(function(a){e.resolve(a.data.verses)},function(a){e.resolve([])}),e.promise},following:function(){return a.homebase.following},groups:function(){return a.groups},showAnnotations:function(){return e}}});f.result.then(function(c){a.homebase.tags=c;var d=a.homebase.tags.map(function(a){return a._id});b.put("/api/homebases/"+a.currentUser._id,{tags:d}).success(function(a){console.log("Successfully updated Homebase "+a._id)}).error(function(a){console.log(a)})},function(){console.info("Modal dismissed at: "+new Date)})}}]).directive("tagLinks",["$compile",function(a){var b=function(a){for(var b="",c=0;c<a.length;c++){var d="<a href=\"#\" ng-class=\"{'active': selectedTag ==='"+a[c].tag+'\'}" ng-click="selectTag('+c+')">'+a[c].tag+"</a>\n";b+=d}return b};return{restict:"E",scope:{tags:"=",selectedTag:"="},link:function(c,d,e){c.selectTag=function(a){var b=c.tags[a];c.selectedTag=b.tag},c.$watch("tags",function(e){var f=e||[];d.html(b(f)).show(),a(d.contents())(c)})}}}]).directive("moreText",["$compile",function(a){function b(a){d=0;var b=/(https?:\/\/[^\s]+)/g;return a.replace(b,function(a){var b='<span class="dont-break-out"><a href="'+a+'" target="_blank">'+a+"</a></span>";return d+=b.length,b})}function c(a){f=0;for(var b=a.split(/(\n|\r|\r\n|\n\r)/g),c="",d=0;d<b.length;d++){var g=b[d];0==g.length||g.match(/\n|\r|\r\n|\n\r/g)||(e||(c+="<p>",f+="<p>".length),c+=b[d],e=!0),g.match(/\n|\r|\r\n|\n\r/g)&&e&&(c+="</p>",f+="</p>".length,e=!1)}return b.length?c:a}var d=0,e=!1,f=0;return{restrict:"AEC",replace:!0,scope:{content:"=",showChar:"@",moreAction:"&?",expandable:"=?"},template:"<div>{{content}}</div>",link:function(e,f,g){e.ellipsestext="...",e.moretext="More",e.lesstext="Less",void 0===e.showChar&&(e.showChar=200),void 0===e.expandable&&(e.expandable=!0),e.showMoreOrLess=function(a){if(e.moreAction)e.moreAction()();else{var b=f.find(".morelink");if(b.length>0){var c=b.prev();b=angular.element(b[0]),b.hasClass("less")?(b.removeClass("less"),b.html(e.moretext),c.css("display","none")):(b.addClass("less"),b.html(e.lesstext),c.css("display","inline")),b.parent().next().toggle()}}},e.$watch("content",function(g){g=g?b(g):"";var h=parseInt(e.showChar);if(e.expandable&&g.length>h){g=c(g);var i=h+d,j=g.substr(i,g.length-i).indexOf("<p>");j>-1&&(i+=j);var k=g.substr(0,i),l=g.substr(i,g.length-i),m=k;l.length>0&&(m=k+'<div class="morecontent"><div>'+l+'</div>&nbsp;<a href="" class="morelink" ng-click="showMoreOrLess($event)">'+e.moretext+'</a></div><span class="moreelipses">'+e.ellipsestext+"</span>"),f.html(m)}else g=c(g),f.html(g);a(f.contents())(e)})}}}]),angular.module("everywordApp").controller("MessageViewCtrl",["$scope","$http","$location","socket","$state","$stateParams","MessageService","messages",function(a,b,c,d,e,f,g,h){f.idx&&(a.currentMessage=h[f.idx],a.actionComplete=a.currentMessage.action.completed,a.currentMessage.read||(a.currentMessage.read=!0,b.put("/api/messages/"+a.currentMessage._id,a.currentMessage))),a.title="View Message",a.deleteMessage=function(a){g.deleteMessage(a).then(function(b){var c=h.indexOf(a);h.splice(c,1),e.go("messages.list")})},a.performAction=function(c,d){var e=c.url,f=c.requestBody;d&&(f.rejected=!0);var g={method:c.requestType,url:e};f&&(g.data=f),d?b["delete"]("/api/messages/"+a.currentMessage._id).success(function(b){var c=h.indexOf(a.currentMessage);h.splice(c,1),a.currentMessage=c<=h.length-1?h[c]:h[c-1]}):b(g).then(function(){a.currentMessage.action.completed=!0,b.put("/api/messages/"+a.currentMessage._id,a.currentMessage).success(function(b){a.actionComplete=!0})})}}]),angular.module("everywordApp").controller("MessageComposeCtrl",["$scope","$http","$location","socket","$state","$stateParams","MessageService","Auth","User","$uibModal",function(a,b,c,d,e,f,g,h,i,j){a.message={recipients:null,sender:null,subject:null,body:null},a.recipients=[],a.inputClicked=function(){alert("Input clicked")},a.users=i.query();var k=a.message,l=h.getCurrentUser();a.errors={},a.isNew="new"===f.action,a.isReply="reply"===f.action,a.isReply&&(a.message=f.message,a.recipients.push(a.message.from)),a.send=function(b){if(a.submitted=!0,b.$valid)for(var c in a.recipients){var d=a.recipients[c];g.addMessage({to:d._id,from:l._id,subject:k.subject,body:k.body,hasAction:!1}).then(function(){g.sendEmail(d.email,l,{subject:k.subject,message:k.body}),e.go("messages.list")})["catch"](function(b){a.submitted=!1,a.errors.other=b.message})}},a.loadUsers=function(b){return a.users.filter(function(a){return"admin"!==a.role&&"guest"!==a.role&&a._id!==l._id})},a.updateRecipients=function(b){console.log("recipient added: "+b),console.log("recipient count: "+a.recipients.length)},a.addRecipients=function(){var b=j.open({animation:!0,templateUrl:"app/messages/add_recipients.html",controller:"AddRecipientCtrl",resolve:{currentUser:function(){return l},users:function(){return a.users},recipients:function(){return a.recipients}}});b.result.then(function(b){for(var c in b.selected)a.recipients.push(b.selected[c]);a.recipients=a.recipients.concat(b.emails),k.recipients=a.recipients.map(function(a){return a.name||a}).join(";")},function(){console.info("Modal dismissed at: "+new Date)})}}]).controller("AddRecipientCtrl",["$scope","$uibModalInstance","currentUser","users","recipients",function(a,b,c,d,e){a.users=d.filter(function(a){return"admin"!==a.role}),a.selected=[],a.recipients=e,a.emails=e.filter(function(a){return void 0===a.name}),a.newEmails=[],a.addEmail=function(b){a.newEmails.push(b),a.inviteEmail=""},a.selectUser=function(b){a.selected.push(b)},a.unselectUser=function(b){var c=a.selected.indexOf(b);c>-1?a.selected.splice(c,1):(c=a.invited.indexOf(b),c>-1&&a.invited.splice(c,1))},a.ok=function(){b.close({selected:a.selected,emails:a.newEmails})},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("everywordApp").controller("MessagesMainCtrl",["$scope","Auth","MessageService","$state","$filter","$http","messages",function(a,b,c,d,e,f,g){function h(b,d){for(var e=j[d],g=0;g<b.length;g++){var h=b[g];if("delete"===d){var i=a.messages.indexOf(h);a.messages.splice(i,1),a.showAllMessages(),c.deleteMessage(h)}else Object.assign(h,e),f.put("/api/messages/"+h._id,e).success(function(b){a.showAllMessages()})}}a.$state=d,a.currentUser=b.getCurrentUser(),a.messageTypes,a.selectedType="",a.title="Messages",a.messages=g,a.filteredMessages=g,a.menu={items:[]};var i=function(){for(var b in a.messages){var c=a.messages[b];-1===a.menu.items.indexOf(c.subject)&&a.menu.items.push(c.subject)}a.selectedType=""};i(),a.showAllMessages=function(){a.filterMessages(!1)},a.filterMessages=function(b){a.selectedType=b||"",a.filteredMessages=e("filter")(a.messages,{subject:a.selectedType}),d.go("messages.list")},a.filterByUser=function(b){a.filteredMessages=e("filter")(a.messages,{from:b}),d.go("messages.list")},a.refreshList=function(){a.filterMessages(!1)},a.markAsRead=function(a){h(a,"markRead")},a.archive=function(a){h(a,"archive")},a.deleteMessages=function(a){h(a,"delete")};var j={markRead:{read:!0},archive:{archived:!0}};a.output=function(a){console.log(a)},d.go("messages.list")}]).filter("unread",function(){return function(a){return a.filter(function(a){return!a.read&&!a.action.completed})}}),angular.module("everywordApp").controller("MessagesCtrl",["$scope","$http","$location","socket","Auth","$state","messages",function(a,b,c,d,e,f,g){a.currentUser=e.getCurrentUser(),a.homebase=null,a.messageTypes,a.selectedType="",a.actionComplete=!1,a.currentMessage=null,a.selectedMessages=[],a.updateSelectedMessages=function(b,c){if(b.target.checked)a.selectedMessages.push(c);else{var d=a.selectedMessages.indexOf(c);d>-1&&a.selectedMessages.splice(d,1)}},a.selectAll=function(b,c){b.target.checked&&(a.selectedMessages=a.selectedMessages.concat(c))},a.rowClicked=function(a,b){var c=$(a.target),d=c.parent();c.is("a")||c.is("button")||d.is("button")||f.go("messages.view",{idx:b})},a.toggleMenu=function(a){var b=$(a.target),c=b.parent();c.hasClass("open")?(c.trigger($.Event("hide.bs.dropdown",{relatedTarget:b})),c.removeClass("open").trigger("hidden.bs.dropdown",b)):(c.trigger($.Event("show.bs.dropdown",{relatedTarget:b})),c.addClass("open").trigger("shown.bs.dropdown",b))},a.setCurrentMessage=function(b){a.currentMessage=b,b.hasAction&&(a.actionComplete=b.action.completed)},a.internalIndex=function(a){return g.indexOf(a)}}]).filter("unsafe",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),angular.module("everywordApp").config(["$stateProvider",function(a){a.state("messages",{url:"/messages",templateUrl:"app/messages/message-main.html",controller:"MessagesMainCtrl",resolve:{messages:["MessageService",function(a){return a.getMessages()}]},ncyBreadcrumb:{label:"Messages",parent:"main"}}).state("messages.list",{url:"/inbox",templateUrl:"app/messages/messages.html",controller:"MessagesCtrl",ncyBreadcrumb:{skip:!0}}).state("messages.view",{url:"/view/message/{idx}",data:{title:"View Message"},templateUrl:"app/messages/message-view.html",controller:"MessageViewCtrl",ncyBreadcrumb:{skip:!0}}).state("messages.compose",{url:"/message/compose",params:{action:"new",message:null},data:{title:"New Message"},templateUrl:"app/messages/message-compose.html",controller:"MessageComposeCtrl",ncyBreadcrumb:{skip:!0}})}]),angular.module("everywordApp").controller("BooksCtrl",["$scope","$state","testament","BibleService",function(a,b,c,d){a.testament=c,a.testamentTitle=d.getTestament(a.testament),a.books=[],a.errors={},d.getBooks(a.testament).then(function(b){a.books=b})["catch"](function(b){a.errors.other=b.message})}]),angular.module("everywordApp").controller("ChapterCtrl",["$scope","$stateParams","BibleService",function(a,b,c){a.testament=b.testament,a.book=b.book,a.chapters=[],c.getChapters(a.testament,a.book).then(function(b){a.chapters=b})["catch"](function(b){a.errors.other=b.message})}]),angular.module("everywordApp").controller("AnnotationsCtrl",["$scope","$http","$q","$stateParams","$window","$location","$anchorScroll","$parse","socket","Auth","ProgressBar","MessageService",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(b){return"comments"===b?a.model.comments:"media"==b?a.model.media:"references"===b?a.model.references:null}function n(a){for(var c,d=/(?:^|\s)(?:#)([a-zA-Z\d]+)/gm,e=[];c=d.exec(a);)e.push("#"+c[1]);for(var f=0;f<e.length;f++){var g=e[f];b.post("/api/tags",{user:o.currentUser._id,tag:g,date:new Date}).success(function(a){console.log("tag added")})}}a.model={comments:[],newComment:"",verseSelected:null,privateComment:!1,references:[],referenceLink:"",referenceDescription:"",media:[],groupOnly:!1,selectedGroup:null};var o=a.model;o.verseSelected=a.verse,o.currentUser=a.user,a.openAnnotation=!1,a.tabs=[{title:"Footnotes",image:"../../../assets/images/9e0b5b1c.blue_footnote.png",content:"app/reading/scripture/partials/footnotes.html",gotData:!1,action:function(b){return a.showFootnotes(b)}},{title:"Comments",image:"../../../assets/images/f8b8b244.blue_comments.png",content:"app/reading/scripture/partials/comment.html",active:!0,gotData:!1,action:function(b){return a.showComments(b)}},{title:"References",image:"../../../assets/images/0916789b.blue_references.png",content:"app/reading/scripture/partials/references.html",gotData:!1,action:function(b){return a.showReferences(b)}},{title:"Media",image:"../../../assets/images/967a360a.blue_videos.png",content:"app/reading/scripture/partials/media.html",gotData:!1,action:function(b){return a.showMedia(b)}}],a.fIds=a.following.map(function(a){return a._id}),a.groupIds=a.groups.map(function(a){return a._id}),a.tabChanged=function(){var b=a.active();b.action(b.gotData)},a.active=function(){return a.tabs.filter(function(a){return a.active})[0]},a.annotationCounts=function(c){return b.post("/api/annotations/"+a.book+"/"+a.chapter+"/"+c+"/count/"+o.currentUser._id,{groups:a.groupIds})},a.getCount=function(a){if(o.verseSelected){var b=o.verseSelected[a.title.toLowerCase()+"Count"];return b}return 0},a.getAnnoCount=function(a){var b=a.commentCount||0,c=a.referenceCount||0,d=a.mediaCount||0;return b+c+d},a.showAnnotations=function(b){if(o.newComment="",b){a.openAnnotation=!0;var c=a.active();c&&c.action(!1);for(var c in a.tabs)a.tabs[c].gotData=!1,a.tabs[c].annoCount=a.getCount(a.tabs[c])}else{a.openAnnotation=!1;for(var c in a.tabs)a.tabs[c].gotData=!1}},a.showFootnotes=function(c){c||(o.footnotes=[],b.post("/api/annotations/"+a.book+"/"+a.chapter+"/"+o.verseSelected.verse+"/footnotes",{version:a.currentVersion,testament:a.testament}).success(function(b){o.verseSelected.annotationId=b._id||void 0;var c=a.active();c&&(c.gotData=!0),o.footnotes=[].concat(b.footnotes)}))},a.showComments=function(c){c||(o.comments=[],b.get("/api/annotations/"+a.book+"/"+a.chapter+"/"+o.verseSelected.verse+"/comments").success(function(b){if(b.comments)for(var c in b.comments){var d=b.comments[c];o.comments.push(d)}o.verseSelected.annotationId=b._id||void 0;var e=a.active();e&&(e.gotData=!0)}))},a.showReferences=function(c){c||(o.references=[],o.referenceLink="",o.referenceDescription="",b.get("/api/annotations/"+a.book+"/"+a.chapter+"/"+o.verseSelected.verse+"/references").success(function(b){if(b.references)for(var c in b.references){var d=b.references[c];o.references.push(d)}o.verseSelected.annotationId=b._id||void 0;var e=a.active();e&&(e.gotData=!0)}))},a.showMedia=function(c){c||(o.media=[],b.get("/api/annotations/"+a.book+"/"+a.chapter+"/"+o.verseSelected.verse+"/media").success(function(b){if(b.media)for(var c in b.media){var d=b.media[c];d.image&&(d.url=d.image.url),o.media.push(d)}o.verseSelected.annotationId=b._id||void 0;var e=a.active();e&&(e.gotData=!0)}))},a.addComment=function(c){console.log(o.newComment+" added");var d=o.currentUser;n(o.newComment),d&&b.post("/api/comments",{user:d._id,text:o.newComment,date:new Date,isPrivate:c,group:o.selectedGroup}).success(function(c){o.comments.push(c);var d=o.comments.map(function(a){return a._id});o.verseSelected.annotationId?b.put("/api/annotations/"+o.verseSelected.annotationId,{book:a.book,chapter:a.chapter,verse:o.verseSelected.verse,comments:d}).success(function(){p(o.verseSelected)}):b.post("/api/annotations",{book:a.book,chapter:a.chapter,verse:o.verseSelected.verse,comments:d}).success(function(a){o.verseSelected.annotationId=a._id,p(o.verseSelected)})}),console.log("Save "+o.newComment),o.newComment=""},a.addRemark=function(a,b){console.log("Send "+a);var c=o.currentUser;c&&(l.addMessage({to:b.user._id,from:c._id,subject:"Comment Remark",body:'I made following remark on your comment "<em>'+b.text+'</em>":<br/><strong>'+a+"</strong><br/>Do you accept?",hasAction:!0,action:{requestType:"POST",url:"/api/remarks/",requestBody:{user:c._id,remark:a,comment:b._id}}}),l.sendEmail(b.user.email,c,{subject:"Comment Remark",message:b.user.name+' made following remark on your comment "<em>'+b.text+'</em>":<br/><strong>'+a+"</strong><br/>"}))},a.addReference=function(){console.log(o.referenceLink+" added");var c=o.currentUser;c&&b.post("/api/references",{user:c._id,url:o.referenceLink,description:o.referenceDescription}).success(function(c){o.references.push(c);var d=o.references.map(function(a){return a._id});o.verseSelected.annotationId?b.put("/api/annotations/"+o.verseSelected.annotationId,{book:a.book,chapter:a.chapter,verse:o.verseSelected.verse,references:d}).success(function(){p(o.verseSelected)}):b.post("/api/annotations",{book:a.book,chapter:a.chapter,verse:o.verseSelected.verse,references:d}).success(function(a){o.verseSelected.annotationId=a._id,p(o.verseSelected)})}),o.referenceLink="",o.referenceDesciption=""},a.addMedia=function(c,d){console.log(c.name+" added");var e=o.currentUser,f=function(c){c.image&&(c.url=c.image.url),o.media.push(c);var d=o.media.map(function(a){return a._id});o.verseSelected.annotationId?b.put("/api/annotations/"+o.verseSelected.annotationId,{book:a.book,chapter:a.chapter,verse:o.verseSelected.verse,media:d}).success(function(){p(o.verseSelected)}):b.post("/api/annotations",{book:a.book,chapter:a.chapter,verse:o.verseSelected.verse,media:d}).success(function(a){o.verseSelected.annotationId=a._id,p(o.verseSelected)})};if(e){var g=new FormData;console.log("media url length: "+c.url.length),g.append("url",c.url),g.append("name",c.name),g.append("description",c.description),g.append("type",c.type),g.append("user",e._id);var h={method:"POST",url:"/api/media",data:g,headers:{"Content-Type":void 0}};b(h).success(function(a){f(a)}).error(function(a){d(a)})}console.log("Save "+c.name)},a.deleteAnnotation=function(c,d){var e=m(d),f=e?e.indexOf(c):-1;f>-1&&e.splice(f,1);var g=[c._id],h={book:a.book,chapter:a.chapter,verse:o.verseSelected.verse};h[d.valueOf()]=g,h.remove=!0,o.verseSelected.annotationId&&b.put("/api/annotations/"+o.verseSelected.annotationId,h).success(function(){p(o.verseSelected)}),o.newComment="",o.referenceLink="",o.referenceDescription=""},a.updateAnnotation=function(b,c,d){var e=o.currentUser;if(e){var f=m(d),g=f?f.indexOf(b):-1;g>-1&&(f[g]=c);var h=[c._id],i={book:a.book,chapter:a.chapter,verse:o.verseSelected.verse};i[d.valueOf()]=h}console.log("Save "+c),o.newComment="",o.referenceLink="",o.referenceDescription=""};var p=function(c){a.annotationCounts(c.verse).success(function(d){c.commentsCount=d.commentCount,c.referencesCount=d.referenceCount,c.mediaCount=d.mediaCount,c.annoCount=d.commentCount+d.referenceCount+d.mediaCount;var e=a.active();e&&(e.annoCount=a.getCount(e)),0==c.annoCount&&b["delete"]("/api/annotations/"+c.annotationId)}),a.updateCallback()(c)};a.isViewable=function(b){return b.isPrivate?b.group?-1!==a.groupIds.indexOf(b.group):b.isPrivate&&b.user._id===o.currentUser._id:!0},a.showGroups=function(b){var d=b||angular.noop;a.groupSelected=c.defer();var f=angular.element(e.document).find("#group-menu");f&&f.width(250),a.groupSelected.promise.then(d)},a.hideGroups=function(b){var c=angular.element(e.document).find("#group-menu");c&&c.width(0),a.groupSelected&&a.groupSelected.resolve(b)}}]),angular.module("everywordApp").directive("ewAnnotations",["$compile","$templateRequest",function(a,b){return{scope:{selected:"=",book:"=",chapter:"=",verse:"=",user:"=",following:"=",groups:"=",updateCallback:"&?",deleteCallback:"&?",likeCallback:"&?"},controller:"AnnotationsCtrl",templateUrl:"app/reading/scripture/annotations/annotations.html",restrict:"EA",link:function(a,b,c,d){a.$watch("selected",function(b){a.showAnnotations(b)})}}}]),angular.module("everywordApp").directive("ewCommentForm",function(){return{templateUrl:"app/reading/scripture/comments/comment-form.html",restrict:"EA",scope:{user:"=",showGroupMenu:"&",newComment:"=",addComment:"&"},controller:["$scope","$sce","$uibModal","CreateAccountService",function(a,b,c,d){a.groupOnly=!1,a.privateComment=!1,a.showGroups=!1,a.groupFootnote="Select Group",a.add=function(){"guest"===a.user.role?d.showCreateAccountDialog(function(b){console.log("account created: "+b.name),a.user=b}):a.addComment()(a.privateComment)},a.toggleVisibility=function(b,c){c?a.showGroupMenu()(function(b){a.groupOnly=Boolean(b),a.privateComment=Boolean(b),a.groupFootnote=b?b.name:"Select Group"}):a.groupFootnote="Select Group",a.privateComment=b,a.groupOnly=c}}]}}),angular.module("everywordApp").directive("ewComment",function(){return{scope:{comment:"=",user:"=",following:"=",updateCallback:"&?",deleteCallback:"&?",likeCallback:"&?"},controller:["$scope","$http","MessageService","CreateAccountService",function(a,b,c,d){function e(c){
for(var d,e=/(?:^|\s)(?:#)([a-zA-Z\d]+)/gm,f=[];d=e.exec(c);)f.push("#"+d[1]);for(var g=0;g<f.length;g++){var h=f[g];b.post("/api/tags",{user:a.currentUser._id,tag:h,date:new Date}).success(function(a){console.log("tag added")})}}a.fIds=a.following.map(function(a){return a._id}),a.remarkForm={content:null,isShowing:!1},a.isEditing=!1,a.editComment={isPrivate:a.comment.isPrivate,text:a.comment.text},a.toggleRemarkForm=function(){f.content="",f.isShowing=!f.isShowing};var f=a.remarkForm;a.toggleEditComment=function(){a.isEditing=!a.isEditing},a.cancelEditComment=function(){a.isEditing=!1,a.editComment.text=a.comment.text},a.isFollowing=function(b){return null!==b&&-1!==a.fIds.indexOf(b._id)},a.follow=function(c){var d=a.fIds;d.push(c._id),b.put("/api/homebases/"+a.user._id,{following:d}).success(function(a){console.log("Successfully updated Homebase "+a._id)})},a.like=function(){a.user&&"guest"!==a.user.role?a.user&&b.put("/api/comments/"+a.comment._id+"/like",{user:a.user._id,comment:a.comment._id}).success(function(b){a.comment=b,console.log("Successfully liked comment "+b._id),a.likeCallback&&a.likeCallback()(b),c.sendEmail(b.user.email,a.user,{subject:"Comment Liked",message:a.user.name+' liked your comment "<em>'+b.text+'</em>":<br/>'})}):d.showCreateAccountDialog(function(b){console.log("account created: "+b.name),a.user=b})},a.addRemark=function(){if(a.user&&"guest"!==a.user.role){if(console.log("Send "+e),a.user&&f.content){var e=f.content,g=a.comment;g.user._id!==a.user._id?(c.addMessage({to:g.user._id,from:a.user._id,subject:"Comment Remark",body:'I made following remark on your comment "<em>'+g.text+'</em>":<br/><strong>'+e+"</strong><br/>Do you accept?",hasAction:!0,action:{requestType:"POST",url:"/api/remarks/",requestBody:{user:a.user._id,remark:e,comment:g._id}}}).then(function(b){a.remarkSent=!0,console.log("remark sent: "+a.remarkSent),setTimeout(function(){a.remarkSent=!1,console.log("remark sent: "+a.remarkSent)},2e3)}),c.sendEmail(g.user.email,a.user,{subject:"Comment Remark",message:a.user.name+' remarked on your comment "<em>'+g.text+'</em>":<br/>'})):b.post("/api/remarks/",{user:a.user._id,remark:e,comment:g._id}).success(function(a){}),a.toggleRemarkForm(),f.content=null}}else d.showCreateAccountDialog(function(b){console.log("account created: "+b.name),a.user=b})},a.acknowledge=function(){a.remarkSent=!1},a.deleteComment=function(c){b["delete"]("/api/comments/"+c._id).success(function(b){a.deleteCallback&&a.deleteCallback()(c,"comments")})},a.updateComment=function(c){var d=a.editComment;a.user&&b.put("/api/comments/"+c._id,{user:a.user._id,text:d.text,date:new Date,isPrivate:d.isPrivate}).success(function(b){a.updateCallback&&a.updateCallback()(c,b,"comments"),a.comment=b,e(d.text),a.isEditing=!1})}}],templateUrl:"app/reading/scripture/comments/comments.html",restrict:"EA",link:function(a,b,c){a.includeHeading="undefined"!=typeof c.withHeading,a.fulltext="undefined"!=typeof c.fulltext}}}),angular.module("everywordApp").directive("ewMediaItem",function(){return{scope:{media:"=",user:"=",following:"=",updateCallback:"&?",deleteCallback:"&?",likeCallback:"&?"},controller:["$scope","$http","MessageService","CreateAccountService",function(a,b,c,d){function e(c){for(var d,e=/(?:^|\s)(?:#)([a-zA-Z\d]+)/gm,f=[];d=e.exec(c);)f.push("#"+d[1]);for(var g=0;g<f.length;g++){var h=f[g];b.post("/api/tags",{user:a.currentUser._id,tag:h,date:new Date}).success(function(a){console.log("tag added")})}}a.fIds=a.following.map(function(a){return a._id}),a.remarkForm={content:null,isShowing:!1},a.isEditing=!1,a.editComment={isPrivate:a.media.isPrivate,text:a.media.description},a.toggleRemarkForm=function(){f.content="",f.isShowing=!f.isShowing};var f=a.remarkForm;a.toggleEditComment=function(){a.isEditing=!a.isEditing},a.cancelEditComment=function(){a.isEditing=!1,a.editComment.text=a.media.description},a.isFollowing=function(b){return-1!==a.fIds.indexOf(b._id)},a.follow=function(c){var d=a.fIds;d.push(c._id),b.put("/api/homebases/"+a.user._id,{following:d}).success(function(a){console.log("Successfully updated Homebase "+a._id)})},a.like=function(){a.user&&"guest"!==a.user.role?a.user&&(b.put("/api/media/"+a.media._id+"/like",{user:a.user._id,media:a.media._id}).success(function(b){a.media=b,console.log("Successfully liked media "+b._id),a.likeCallback&&a.likeCallback()(b)}),c.sendEmail(med.user.email,a.user,{subject:"Comment Liked",message:a.user.name+' liked your comment "<em>'+med.description+'</em>":<br/>'})):d.showCreateAccountDialog(function(b){console.log("account created: "+b.name),a.user=b})},a.addRemark=function(){if(a.user&&"guest"!==a.user.role){if(console.log("Send "+e),a.user&&f.content){var e=f.content,g=a.media;g.user._id!==a.user._id?(c.addMessage({to:g.user._id,from:a.user._id,subject:"Media Remark",body:'I made following remark on your media entry "<em>'+g.description+'</em>":<br/><strong>'+e+"</strong><br/>Do you accept?",hasAction:!0,action:{requestType:"POST",url:"/api/remarks/",requestBody:{user:a.user._id,remark:e,media:g._id}}}).then(function(b){a.remarkSent=!0,console.log("remark sent: "+a.remarkSent),setTimeout(function(){a.remarkSent=!1,console.log("remark sent: "+a.remarkSent)},2e3)}),c.sendEmail(g.user.email,a.user,{subject:"Media Remark",message:a.user.name+' remarked on your media entry "<em>'+g.description+'</em>":<br/>'})):b.post("/api/remarks/",{user:a.user._id,remark:e,media:g._id}).success(function(a){}),a.toggleRemarkForm(),f.content=null}}else d.showCreateAccountDialog(function(b){console.log("account created: "+b.name),a.user=b})},a.acknowledge=function(){a.remarkSent=!1},a.deleteComment=function(c){b["delete"]("/api/media/"+c._id).success(function(b){a.deleteCallback&&a.deleteCallback()(c,"media")})},a.updateComment=function(c){var d=a.editComment;a.user&&b.put("/api/media/"+c._id,{user:a.user._id,description:d.text,date:new Date,isPrivate:d.isPrivate}).success(function(b){a.updateCallback&&a.updateCallback()(c,b,"media"),a.media=b,e(d.text),a.isEditing=!1})}}],templateUrl:"app/reading/scripture/media/media-item.html",restrict:"EA",link:function(a,b,c){a.includeHeading="undefined"!=typeof c.withHeading,a.fullImage="undefined"!=typeof c.fullImage}}}),angular.module("everywordApp").directive("ewMedia",function(){return{templateUrl:"app/reading/scripture/media/media.html",restrict:"EA",scope:{media:"=",save:"&",currentUser:"="},controller:["$scope","$http","$document","$sce","$uibModal","CreateAccountService",function(a,b,c,d,e,f){b.get("/api/homebases/"+a.currentUser._id+"/following").success(function(b){a.following=b});var g=c[0];a.inputUrl=null,a.validUrl=!0,a.description="",a.showMenu=!1,a.toggleMenu=function(){var a=$("#action")[0],b=$("#action").parent();b.hasClass("open")?(b.trigger($.Event("hide.bs.dropdown",{relatedTarget:a})),b.removeClass("open").trigger("hidden.bs.dropdown",a)):(b.trigger($.Event("show.bs.dropdown",{relatedTarget:a})),b.addClass("open").trigger("shown.bs.dropdown",a))},a.showCommentDialog=function(b){var c=e.open({animation:!0,templateUrl:"commentTemplate.html",controller:"MediaCommentCtrl",size:"sm"});c.result.then(function(c){a.description=c,b()},function(){console.info("Modal dismissed at: "+new Date)})},a.handleUrlDrop=function(b){if(a.currentUser&&"guest"!==a.currentUser.role){b.stopPropagation(),b.preventDefault();var c=b.dataTransfer.getData("text/uri-list"),d=b.dataTransfer.files;a.showCommentDialog(function(){if(d&&d.length>0)return void j(d);var e=c&&c.length>0?c:null,f=e||b.target.medialUrl||a.mediaUrl;if(a.validUrl=a.validateUrl(f),a.validUrl){var g={url:f,type:"video",description:a.description};a.save()(g)}})}else f.showCreateAccountDialog(function(b){console.log("account created: "+b.name),a.currentUser=b})},a.addUrl=function(){a.currentUser&&"guest"!==a.currentUser.role?a.showCommentDialog(function(){if(a.validUrl=a.validateUrl(a.inputUrl),a.validUrl){a.inputUrl=a.inputUrl.replace("watch","embed");var b=(d.trustAsResourceUrl(a.inputUrl),{url:a.inputUrl,description:a.description,type:"video"});a.save()(b),a.inputUrl=""}}):f.showCreateAccountDialog(function(b){console.log("account created: "+b.name),a.currentUser=b})},a.validateUrl=function(a){if(void 0!=a||""!=a){var b=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=|\?v=)([^#\&\?]*).*/,c=a.match(b);return c&&11==c[2].length?!0:!1}};var h=function(a){a.stopPropagation(),a.preventDefault(),a.dataTransfer.dropEffect="copy"};a.handlePaste=function(){console.log("Url pasted "+a.mediaUrl)};var i=function(b){if(a.currentUser&&"guest"!==a.currentUser.role){var c=b.target.files;a.showCommentDialog(function(){j(c)})}else f.showCreateAccountDialog(function(b){console.log("account created: "+b.name),a.currentUser=b})},j=function(b){for(var c,d=0;c=b[d];d++)if(c.type.match("image.*")){var e=new FileReader;e.onload=function(b){return function(c){var d={data:b,type:b.type,url:c.target.result,name:b.name,description:a.description};a.save()(d,function(){a.errorOnSave=!0}),a.toggleMenu()}}(c),e.readAsDataURL(c)}},k=g.getElementById("drop_zone");k.addEventListener("dragover",h,!1),k.addEventListener("drop",a.handleUrlDrop,!1),g.getElementById("files").addEventListener("change",i,!1)}]}}).controller("MediaCommentCtrl",["$scope","$uibModalInstance",function(a,b){a.description="",a.ok=function(){b.close(a.description)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("everywordApp").directive("ewReference",function(){return{scope:{reference:"=",user:"=",following:"=",updateCallback:"&?",deleteCallback:"&?",likeCallback:"&?"},controller:["$scope","$http","MessageService","CreateAccountService",function(a,b,c,d){a.fIds=a.following.map(function(a){return a._id}),a.remarkForm={content:null,isShowing:!1},a.isEditing=!1,a.editReference={isPrivate:a.reference.isPrivate,text:a.reference.description,link:a.reference.url},a.toggleRemarkForm=function(){e.content="",e.isShowing=!e.isShowing};var e=a.remarkForm;a.toggleEditReference=function(){a.isEditing=!a.isEditing},a.cancelEditReference=function(){a.isEditing=!1,a.editReference.text=a.reference.description,a.editReference.link=a.reference.url},a.isFollowing=function(b){return-1!==a.fIds.indexOf(b._id)},a.follow=function(c){var d=a.fIds;d.push(c._id),b.put("/api/homebases/"+a.user._id,{following:d}).success(function(a){console.log("Successfully updated Homebase "+a._id)})},a.like=function(){a.user&&"guest"!==a.user.role?a.user&&b.put("/api/references/"+a.reference._id+"/like",{user:a.user._id,reference:a.reference._id}).success(function(b){a.reference=b,console.log("Successfully liked reference "+b._id),a.likeCallback&&a.likeCallback()(b),c.sendEmail(b.user.email,a.user,{subject:"Reference Liked",message:a.user.name+' liked your reference "<em>'+b.description+'</em>":<br/>'})}):d.showCreateAccountDialog(function(b){console.log("account created: "+b.name),a.user=b})},a.addRemark=function(){if(a.user&&"guest"!==a.user.role){if(console.log("Send "+f),a.user&&e.content){var f=e.content,g=a.reference;g.user._id!==a.user._id?(c.addMessage({to:g.user._id,from:a.user._id,subject:"Reference Remark",body:'I made following remark on your reference entry "<em>'+g.description+'</em>":<br/><strong>'+f+"</strong><br/>Do you accept?",hasAction:!0,action:{requestType:"POST",url:"/api/remarks/",requestBody:{user:a.user._id,remark:f,reference:g._id}}}).then(function(b){a.remarkSent=!0,console.log("remark sent: "+a.remarkSent),setTimeout(function(){a.remarkSent=!1,console.log("remark sent: "+a.remarkSent)},2e3)}),c.sendEmail(g.user.email,a.user,{subject:"Reference Remark",message:a.user.name+' remarked on your reference "<em>'+g.description+'</em>":<br/>'})):b.post("/api/remarks/",{user:a.user._id,remark:f,reference:g._id}).success(function(a){}),a.toggleRemarkForm(),e.content=null}}else d.showCreateAccountDialog(function(b){console.log("account created: "+b.name),a.user=b})},a.acknowledge=function(){a.remarkSent=!1},a.deleteReference=function(c){b["delete"]("/api/references/"+c._id).success(function(b){a.deleteCallback&&a.deleteCallback()(c,"references")})},a.updateReference=function(c){console.log(c+" updated");var d=a.editReference;a.user&&b.put("/api/references/"+c._id,{url:d.link,description:d.text,date:new Date,isPrivate:d.isPrivate}).success(function(b){a.updateCallback&&a.updateCallback()(c,b,"references"),a.reference=b,a.isEditing=!1})}}],templateUrl:"app/reading/scripture/references/reference.html",restrict:"EA",link:function(a,b,c){a.includeHeading="undefined"!=typeof c.withHeading}}}),angular.module("everywordApp").controller("ScriptureCtrl",["$scope","$http","$q","$stateParams","$window","$location","$anchorScroll","$parse","socket","Auth","ProgressBar","MessageService","CreateAccountService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){b.get("/api/homebases/"+q.currentUser._id).success(function(c){console.log("response"+c),a.homebase=c.homebase,b.get("/api/homebases/"+q.currentUser._id+"/following").success(function(b){a.following=b}),b.get("/api/homebases/"+q.currentUser._id+"/likes").success(function(a){q.currentUser.likes=a||[]}),b.get("/api/homebases/"+q.currentUser._id+"/groups").success(function(c){a.groups=c.groups||[],a.groupIds=c.groups.map(function(a){return a._id}),b.get("/api/biblesvc/"+a.book+"/"+a.chapter).success(function(a){r(a)}).error(function(a){setTimeout(function(){k.hide()},1e3)})})})}function o(a){for(var c,d=/(?:^|\s)(?:#)([a-zA-Z\d]+)/gm,e=[];c=d.exec(a);)e.push("#"+c[1]);for(var f=0;f<e.length;f++){var g=e[f];b.post("/api/tags",{user:q.currentUser._id,tag:g,date:new Date}).success(function(a){console.log("tag added")})}}function p(b){return"comments"===b?a.model.comments:"media"==b?a.model.media:"references"===b?a.model.references:null}k.show(),a.loading=!0,a.model={comments:[],newComment:"",verseSelected:null,privateComment:!1,references:[],referenceLink:"",referenceDescription:"",media:[],groupOnly:!1,selectedGroup:null,currentUser:null};var q=a.model;a.openAnnotation=!1,q.currentUser=j.getCurrentUser(),a.testament=d.testament,a.book=d.book,a.chapter=d.chapter,d.verse&&(a.highlightedVerse=parseInt(d.verse)),a.currentVersion="kjv",a.tabs=[{title:"Footnotes",image:"../../../assets/images/9e0b5b1c.blue_footnote.png",content:"app/reading/scripture/partials/footnotes.html",gotData:!1,action:function(b){return a.showFootnotes(b)}},{title:"Comments",image:"../../../assets/images/f8b8b244.blue_comments.png",content:"app/reading/scripture/partials/comment.html",active:!0,gotData:!1,action:function(b){return a.showComments(b)}},{title:"References",image:"../../../assets/images/0916789b.blue_references.png",content:"app/reading/scripture/partials/references.html",gotData:!1,action:function(b){return a.showReferences(b)}},{title:"Media",image:"../../../assets/images/967a360a.blue_videos.png",content:"app/reading/scripture/partials/media.html",gotData:!1,action:function(b){return a.showMedia(b)}}],q.currentUser._id?n():setTimeout(function(){j.isLoggedInAsync(function(a){a?(q.currentUser=j.getCurrentUser(),n()):j.login({email:"guest@guest.com",password:"guest"}).then(function(){q.currentUser=j.getCurrentUser(),setTimeout(n,2e3)})["catch"](function(a){})})},10);var r=(angular.element(e.document).find("div.verses"),function(b){a.verses=[],a.prevChapter=b.prev,a.nextChapter=b.next;var c=0,d=function(b){a.annotationCounts(b[c].verse).success(function(e){console.log("Loading..."),e?(b[c].commentsCount=e.commentCount,b[c].referencesCount=e.referenceCount,b[c].mediaCount=e.mediaCount,b[c].annoCount=e.commentCount+e.referenceCount+e.mediaCount):b[c].annoCount=0,a.verses.push(b[c]),c++,c<b.length?d(b):(a.loading=!1,k.hide(),console.log("done loading"))}).error(function(a){k.hide()})};d(b.verses)});a.tabChanged=function(){var b=a.active();b.action(b.gotData)},a.active=function(){return a.tabs.filter(function(a){return a.active})[0]},a.annotationCounts=function(c){return b.post("/api/annotations/"+a.book+"/"+a.chapter+"/"+c+"/count/"+q.currentUser._id,{groups:a.groupIds})},a.getCount=function(a){if(q.verseSelected){var b=q.verseSelected[a.title.toLowerCase()+"Count"];return b}return 0},a.getAnnoCount=function(a){var b=a.commentCount||0,c=a.referenceCount||0,d=a.mediaCount||0;return b+c+d},a.getChapter=function(c){k.show(),a.loading=!0,a.highlightedVerse=null,b.get("/api/biblesvc/"+a.currentVersion+"/"+c.book+"/"+c.chapter).success(function(b){a.book=c.book,a.chapter=c.chapter,r(b)})},a.getVersion=function(c){k.show(),a.loading=!0,a.currentVersion=c,q.verseSelected=null,"NET"!==c?b.get("/api/biblesvc/"+c+"/"+a.book+"/"+a.chapter).success(function(a){r(a)}):(a.showData=function(b){console.log(JSON.stringify(b)),a.verses=b},b.jsonp("http://labs.bible.org/api/?passage="+a.book+"+"+a.chapter+"&type=json&callback=myCallback"))},a.scrollToVerse=function(b){a.highlightedVerse=null;var c="#verse"+b.verse;$("html, body").animate({scrollTop:$(c).offset().top-100},200)},a.showAnnotations=function(b,c){if(q.newComment="",q.verseSelected===b){q.verseSelected=null,a.openAnnotation=!1;for(var d in a.tabs)a.tabs[d].gotData=!1}else{q.verseSelected=b,a.openAnnotation=!0;var d=a.active();d&&d.action(!1);for(var d in a.tabs)a.tabs[d].gotData=!1,a.tabs[d].annoCount=a.getCount(a.tabs[d])}},a.showFootnotes=function(c){c||(q.footnotes=[],b.post("/api/annotations/"+a.book+"/"+a.chapter+"/"+q.verseSelected.verse+"/footnotes",{version:a.currentVersion,testament:a.testament}).success(function(b){q.verseSelected.annotationId=b._id||void 0;var c=a.active();c&&(c.gotData=!0),q.footnotes=[].concat(b.footnotes)}))},a.isViewable=function(b){return b.isPrivate?b.group?-1!==a.groupIds.indexOf(b.group):b.isPrivate&&b.user._id===q.currentUser._id:!0},a.showComments=function(c){c||(q.comments=[],b.get("/api/annotations/"+a.book+"/"+a.chapter+"/"+q.verseSelected.verse+"/comments").success(function(b){if(b.comments)for(var c in b.comments){var d=b.comments[c];q.comments.push(d)}q.verseSelected.annotationId=b._id||void 0;var e=a.active();e&&(e.gotData=!0)}))},a.showReferences=function(c){c||(q.references=[],q.referenceLink="",q.referenceDescription="",b.get("/api/annotations/"+a.book+"/"+a.chapter+"/"+q.verseSelected.verse+"/references").success(function(b){if(b.references)for(var c in b.references){var d=b.references[c];q.references.push(d)}q.verseSelected.annotationId=b._id||void 0;var e=a.active();e&&(e.gotData=!0)}))},a.showMedia=function(c){c||(q.media=[],b.get("/api/annotations/"+a.book+"/"+a.chapter+"/"+q.verseSelected.verse+"/media").success(function(b){if(b.media)for(var c in b.media){var d=b.media[c];d.image&&(d.url=d.image.url),q.media.push(d)}q.verseSelected.annotationId=b._id||void 0;var e=a.active();e&&(e.gotData=!0)}))};var s=function(c){a.annotationCounts(c.verse).success(function(d){c.commentsCount=d.commentCount,c.referencesCount=d.referenceCount,c.mediaCount=d.mediaCount,c.annoCount=d.commentCount+d.referenceCount+d.mediaCount;var e=a.active();e&&(e.annoCount=a.getCount(e)),0==c.annoCount&&b["delete"]("/api/annotations/"+c.annotationId)})};a.addComment=function(c){console.log(q.newComment+" added");var d=q.currentUser;o(q.newComment),d&&b.post("/api/comments",{user:d._id,text:q.newComment,date:new Date,isPrivate:c,group:q.selectedGroup}).success(function(c){q.comments.push(c);var d=q.comments.map(function(a){return a._id});q.verseSelected.annotationId?b.put("/api/annotations/"+q.verseSelected.annotationId,{book:a.book,chapter:a.chapter,verse:q.verseSelected.verse,comments:d}).success(function(){s(q.verseSelected)}):b.post("/api/annotations",{book:a.book,chapter:a.chapter,verse:q.verseSelected.verse,comments:d}).success(function(a){q.verseSelected.annotationId=a._id,s(q.verseSelected)})}),console.log("Save "+q.newComment),q.newComment=""},a.addRemark=function(a,b){console.log("Send "+a);var c=q.currentUser;c&&(l.addMessage({to:b.user._id,from:c._id,subject:"Comment Remark",body:'I made following remark on your comment "<em>'+b.text+'</em>":<br/><strong>'+a+"</strong><br/>Do you accept?",hasAction:!0,action:{requestType:"POST",url:"/api/remarks/",requestBody:{user:c._id,remark:a,comment:b._id}}}),l.sendEmail(b.user.email,c,{subject:"Comment Remark",message:b.user.name+' made following remark on your comment "<em>'+b.text+'</em>":<br/><strong>'+a+"</strong><br/>"}))},a.addReference=function(){if(q.currentUser&&"guest"!==q.currentUser.role){console.log(q.referenceLink+" added");var c=q.currentUser;c&&b.post("/api/references",{user:c._id,url:q.referenceLink,description:q.referenceDescription}).success(function(c){q.references.push(c);var d=q.references.map(function(a){return a._id});q.verseSelected.annotationId?b.put("/api/annotations/"+q.verseSelected.annotationId,{book:a.book,chapter:a.chapter,verse:q.verseSelected.verse,references:d}).success(function(){s(q.verseSelected)}):b.post("/api/annotations",{book:a.book,chapter:a.chapter,verse:q.verseSelected.verse,references:d}).success(function(a){q.verseSelected.annotationId=a._id,s(q.verseSelected)})}),q.referenceLink="",q.referenceDesciption=""}else m.showCreateAccountDialog(function(a){console.log("account created: "+a.name),q.currentUser=a})},a.addMedia=function(c,d){console.log(c.name+" added");var e=q.currentUser,f=function(c){c.image&&(c.url=c.image.url),q.media.push(c);var d=q.media.map(function(a){return a._id});q.verseSelected.annotationId?b.put("/api/annotations/"+q.verseSelected.annotationId,{book:a.book,chapter:a.chapter,verse:q.verseSelected.verse,media:d}).success(function(){s(q.verseSelected)}):b.post("/api/annotations",{book:a.book,chapter:a.chapter,verse:q.verseSelected.verse,media:d}).success(function(a){q.verseSelected.annotationId=a._id,s(q.verseSelected)})};if(e){var g=new FormData;console.log("media url length: "+c.url.length),g.append("url",c.url),g.append("name",c.name),g.append("description",c.description),g.append("type",c.type),g.append("user",e._id);var h={method:"POST",url:"/api/media",data:g,headers:{"Content-Type":void 0}};b(h).success(function(a){f(a)}).error(function(a){d(a)})}console.log("Save "+c.name)},a.deleteAnnotation=function(c,d){var e=p(d),f=e?e.indexOf(c):-1;f>-1&&e.splice(f,1);var g=[c._id],h={book:a.book,chapter:a.chapter,verse:q.verseSelected.verse};h[d.valueOf()]=g,h.remove=!0,q.verseSelected.annotationId&&b.put("/api/annotations/"+q.verseSelected.annotationId,h).success(function(){s(q.verseSelected)}),q.newComment="",q.referenceLink="",q.referenceDescription=""},a.updateAnnotation=function(b,c,d){var e=q.currentUser;if(e){var f=p(d),g=f?f.indexOf(b):-1;g>-1&&(f[g]=c);var h=[c._id],i={book:a.book,chapter:a.chapter,verse:q.verseSelected.verse};i[d.valueOf()]=h}console.log("Save "+c),q.newComment="",q.referenceLink="",q.referenceDescription=""},a.showGroups=function(b){var d=b||angular.noop;a.groupSelected=c.defer();var f=angular.element(e.document).find("#group-menu");f&&f.width(250),a.groupSelected.promise.then(d)},a.hideGroups=function(b){var c=angular.element(e.document).find("#group-menu");c&&c.width(0),a.groupSelected&&a.groupSelected.resolve(b)}}]),angular.module("everywordApp").controller("TagsCtrl",["$scope","$uibModalInstance","tags","mytags",function(a,b,c,d){a.tags=c.data,a.selected={};for(var e=0;e<d.length;e++){var f=d[e];a.selected[f._id]=f}a.selectedIds=d.map(function(a){return a._id}),a.addTag=function(b){a.selected[b._id]=b},a.removeTag=function(b){delete a.selected[b._id]},a.ok=function(){var c=[];for(var d in a.selected)c.push(a.selected[d]);b.close(c)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("everywordApp").config(["$stateProvider",function(a){a.state("tags",{url:"/tags",templateUrl:"app/tags/tags.html",controller:"TagsCtrl"})}]),angular.module("everywordApp").controller("TestamentsCtrl",["$scope",function(a){a.message="Hello"}]),angular.module("everywordApp").factory("BibleService",["$http","$q",function(a,b){var c={};return{getBooks:function(d,e){var f=e||angular.noop,g=b.defer();return a.get("/api/biblesvc/"+d).success(function(a){return c[d]=a,g.resolve(a),f()}).error(function(a){return this.logout(),g.reject(a),f(a)}.bind(this)),g.promise},getChapters:function(a,d){var e=b.defer();if(void 0===c[a])this.getBooks(a).then(function(){var b=c[a].filter(function(a){return a.name===d});e.resolve(b[0].chapters)});else{var f=c[a].filter(function(a){return a.name===d});e.resolve(f[0].chapters)}return e.promise},getTestament:function(a){var b={ot:"Old Testament",nt:"New Testament"};return b[a]}}}]),angular.module("everywordApp").factory("MessageService",["$http","Auth","$q","socket",function(a,b,c,d){var e=b.getCurrentUser,f=b.isLoggedInAsync,g=d.socket,h=[],i=function(){var b=c.defer();return f(function(c){if(c){var d=a.get("/api/messages?user="+e()._id);d.then(function(a){b.resolve(a.data)},function(a){b.resolve([])})}else defereObject.reject([])}),b.promise},j=function(){for(var a in h){var b=h[a];b()}},k=function(){f(function(a){a&&g.on("message"+e()._id+":save",function(a){j()}),j()})};return k(),{getMessages:i,getMessageCount:function(){return a.get("/api/messages/"+e()._id+"/count")},addMessage:function(b){var d=a.post("/api/messages",b),e=c.defer();return d.success(function(a){e.resolve(a)}),e.promise},deleteMessage:function(b){var d=a["delete"]("/api/messages/"+b._id),e=c.defer();return d.success(function(a){e.resolve(a),j()}),e.promise},sendEmail:function(b,c,d){var e={to:b,from:c,url:"www.everywordbible.com",link:"http://www.everywordbible.com"};return e=Object.assign(e,d),a.post("/api/messages/sendEmail",e)},addObserver:function(a){h.push(a)},notify:j,init:k}}]),angular.module("everywordApp").factory("Auth",["$location","$rootScope","$http","User","$cookieStore","$q",function(a,b,c,d,e,f){var g={};return e.get("token")&&(g=d.get()),{login:function(a,b){var h=b||angular.noop,i=f.defer();return c.post("/auth/local",{email:a.email,password:a.password}).success(function(a){return e.put("token",a.token),g=d.get(),i.resolve(a),h()}).error(function(a){return this.logout(),i.reject(a),h(a)}.bind(this)),i.promise},forgotPassword:function(a,b){var d=b||angular.noop,e=f.defer();return c.post("/auth/local/forgot",{email:a.email}).success(function(a){return e.resolve(a),d()}).error(function(a){return e.reject(a),d(a)}.bind(this)),e.promise},resetPassword:function(a,b){var d=b||angular.noop,e=f.defer();return c.post("auth/local/reset",{userid:a.id,password:a.newPassword,token:a.token}).success(function(a){return e.resolve(a),d()}).error(function(a){return this.logout(),e.reject(a),d(a)}.bind(this)),e.promise},logout:function(){e.remove("token"),g={}},createUser:function(a,b){var c=b||angular.noop,e=f.defer();return d.checkEmail(a,function(b){if(b._id){var f={data:{errors:{email:{message:"Email already registered"}}}};return e.reject(f),c(f)}d.save(a,function(b){return e.resolve(b),c(a)},function(a){return this.logout(),e.reject(a),c(a)}.bind(this))}.bind(this)),e.promise},changePassword:function(a,b,c){var e=c||angular.noop;return d.changePassword({id:g._id},{oldPassword:a,newPassword:b},function(a){return e(a)},function(a){return e(a)}).$promise},getCurrentUser:function(){return g},isLoggedIn:function(){return g.hasOwnProperty("role")},isLoggedInAsync:function(a){g.hasOwnProperty("$promise")?g.$promise.then(function(){a(!0)})["catch"](function(){a(!1)}):a(g.hasOwnProperty("role")?!0:!1)},isAdmin:function(){return"admin"===g.role},isGuest:function(){return"guest"===g.role},getToken:function(){return e.get("token")}}}]),angular.module("everywordApp").factory("User",["$resource",function(a){return a("/api/users/:id/:controller",{id:"@_id"},{changePassword:{method:"PUT",params:{controller:"password"}},get:{method:"GET",params:{id:"me"}},query:{method:"GET",isArray:!0},checkEmail:{method:"POST",params:{id:"email"}},show:{method:"GET",isArray:!1}})}]),angular.module("everywordApp").factory("Modal",["$rootScope","$modal",function(a,b){function c(c,d){var e=a.$new();return c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"components/modal/modal.html",windowClass:d,scope:e})}return{confirm:{message:function(a,b,d){b=b||noop;var e;e=c({modal:{dismissable:!0,title:"",html:"<p>"+a+"</p>",buttons:[{classes:"btn-primary",text:"Ok",click:function(a){e.close(a)}},{classes:"btn-default",text:"Cancel",click:function(a){e.dismiss(a)}}]}}),e.result.then(function(a){b.apply(a,d)})}}}}]),angular.module("everywordApp").directive("mongooseError",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){b.on("keydown",function(){return d.$setValidity("mongoose",!0)})}}}),angular.module("everywordApp").controller("NavbarCtrl",["$scope","$state","$location","$http","$interval","Auth","MessageService",function(a,b,c,d,e,f,g){a.menu=[{title:"Home",link:"/main"},{title:"Groups",link:"/groups"},{title:"Following",link:"/following"}],a.isCollapsed=!0,a.isLoggedIn=f.isLoggedIn,a.isAdmin=f.isAdmin,a.isGuest=f.isGuest,a.getCurrentUser=f.getCurrentUser,a.messageCount=0,a.newMessages=!1,a.updateMessageCount=function(b){if(a.isLoggedIn()){var c=a.messageCount;g.getMessageCount().success(function(b){a.messageCount=b,console.log("message count updated"),a.newMessages=a.messageCount>c})}},g.addObserver(a.updateMessageCount),f.isLoggedInAsync(a.updateMessageCount);var h=e(a.updateMessageCount,6e4,0,!1);a.logout=function(){f.logout(),b.go("login")},a.toggleMenu=function(){a.isCollapsed=!a.isCollapsed},a.navigate=function(a){b.go(a)},a.login=function(){f.logout(),b.go("login")},a.signup=function(){f.logout(),b.go("signup")},a.isActive=function(a){return a===c.path()},a.collapseMenu=function(){a.isCollapsed=!0},a.$on("$destroy",function(){h&&(e.cancel(h),h=void 0)})}]),angular.module("everywordApp").factory("ProgressBar",["$rootScope","$uibModal",function(a,b){function c(c,d){var e=a.$new();return c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"components/progressbar/progressbar.html",windowClass:d,scope:e,size:"sm"})}var d=null;return{show:function(a,b){"undefined"==typeof b&&(b={}),"undefined"==typeof a&&(a="Loading"),d=c()},hide:function(){d&&d.dismiss()}}}]),angular.module("everywordApp").factory("socket",["socketFactory",function(a){var b=io("",{path:"/socket.io-client"}),c=a({ioSocket:b});return{socket:c,syncUpdates:function(a,b,d){d=d||angular.noop,c.on(a+":save",function(a){var c=_.find(b,{_id:a._id}),e=b.indexOf(c),f="created";c?(b.splice(e,1,a),f="updated"):b.push(a),d(f,a,b)}),c.on(a+":remove",function(a){var c="deleted";_.remove(b,{_id:a._id}),d(c,a,b)})},syncFeedUpdates:function(a,b,d){d=d||angular.noop,c.on(a+":save",function(a){var c=_.find(b,{_id:a._id}),e=(b.indexOf(c),"created");c&&(e="updated"),d(e,b,c,a)}),c.on(a+":remove",function(a){var c="deleted";_.remove(b,{_id:a._id}),d(c,b,a)})},unsyncUpdates:function(a){c.removeAllListeners(a+":save"),c.removeAllListeners(a+":remove")},syncQueries:function(a,b,d){d=d||angular.noop,c.on(a,function(a){a&&b.push(a),d(a,b)})}}}]),angular.module("everywordApp").run(["$templateCache",function(a){a.put("app/account/createAccount.tpl.html",'<div class=modal-header><button type=button class=close ng-click=$dismiss()>&times;</button><h4 class=modal-title>Create Account</h4></div><div class=modal-body><div class="alert alert-info">You must be logged in to add comments, remarks, videos, images, and likes. Please log in below or if you don\'t have an account, creating one is easy and only takes a few moments.</div><div class=container-fluid><div class="container-content-middle p-t"><form ng-if=!showSignupForm class="m-x-auto text-center app-login-form" name=form ng-submit=login(form) novalidate><h1 class="app-brand m-b">Login</h1><div class=form-group><input placeholder=Email type=email name=email class=form-control ng-model=user.email required></div><div class="form-group m-b-md"><input placeholder=Password type=password name=password class=form-control ng-model=user.password></div><div class="form-group has-error"><p class=help-block ng-show="!passwordForgotten && form.email.$error.required && !user.password && submitted">Please enter your email and password.</p><p class=help-block ng-show="(passwordForgotten && form.email.$error.required) || (form.email.$error.email && submitted)">Please enter a valid email.</p><p class=help-block>{{ errors.other }}</p></div><div class=m-b><button class="btn btn-primary" type=submit>Login</button> <button class="btn btn-default" ng-click=signup()>Register</button></div><a href=# ng-click="passwordForgotten=true;forgotPassword(form)">Forgot Password?</a><!--         <hr>\n        <div>\n          <a class="btn btn-facebook" href="" ng-click="loginOauth(\'facebook\')">\n            <i class="fa fa-facebook"></i> Connect with Facebook\n          </a>\n          <a class="btn btn-google-plus" href="" ng-click="loginOauth(\'google\')">\n            <i class="fa fa-google-plus"></i> Connect with Google+\n          </a>\n        </div>\n --></form><form ng-if=showSignupForm class="m-x-auto text-center app-login-form" name=signupForm ng-submit=register(signupForm) novalidate><h1>Sign up</h1><div class=form-group ng-class="{ \'has-success\': signupForm.name.$valid && submitted,\n                                            \'has-error\': signupForm.name.$invalid && submitted }"><!--           <label>Name</label> --><input placeholder=Name name=name class=form-control ng-model=user.name required><p class=help-block ng-show="signupForm.name.$error.required && submitted">A name is required</p></div><div class=form-group ng-class="{ \'has-success\': signupForm.email.$valid && submitted,\n                                            \'has-error\': signupForm.email.$invalid && submitted }"><!--           <label>Email</label> --><input placeholder=Email type=email name=email class=form-control ng-model=user.email required mongoose-error><p class=help-block ng-show="signupForm.email.$error.email && submitted">Doesn\'t look like a valid email.</p><p class=help-block ng-show="signupForm.email.$error.required && submitted">What\'s your email address?</p><p class=help-block ng-show=signupForm.email.$error.mongoose>{{ errors.email }}</p></div><div class="form-group m-b-md" ng-class="{ \'has-success\': signupForm.password.$valid && submitted,\n                                            \'has-error\': signupForm.password.$invalid && submitted }"><!--           <label>Password</label> --><input placeholder=Password type=password name=password class=form-control ng-model=user.password ng-minlength=3 required mongoose-error><p class=help-block ng-show="(signupForm.password.$error.minlength || signupForm.password.$error.required) && submitted">Password must be at least 3 characters.</p><p class=help-block ng-show=signupForm.password.$error.mongoose>{{ errors.password }}</p></div><div class=m-b><button class="btn btn-primary" type=submit>Sign up</button></div><!--         <hr>\n        <div>\n          <a class="btn btn-facebook" href="" ng-click="loginOauth(\'facebook\')">\n            <i class="fa fa-facebook"></i> Connect with Facebook\n          </a>\n          <a class="btn btn-google-plus" href="" ng-click="loginOauth(\'google\')">\n            <i class="fa fa-google-plus"></i> Connect with Google+\n          </a>\n        </div>\n --></form></div><hr></div></div><!-- 	<div class="modal-footer">\n    	<button class="btn btn-primary" type="button" ng-click="ok()">OK</button>\n    	<button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button>\n	</div>\n -->'),
a.put("app/account/login/login.html",'<!-- <div ng-include="\'components/navbar/navbar.html\'"></div> --><div class="container-fluid container-fill-height"><!--   <div class="row"> --><!--     <div class="container-content-middle"> --><!--       <h1>Login</h1> --><!--\n      <p>Accounts are reset on server restart from <code>server/config/seed.js</code>. Default account is <code>test@test.com</code> / <code>test</code></p>\n      <p>Admin account is <code>admin@admin.com</code> / <code>admin</code></p>\n--><!--     </div> --><div class=container-content-middle><form class="m-x-auto text-center app-login-form" name=form ng-submit=login(form) novalidate><h1 class="app-brand m-b-lg">Login</h1><div class=form-group><!--           <label>Email</label> --><input placeholder=Email type=email name=email class=form-control ng-model=user.email required></div><div class="form-group m-b-md"><!--           <label>Password</label> --><input placeholder=Password type=password name=password class=form-control ng-model=user.password></div><div class="form-group has-error"><p class=help-block ng-show="!passwordForgotten && form.email.$error.required && !user.password && submitted">Please enter your email and password.</p><p class=help-block ng-show="(passwordForgotten && form.email.$error.required) || (form.email.$error.email && submitted)">Please enter a valid email.</p><p class=help-block>{{ errors.other }}</p></div><div class=m-b-lg><button class="btn btn-primary" type=submit>Login</button> <a class="btn btn-default" href=/signup>Register</a></div><a href=# ng-click="passwordForgotten=true;forgotPassword(form)">Forgot Password?</a><!--         <hr>\n        <div>\n          <a class="btn btn-facebook" href="" ng-click="loginOauth(\'facebook\')">\n            <i class="fa fa-facebook"></i> Connect with Facebook\n          </a>\n          <a class="btn btn-google-plus" href="" ng-click="loginOauth(\'google\')">\n            <i class="fa fa-google-plus"></i> Connect with Google+\n          </a>\n        </div>\n --></form></div><!--   </div> --><hr></div>'),a.put("app/account/login/reset.html",'<!-- <div ng-include="\'components/navbar/navbar.html\'"></div> --><div class=container><div class=row><div class=col-sm-12><h1>Reset Password</h1></div><div class=col-sm-12><form class=form name=form ng-submit=resetPassword(form) novalidate><div class=form-group><label>New Password</label><input type=password name=newPassword class=form-control ng-model=user.newPassword ng-minlength=3 required mongoose-error><p class=help-block ng-show=form.newPassword.$error.mongoose>{{ errors.other }}</p><p class=help-block ng-show="(form.newPassword.$error.minlength || form.newPassword.$error.required) && (form.newPassword.$dirty || submitted)">Password must be at least 3 characters.</p></div><div class=form-group><label>Repeat Password</label><input type=password name=repeatPassword class=form-control ng-model=user.repeatPassword required><p class=help-block ng-show="(form.repeatPassword !== form.newPassword) && submitted">Passwords do not match.</p></div><p class=help-block>{{ message }}</p><button class="btn btn-lg btn-primary" type=submit>Reset</button></form></div></div></div>'),a.put("app/account/settings/settings.html",'<!-- <div ng-include="\'components/navbar/navbar.html\'"></div> --><div class=container><div class=row><div class=col-sm-12><h1>Change Password</h1></div><div class=col-sm-12><form class=form name=form ng-submit=changePassword(form) novalidate><div class=form-group><label>Current Password</label><input type=password name=password class=form-control ng-model=user.oldPassword mongoose-error><p class=help-block ng-show=form.password.$error.mongoose>{{ errors.other }}</p></div><div class=form-group><label>New Password</label><input type=password name=newPassword class=form-control ng-model=user.newPassword ng-minlength=3 required><p class=help-block ng-show="(form.newPassword.$error.minlength || form.newPassword.$error.required) && (form.newPassword.$dirty || submitted)">Password must be at least 3 characters.</p></div><p class=help-block>{{ message }}</p><button class="btn btn-lg btn-primary" type=submit>Save changes</button></form></div></div></div>'),a.put("app/account/signup/signup.html",'<!-- <div ng-include="\'components/navbar/navbar.html\'"></div> --><div class="container-fluid container-fill-height"><!--   <div class="row"> --><!--     <div class="col-sm-12"> --><!--       <h1>Sign up</h1> --><!--     </div> --><div class=container-content-middle><form class="m-x-auto text-center app-login-form" name=form ng-submit=register(form) novalidate><h1>Sign up</h1><div class=form-group ng-class="{ \'has-success\': form.name.$valid && submitted,\n                                            \'has-error\': form.name.$invalid && submitted }"><!--           <label>Name</label> --><input placeholder=Name name=name class=form-control ng-model=user.name required><p class=help-block ng-show="form.name.$error.required && submitted">A name is required</p></div><div class=form-group ng-class="{ \'has-success\': form.email.$valid && submitted,\n                                            \'has-error\': form.email.$invalid && submitted }"><!--           <label>Email</label> --><input placeholder=Email type=email name=email class=form-control ng-model=user.email required mongoose-error><p class=help-block ng-show="form.email.$error.email && submitted">Doesn\'t look like a valid email.</p><p class=help-block ng-show="form.email.$error.required && submitted">What\'s your email address?</p><p class=help-block ng-show=form.email.$error.mongoose>{{ errors.email }}</p></div><div class="form-group m-b-md" ng-class="{ \'has-success\': form.password.$valid && submitted,\n                                            \'has-error\': form.password.$invalid && submitted }"><!--           <label>Password</label> --><input placeholder=Password type=password name=password class=form-control ng-model=user.password ng-minlength=3 required mongoose-error><p class=help-block ng-show="(form.password.$error.minlength || form.password.$error.required) && submitted">Password must be at least 3 characters.</p><p class=help-block ng-show=form.password.$error.mongoose>{{ errors.password }}</p></div><div class=m-b-lg><button class="btn btn-primary" type=submit>Sign up</button></div><!--         <hr>\n        <div>\n          <a class="btn btn-facebook" href="" ng-click="loginOauth(\'facebook\')">\n            <i class="fa fa-facebook"></i> Connect with Facebook\n          </a>\n          <a class="btn btn-google-plus" href="" ng-click="loginOauth(\'google\')">\n            <i class="fa fa-google-plus"></i> Connect with Google+\n          </a>\n        </div>\n --></form></div><!--   </div> --><hr></div>'),a.put("app/admin/admin.html",'<!-- <div ng-include="\'components/navbar/navbar.html\'"></div> --><div class=container><p class=text-danger>The delete user and user index api routes are restricted to users with the \'admin\' role.</p><ul class="nav nav-pills"><li class=active><a data-toggle=pill href=#users>Users</a></li><li><a data-toggle=pill href=#readings>Daily Readings</a></li></ul><div class=tab-content><div id=users class="tab-pane fade in active"><hr><button type=button ng-click=generateEmailList() class="btn btn-primary">Generate Email List</button><hr><ul class=list-group><li class=list-group-item ng-repeat="user in users | filter :{\'role\':\'user\'}"><strong>{{user.name}}</strong><br><span class=text-muted>{{user.email}}</span> <a ng-click=deleteUser(user) class=trash><span class="glyphicon glyphicon-trash pull-right"></span></a></li></ul></div><div id=readings class="tab-pane fade"><hr><button type=button ng-click=editDailyReading() class="btn btn-primary">Add Daily Reading</button><hr><div class="panel panel-default"><div class=panel-heading>Daily Readings</div><div class=panel-body><table class="table borderless"><tr ng-repeat="reading in readings | orderBy : \'day\'"><td><strong>{{reading.book}} {{reading.chapter}}<span ng-if="reading.verses && reading.verses.length!=0">:</span>{{reading.verses}}</strong></td><td><span>{{reading.day | date}}</span></td><td><div><a ng-click=deleteReading(reading) class=trash><span class="fa fa-trash-o pull-right"></span></a> <a ng-click=editDailyReading(reading)><span class="fa fa-edit pull-right"></span></a></div></td></tr></table></div></div></div></div></div>'),a.put("app/admin/editdailyreading.html",'<div class=modal-header><h3 ng-if="reading!=null" class=modal-title>Edit Reading</h3><h3 ng-if="reading==null" class=modal-title>Add Reading</h3></div><div class=modal-body style=overflow-y:auto;height:300px;background-color:#F5F5F5><ul class="nav nav-pills panel-menu"><li class=panel-menu-item ng-class="{\'active\': selectedTestament==\'ot\'}"><a class="btn btn-sm" data-toggle=pill ng-click="changeBooks(\'ot\')">Old Testament</a></li><li class=panel-menu-item ng-class="{\'active\': selectedTestament==\'nt\'}"><a class="btn btn-sm" data-toggle=pill ng-click="changeBooks(\'nt\')">New Testament</a></li></ul><hr><ul class=list-group><li class=list-group-item><div class="row p-r"><div class=col-xs-4><strong>Date:</strong></div><p class=input-group><input class=form-control uib-datepicker-popup ng-model=selectedDate init-date=false is-open=calendar.opened datepicker-options=dateOptions ng-required=true close-text="Close"> <span class=input-group-btn><button type=button class="btn btn-default" ng-click=openCalendar()><i class="glyphicon glyphicon-calendar"></i></button></span></p></div></li><li class=list-group-item><div class="row p-r"><div class=col-xs-4><strong>Book:</strong></div><select class="col-xs-8 custom-select" ng-click="selectedChapter=null;selectedVerses=[]" ng-model=selectedBook ng-options="b.name for b in books"></select></div></li><li class=list-group-item><div class="row p-r"><div class=col-xs-4><strong>Chapter:</strong></div><select class="col-xs-8 custom-select" ng-click="selectedVerses=[]" ng-disabled=!selectedBook ng-model=selectedChapter ng-options="c for c in selectedBook.chapters"></select></div></li><li class=list-group-item><div class="row p-r"><div class=col-xs-4><strong>Verses:</strong></div><select class="col-xs-8 custom-select" multiple ng-model=selectedVerses ng-options="v for v in verses"></select></div></li></ul></div><p>Selected Book: {{selectedBook.name}} Selected Chapter: {{selectedChapter}} Verses: {{selectedVerses}}</p><div class=modal-footer style=text-align:center><button class="btn btn-primary" type=button ng-click=ok()>OK</button> <button class="btn btn-warning" type=button ng-click=cancel()>Cancel</button></div>'),a.put("app/following/following.html",'<div class=modal-header><div class=row><div class=col-xs-4><h3 class=modal-title>Edit Following</h3></div><div class=col-xs-4><form class=form-horizontal role=form><div class=form-group><label class="control-label col-sm-2" for=userName>Search:</label><div class=col-sm-10><input id=query placeholder="Enter search text" ng-model="search.name"></div></div></form></div></div></div><div class=modal-body style=overflow-y:auto;height:200px;background-color:#F5F5F5><!-- 	<div class="row">\n 	<div class="col-sm-8">\n		<div class="panel panel-default">\n			<div class="panel-heading">Available Users</div>\n			<div class="panel-body">\n			    <ul class="list-unstyled">\n			        <li ng-repeat="user in users | filter:query track by $index">\n			        	<div class="row" ng-hide=\'isFollowing(user) || user.role==="admin"\'>\n			        		<div class="col-xs-6">{{ user.name }}</div>\n			        		<div class="col-xs-2"><button class="btn btn-primary"  ng-click="follow(user)">Follow</button></div>\n			        	</div>			            			            \n			        </li>\n			    </ul>\n		    </div>\n	    </div>\n    </div>    \n	</div>\n --><div class="row users-row" ng-if="users.length>0"><div class=col-md-12 ng-repeat="u in users | filter:search:strict track by $index"><div class=user-col ng-hide="isFollowing(u) || u.role===&quot;admin&quot; || u.role===&quot;guest&quot;"><div class=media><a class=media-left href=#><img class="media-object img-circle" src=../../assets/images/d8794517.avatar_placeholder.png></a><div class=media-body><strong>{{u.name}}</strong><div><span class="icon icon-users" style=color:#428bca></span>&nbsp; <span>{{u.followers}} Followers</span></div><div><span class="fa fa-users" style=color:#428bca></span>&nbsp; <span>{{u.following}} Following</span></div><div style=height:20px></div><div class=btn-toolbar><div class=btn-group><button class="btn btn-primary btn-sm" ng-click=follow(u);><span class="icon icon-add-user"></span> Follow</button></div><div class=btn-group><span class="fa fa-comments" style=color:#428bca></span>&nbsp; <span>{{u.comments}} Contributions</span>&nbsp; <span class="glyphicon glyphicon-thumbs-up" style=color:#428bca></span> <span>{{u.likes}} Likes</span></div></div><!-- 		               <small>{{::f.email}}</small> --></div></div></div></div></div></div><div class=modal-footer style=text-align:left><button class="btn btn-primary" type=button ng-click=ok()>OK</button> <button class="btn btn-warning" type=button ng-click=cancel()>Cancel</button></div>'),a.put("app/following/following_main.html",'<div id=wrapperInner><div class="container p-t" id=grouparea><div class="row areaheader"><h1>Following</h1><div class=row><div style=padding-left:15px><a href=# ng-click="showUsers=false" style=color:white>My Connections</a> <span style=color:white>&nbsp; | &nbsp;</span> <a href=# ng-click=addConnection() style=color:white>Add Connection</a></div></div></div><div class="row panel panel-primary" ng-if="showUsers && users.length>0" style=background-color:#F5F5F5><div class=panel-heading><div class=row><h4 class=col-xs-4>Available Connections</h4><div class=col-xs-4><form class=form-horizontal role=form><div class="form-group row"><label class="control-label col-sm-2" for=userName>Search:</label><div class=col-sm-8><span class=hidden-xs>&nbsp;</span> <input class=text-info id=query placeholder="Enter search text" ng-model="search.name"></div></div></form><!-- 			  <select ng-model="orderList" onchange="pxtrack.emit(\'counter\', \'2\')">\n				    <option value="name">By name</option>\n				    <option value="-age">Newest</option>\n				    <option value="age">Oldest</option>\n				  </select>\n	 --></div></div></div><div class="row users-row p-a"><div class=col-md-6 ng-repeat="f in users | filter:search:strict track by $index" ng-if="model.followingIds.indexOf(f._id) === -1 && f.role!==&quot;admin&quot; && f.role!==&quot;guest&quot;"><div class=user-col><div class=media><a class=media-left href=#><img class="media-object img-circle" src=../../assets/images/d8794517.avatar_placeholder.png></a><div class=media-body><strong>{{f.name}}</strong><div><span class="icon icon-users" style=color:#428bca></span>&nbsp; <span>{{f.followers}} Followers</span></div><div><span class="fa fa-users" style=color:#428bca></span>&nbsp; <span>{{f.following}} Following</span></div><div style=height:20px></div><div class=btn-toolbar><div class=btn-group><button class="btn btn-primary btn-sm" ng-click=follow(f);><span class="icon icon-add-user"></span> Follow</button></div><div class=btn-group><span class="fa fa-comments" style=color:#428bca></span>&nbsp; <span>{{f.comments}} Contributions</span>&nbsp; <span class="glyphicon glyphicon-thumbs-up" style=color:#428bca></span> <span>{{f.likes}} Likes</span></div></div><!-- 		               <small>{{::f.email}}</small> --></div></div></div></div></div></div><div class="row panel panel-primary" ng-if="!showUsers && model.following.length>0" style=background-color:#F5F5F5><div class=panel-heading><div class=row><h4 class=col-xs-4>Your Connections</h4><div class=col-xs-4><form class=form-horizontal role=form><div class="form-group row"><label class="control-label col-sm-2" for=userName>Search:</label><div class=col-sm-8><span class=hidden-xs>&nbsp;</span> <input class=text-info id=query placeholder="Enter search text" ng-model="search.name"></div></div></form><!-- 			  <select ng-model="orderList" onchange="pxtrack.emit(\'counter\', \'2\')">\n				    <option value="name">By name</option>\n				    <option value="-age">Newest</option>\n				    <option value="age">Oldest</option>\n				  </select>\n	 --></div></div></div><div class="row users-row p-a"><div class=col-md-6 ng-repeat="f in model.following | filter:search:strict track by $index"><div class=user-col><div class=media><a class=media-left href=#><img class="media-object img-circle" src=../../assets/images/d8794517.avatar_placeholder.png></a><div class=media-body><strong>{{f.name}}</strong><div><span class="icon icon-users" style=color:#428bca></span>&nbsp; <span>{{f.followers}} Followers</span></div><div><span class="fa fa-users" style=color:#428bca></span>&nbsp; <span>{{f.following}} Following</span></div><div style=height:20px></div><div class=btn-toolbar><div class=btn-group><button class="btn btn-primary btn-sm" ng-click=unfollow(f);><span class="icon icon-remove-user"></span> Unfollow</button></div><div class=btn-group><span class="fa fa-comments" style=color:#428bca></span>&nbsp; <span>{{f.comments}} Contributions</span>&nbsp; <span class="glyphicon glyphicon-thumbs-up" style=color:#428bca></span> <span>{{f.likes}} Likes</span></div></div><!-- 		               <small>{{::f.email}}</small> --></div></div></div></div></div></div></div></div><script>document.body.style.backgroundColor = "#F5F5F5";</script>'),a.put("app/groups/create_group.html",'<div class=modal-header><h3 class=modal-title>Edit Members</h3></div><div class=modal-body><form class=form-horizontal role=form ng-show=model.showForm><div class=form-group><label class="control-label col-sm-2" for=groupName>Name:</label><div class=col-sm-10><input class=form-control id=groupName placeholder="Enter Group Name" ng-model=groupName></div></div><div class=form-group><label class="control-label col-sm-2" for=groupDescription>Description:</label><div class=col-sm-10><input class=form-control id=groupDescription placeholder="Enter Description" ng-model=groupDescription></div></div><div class=form-group><div class="col-sm-offset-2 col-sm-10"><div class=row><div class=col-sm-4><a href=# class=text-primary ng-click=inviteMembers()>Invite Members</a></div><div class="col-sm-2 checkbox"><label><input type=checkbox id=sendEmail>Send email</label></div><div class="col-sm-2 checkbox"><label><input type=checkbox>Active</label></div></div></div></div><div class=form-group><div class="col-sm-offset-2 col-sm-10"><button type=button class="btn btn-primary" ng-click=addGroup(groupName,groupDescription)>Submit</button></div></div></form></div><div class=modal-footer style=text-align:center><button class="btn btn-primary" type=button ng-click=ok()>OK</button> <button class="btn btn-warning" type=button ng-click=cancel()>Cancel</button></div>'),a.put("app/groups/group_main.html",'<script>document.body.style.backgroundColor = "#f2f3f7";</script><div class="container p-t-md"><div class="row areaheader"><h1>{{group.groupName}}</h1><hr></div><div class=row><div class=col-md-3><div class="panel panel-default visible-sm-block visible-md-block visible-lg-block"><div class=panel-body><h5 class=m-t-0>Members <small ng-show="group.creator._id===currentUser._id"><a ui-sref=groups>Edit</a></small></h5><ul class="media-list media-list-stream"><li class="media m-b"><a class=media-left href=#><img class="avatar-list-item img-circle" src=../../assets/images/d8794517.avatar_placeholder.png></a><div class=media-body><strong>{{group.creator.name}}</strong><div class=media-body-actions><button class="btn btn-default-outline btn-sm disabled" ng-click=""><span class="icon icon-user"></span>Owner</button></div></div></li><li class="media m-b" ng-repeat="member in members"><a class=media-left href=#><img class="avatar-list-item img-circle" src=../../assets/images/d8794517.avatar_placeholder.png></a><div class=media-body><strong>{{member.name}}</strong><div class=media-body-actions><button ng-if="group.creator._id===currentUser._id" class="btn btn-primary-outline btn-sm" ng-click=removeMember(member)><span class="icon icon-remove-user"></span>Remove</button> <button ng-if="group.creator._id!==currentUser._id" class="btn btn-info-outline btn-sm disabled"><span class="icon icon-user"></span>Member</button></div></div></li></ul></div></div><div class="panel panel-default visible-sm-block visible-md-block visible-lg-block"><div class=panel-body><h5 class=m-t-0>Invited <small ng-show="group.creator._id===currentUser._id"><a ui-sref=groups>Edit</a></small></h5><ul class="media-list media-list-stream"><li class="media m-b" ng-repeat="invitee in invited"><a class=media-left href=#><img class="avatar-list-item img-circle" src=../../assets/images/d8794517.avatar_placeholder.png></a><div class=media-body><strong>{{invitee.name}}</strong><!--             			<div class="media-body-actions"> --><!--             				<button class="btn btn-primary-outline btn-sm" ng-click=""> --><!--             					<span class="icon icon-remove-user"></span>wi --><!--             				</button> --><!--             			</div> --></div></li></ul></div></div><div class="panel panel-default visible-sm-block visible-md-block visible-lg-block"><div class=panel-body><h5 class=m-t-0>Requests <small ng-show="group.creator._id===currentUser._id"><a ui-sref=groups>Edit</a></small></h5><ul class="media-list media-list-stream"><li class="media m-b" ng-repeat="requester in requests"><a class=media-left href=#><img class="avatar-list-item img-circle" src=../../assets/images/d8794517.avatar_placeholder.png></a><div class=media-body><strong>{{requester.name}}</strong><div class=media-body-actions><button class="btn btn-primary-outline btn-sm" ng-click=acceptUser(requester)><span class="icon icon-add-user"></span>Accept</button></div></div></li></ul></div></div><div class="panel panel-default m-b-md visible-sm-block visible-md-block visible-lg-block"><div class=panel-body><h5 class=m-t-0>Verses</h5><ul class="media-list media-list-stream"><li class="media m-b" ng-repeat="(scripture,verse) in verses"><a href=/scripture/{{verse.testament}}/{{verse.book}}/{{verse.chapter}}/{{verse.verse}}><span class="fa fa-book"></span> {{scripture}}</a></li></ul></div></div></div><div class=col-md-7><div ng-if="selectedUser!==\'\'" class=pull-left><a href=# ng-click=clearUserFilter()>All</a></div><br ng-if="selectedUser!==\'\'"><ul class="list-group media-list media-list-stream" infinite-scroll=loadMore() infinite-scroll-disabled=loading infinite-scroll-distance=2><li class="media list-group-item p-a"><div class=input-group><input class=form-control placeholder=Message ng-model=newMessage><div class=input-group-btn><!-- 	              <button ng-if=\'newMessage === ""\' type="button" class="btn btn-default"> --><!-- 	                <span class="icon icon-camera"></span> --><!-- 	              </button> --><button class="btn btn-primary pull-left" ng-disabled="newMessage ===&quot;&quot;" ng-click=addMessage()>Post</button></div></div></li><li class="media list-group-item p-a" ng-repeat="f in visibleFeed | filter:{\'postedBy\':selectedUser} | orderBy:\'-date\' track by $index"><a class=media-left href=#><img class="avatar-list-item img-circle" src=../../assets/images/d8794517.avatar_placeholder.png></a><div class=media-body><div class=media-heading><a ng-if="f.anno!==undefined" id=reference{{f._id}} href=# ng-mouseover="showScripture(f._id, f.anno)" ng-click=gotoAnnotation(f._id) class=pull-right><span class="glyphicon glyphicon-book"></span></a><h5><a href="" ng-click=filterByUser(f.user.name)>{{f.user.name}}</a> - {{f.date|date}}</h5></div><div ng-if=f.comment ew-comment comment=f.comment following=following user=currentUser update-callback=updateComment delete-callback=removeComment like-callback=updateLikes></div><!--                 <p ng-if="f.comment">{{f.comment.text}}</p> --><div ng-if=f.reference><ew-reference reference=f.reference user=currentUser following=following||[] delete-callback=reload like-callback=updateLikes></ew-reference></div><div ng-if=f.media><ew-media-item media=f.media user=currentUser following=following||[] delete-callback=reload like-callback=updateLikes></ew-media-item></div></div></li></ul></div><div class=col-sm-2><div class=row></div></div></div></div>'),a.put("app/groups/group_members.html",'<div class=modal-header><h3 class=modal-title>Edit Members</h3><!--      <span uib-dropdown on-toggle="toggled(open)">\n      <a href id="members-dropdown" class="text-primary" uib-dropdown-toggle>\n        Invite Members\n      </a>\n      <ul uib-dropdown-menu aria-labelledby="members-dropdown">\n        <li ng-repeat="u in users">\n	    <div class="row">\n	    	<div class="col-xs-2"></div>\n	    	<div class="col-xs-4">{{u.name}}</div>\n	        <div class="col-xs-2">\n          		<a href="#" ng-click="inviteMember(u);">Invite</a>\n	        </div>\n	     </div>	            \n        </li>\n      </ul>\n    </span>\n --><span uib-dropdown auto-close=outsideClick on-toggle=toggled(open)><a href id=email-dropdown class=text-primary uib-dropdown-toggle>Invite Emails</a><ul uib-dropdown-menu aria-labelledby=email-dropdown><li><div class="input-group input-group-sm"><input class=form-control ng-model=newEmail placeholder="Enter email..."> <span class=input-group-btn><button class="btn btn-default" type=button ng-click="emails.push(newEmail); newEmail=\'\'">Add</button></span></div></li><!--         <li ng-repeat="e in emails">\n	    <div class="row">\n	    	<div class="col-xs-2"></div>\n	    	<div class="col-xs-4">{{e}}</div>\n	     </div>\n        </li>\n --></ul></span></div><div class=modal-body><div class=row><div class=col-sm-6><div class="panel panel-default"><div class=panel-heading>Members</div><div class=panel-body><ul class=list-unstyled><li ng-repeat="member in members.concat(invited).concat(requests).concat(invitees).concat(emails) track by $index"><div class=row><div class=col-xs-6>{{ member.name || member }}</div><div class=col-xs-2><a href=# ng-show="members.indexOf(member)!==-1" ng-click="$event.preventDefault(); removeMember(member)">Remove</a><p class=text-muted ng-show=isPending(member)>Pending</p></div></div></li></ul></div></div></div><div class=col-sm-6><div class="panel panel-default"><div class=panel-heading>Available Users</div><div class=panel-body><ul class=list-unstyled><li ng-repeat="user in users track by $index"><div class=row ng-show="!isMember(user) && user.role !== \'admin\'"><div class=col-xs-6>{{ user.name }}</div><div class=col-xs-2><a href=# class="btn btn-primary" ng-click=inviteMember(user)>Invite</a></div></div></li></ul></div></div></div></div></div><div class=modal-footer style=text-align:center><button class="btn btn-primary" type=button ng-click=ok()>OK</button> <button class="btn btn-warning" type=button ng-click=cancel()>Cancel</button></div>'),a.put("app/groups/groups.html",'<div class="container p-t" id=grouparea><div class="row areaheader"><div class=row style=padding-left:15px><h1 ng-class="{\'col-xs-4\':isSmallDevice, \'col-xs-2\':!isSmallDevice}">Groups</h1><div class="p-t-md col-xs-2"><button type=button class="btn btn-primary groupbutton" ng-click=toggleForm() ng-disabled=model.showForm>Create Group</button></div></div><div class=row style=padding-left:15px><a href=# ng-click="model.showForm=false;showAvailGroups=false" style=color:white>My Groups</a> <span style=color:white>&nbsp; | &nbsp;</span> <a href=# ng-click=showAvailableGroups() style=color:white>Find Group</a></div></div><div class=row><form class=form-horizontal role=form ng-show=model.showForm><div class=form-group><label class="text-primary control-label col-sm-2" for=groupName>Name:</label><div class=col-sm-10><input class=form-control id=groupName placeholder="Enter Group Name" ng-model=groupName></div></div><div class=form-group><label class="text-primary control-label col-sm-2" for=groupDescription>Description:</label><div class=col-sm-10><input class=form-control id=groupDescription placeholder="Enter Description" ng-model=groupDescription></div></div><div class=form-group><div class="col-sm-offset-3 col-sm-10"><div class=row><div class="col-sm-4 invitemembers"><a href=# class=text-primary ng-click=inviteMembers()>Invite Members<br><div class=well><ul class=list-unstyled><li ng-repeat="member in model.invitedMembers">{{member.name}}</li></ul></div></a></div><div class="col-sm-4 invitemembers"><a href=# class=text-primary ng-click=inviteMembers(true)>Invite by Email<br><div class=well><ul class=list-unstyled><li ng-repeat="email in model.invitedEmails">{{email}}</li></ul></div></a></div><!-- 		      <div class="col-sm-2 checkbox"> --><!-- 		        <label><input type="checkbox">Active</label> --><!-- 		      </div> --></div></div></div><div class=form-group><div class="col-sm-offset-3 col-sm-10"><button type=button ng-disabled=!groupName class="btn btn-primary" ng-click=addGroup(groupName,groupDescription)>Submit</button> <button type=button class="btn btn-primary" ng-click="model.showForm=false;clearForm()">Cancel</button></div></div></form></div><div class="row panel panel-primary" ng-show="!model.showForm && showAvailGroups" style=background-color:#F5F5F5><div class=panel-heading><div class=row><h4 class=col-xs-4>Available Groups</h4><div class=col-xs-4><form class=form-horizontal role=form><div class="form-group row"><label class="control-label col-sm-2" for=groupName>Search:</label><div class=col-sm-8><span class=hidden-xs>&nbsp;</span> <input class=text-info id=query placeholder="Enter search text" ng-model="search.name"></div></div></form><!-- 			  <select ng-model="orderList" onchange="pxtrack.emit(\'counter\', \'2\')">\n				    <option value="name">By name</option>\n				    <option value="-age">Newest</option>\n				    <option value="age">Oldest</option>\n				  </select>\n	 --></div></div></div><div class="row users-row p-a" ng-if="availGroups && availGroups.length>0"><div class=col-md-6 ng-repeat="group in availGroups | filter:search:strict"><div class=user-col><div class=media><a class=media-left href=#><img class="media-object img-circle" src=../../assets/images/b200e122.group.jpg></a><div class=media-body><strong><a href=/group/{{group._id}}>{{group.name}}</a></strong><br><div class=more-text show-char=50 content=group.info></div><div ng-class="{row: !isSmallDevice}"><div ng-class="{\'col-xs-4\': !isSmallDevice}"><span class="fa fa-users" style=color:#428bca></span>&nbsp; <span>{{group.members.concat(group.creator).length}} Members</span></div><div ng-class="{\'col-xs-6\': !isSmallDevice}"><span class="fa fa-comments" style=color:#428bca></span>&nbsp; <span>{{group.contributions}} Contributions</span>&nbsp;</div></div><div ng-class="{row: !isSmallDevice}"><div ng-class="{\'col-xs-4\': !isSmallDevice}"><span class="fa fa-users" style=color:#428bca></span>&nbsp; <span>{{group.invited.length}} Invited</span></div><div ng-class="{\'col-xs-4\': !isSmallDevice}"><span class="fa fa-users" style=color:#428bca></span>&nbsp; <span>{{group.requests.length}} Requests</span></div></div><div style=height:20px></div><div class=btn-toolbar><div class=btn-group ng-if="group.requests.indexOf(currentUser._id)===-1"><button class="btn btn-primary btn-sm" ng-click=joinGroup(group);><span class="icon icon-add-user"></span> Join</button></div><div class=btn-group ng-if="group.requests.indexOf(currentUser._id)!==-1"><button class="btn btn-info btn-sm" disabled><span class="icon icon-add-user"></span>Pending</button></div></div></div></div></div></div></div></div><div class="row panel panel-primary" ng-show="!model.showForm && !showAvailGroups" style=background-color:#F5F5F5><div class=panel-heading><h4>Your Groups</h4></div><div class="row users-row p-a"><div class=col-md-6 ng-repeat="group in model.groups"><div class=user-col><div class=media><a class=media-left href=#><img class="media-object img-circle" src=../../assets/images/b200e122.group.jpg></a><div class=media-body><strong><a href=/group/{{group._id}}>{{group.name}}</a></strong><br><div class=more-text show-char=50 content=group.info></div><div ng-class="{row: !isSmallDevice}"><div ng-class="{\'col-xs-4\': !isSmallDevice}"><span class="fa fa-users" style=color:#428bca></span>&nbsp; <span>{{group.members.concat(group.creator).length}} Members</span></div><div ng-class="{\'col-xs-6\': !isSmallDevice}"><span class="fa fa-comments" style=color:#428bca></span>&nbsp; <span>{{group.contributions}} Contributions</span>&nbsp;</div></div><div ng-class="{row: !isSmallDevice}"><div ng-class="{\'col-xs-4\': !isSmallDevice}"><span class="fa fa-users" style=color:#428bca></span>&nbsp; <span>{{group.invited.length}} Invited</span></div><div ng-class="{\'col-xs-4\': !isSmallDevice}"><span class="fa fa-users" style=color:#428bca></span>&nbsp; <span>{{group.requests.length}} Requests</span></div></div><div style=height:20px></div><div class=btn-toolbar><div class=btn-group ng-if="group.creator === currentUser._id"><button class="btn btn-primary btn-sm" ng-click=editMembers(group)><span class="icon icon-add-user"></span> Edit Members</button></div><div class=btn-group ng-if="group.creator !== currentUser._id"><button class="btn btn-danger btn-sm" ng-click=leaveGroup(group)><span class="icon icon-remove-user"></span>Leave</button></div><div class=btn-group ng-if="group.creator === currentUser._id"><button class="btn btn-danger btn-sm" ng-click=deleteGroup(group)><span class="icon icon-circle-with-cross"></span>Delete</button></div></div></div></div></div></div></div><!--   	<div class="groupPanel" >\n	  	<div class="panel panel-default" ng-repeat="group in model.groups">\n			<div class="panel-heading"><a href="/group/{{group._id}}">{{group.name}}</a>\n				<button type="button" ng-hide="group.creator !== currentUser._id" ng-click="deleteGroup(group)" class="close">&times;</button>\n			</div>        \n	        <div class="panel-body groups">        \n	          <span class="text-primary">Description: </span><p style="overflow-y:hidden;text-overflow:ellipsis;">{{group.info}}</p>\n	          <a href=\'#\' class="text-primary" ng-click="editMembers(group)" ng-if="group.creator === currentUser._id">Edit Members</a>\n	          <button class="btn btn-primary btn-small" ng-click="leaveGroup(group)" ng-if="group.creator !== currentUser._id">Leave</a>\n	        </div>\n	  		<li><a ng-click=\'toggleForm(group)\' class="text-primary" style=\'text-decoration:none;\'>{{group.name}}</a></li>\n	  	</div>\n  	</div>\n --></div></div><script>document.body.style.backgroundColor = "#F5F5F5";</script>'),
a.put("app/groups/invite_emails.html",'<div class=modal-header><h3 class=modal-title>Invite Members</h3></div><div class=modal-body><form role=form><div class=form-group><label for=message>Message:</label><input class=form-control id=message ng-model=message></div><br><label for=emailForm>Add email to invite:</label><div class=row><div class=col-sm-8><input class=form-control ng-model=inviteEmail></div><button class="btn btn-primary col-sm-2" type=button id=emailForm ng-click=addEmail(inviteEmail)>Add</button></div><br><div class=well style=height:100px><ul ng-repeat="member in emails.concat(newEmails)"><li>{{member}}</li></ul></div></form></div><div class=modal-footer style=text-align:center><button class="btn btn-primary" type=button ng-click=ok()>OK</button> <button class="btn btn-warning" type=button ng-click=cancel()>Cancel</button></div>'),a.put("app/groups/invite_members.html",'<div class=modal-header><h3 class=modal-title>Invite Members</h3></div><div class=modal-body><form role=form><div class=form-group><label for=message>Message:</label><input class=form-control id=message ng-model=message></div><br><label for=sel2>Select User(s):</label><!--       <select multiple class="form-control" id="sel2" --><!--           ng-options="" ng-model="selected"> --><!--       </select> --><div class=list-group><div class="list-group-item row" ng-repeat="user in users track by user._id"><div class="col-sm-4 text-center">{{ user.name }}</div><div class=col-sm-4 ng-show="selected.indexOf(user) === -1 && invited.indexOf(user) ===-1"><a href=# class="btn btn-primary btn-block" ng-click=selectUser(user)>Select</a></div><div class=col-sm-4 ng-show="selected.indexOf(user) !== -1 || invited.indexOf(user) !== -1"><span class="text-muted pull-left">Selected</span> <button type=button ng-click=unselectUser(user) class=close>&times;</button></div></div></div></form></div><div class=modal-footer style=text-align:center><button class="btn btn-primary" type=button ng-click=ok()>OK</button> <button class="btn btn-warning" type=button ng-click=cancel()>Cancel</button></div>'),a.put("app/groups/join_group.html",'<div class=modal-header><div class=row><div class=col-xs-4><h3 class=modal-title>Join Group</h3></div><div class=col-xs-4><form class=form-horizontal role=form><div class=form-group><label class="control-label col-sm-2" for=groupName>Search:</label><div class=col-sm-10><input id=query placeholder="Enter search text" ng-model=query onfocus="pxtrack.emit(\'counter\', \'1\')"></div></div></form><!-- 			  <select ng-model="orderList" onchange="pxtrack.emit(\'counter\', \'2\')">\n			    <option value="name">By name</option>\n			    <option value="-age">Newest</option>\n			    <option value="age">Oldest</option>\n			  </select>\n --></div></div></div><div class=modal-body style=text-align:center><div class=row><div class=col-sm-6><div class="panel panel-default"><div class=panel-heading>Current Groups</div><div class=panel-body><ul class=list-unstyled><li ng-repeat="group in mygroups track by $index"><div class=row><div class=col-xs-6>{{ group.name }}</div><div class=col-xs-2 ng-if="!myGroup(group) && pending.indexOf(group)===-1"><button class="btn btn-primary" ng-click=leaveGroup(group)>Leave</button></div><div class=col-xs-2 ng-if="!myGroup(group) && pending.indexOf(group)!==-1"><button class="btn btn-info disabled" style=margin-left:10px>Pending</button></div><div class=col-xs-2 ng-if=myGroup(group)><button class="btn btn-info disabled" style=margin-left:10px>Owner</button></div></div></li></ul></div></div></div><div class=col-sm-6><div class="panel panel-default"><div class=panel-heading>Available Groups</div><div class=panel-body><ul class=list-unstyled><li ng-repeat="group in groups | filter:query  track by $index"><div class=row><div class=col-xs-6>{{ group.name }}</div><div class=col-xs-2 ng-show="selected.indexOf(group)===-1"><button class="btn btn-primary" ng-click=joinGroup(group)>Join</button></div><div class=col-xs-2 ng-show="selected.indexOf(group)!==-1"><button class="btn btn-default disabled">Pending</button></div></div></li></ul></div></div></div></div></div><div class=modal-footer style=text-align:left><button class="btn btn-primary" type=button ng-click=ok()>OK</button> <button class="btn btn-warning" type=button ng-click=cancel()>Cancel</button></div>'),a.put("app/home/home.html",'<div id=home-container class=col-sm-12><div id=video-container><video autoplay muted loop id=bgvid><source type=video/mp4 src=../../assets/videos/home-bg-final.mp4 poster=../../assets/images/d3755a8a.white_background.png></source></video><!-- 			<div id="button-container">\n		    	<a ui-sref=\'main\'>\n					<img src="../../assets/images/a4cdd864.GetStarted.png" class="centerImage">\n		        </a>\n			</div> --><div class=hero-container><div class=tagline><h2>The Collaborative Study Bible<br><span class=smaller>Encounter together.</span></h2></div><div class=home-main-cta><!-- <a href="" class="btn btn-large cta-explore">Explore <br><span class="tiny">everyword</span></a> --><a href="/main?guest=true" class="btn btn-large cta-main-get-started">Begin Reading<br><span class=tiny>{{contributions}} contributions and growing</span></a><p>Or <a href="/main?guest=true">explore everyword</a> as a guest</p></div></div></div><div class=home-intro-content><div class=container><div class=home-grid><div class=row><div class="home-grid-main-item text-center col-md-8 col-md-offset-2"><h2><span class="fa fa-pencil glyphicon-reverse" aria-hidden=true></span></h2><h3 class=big-title>Annotate the Bible</h3><p>Read together, learn together, come together</p><div class=embed-container><iframe src=https://www.youtube.com/embed/gjY3FBBTDOM frameborder=0 allowfullscreen></iframe></div></div></div><div class="home-grid-item text-center"><h2><span class="fa fa-heart" aria-hidden=true style="color: #af2b2b"></span></h2><h3>It’s Free</h3><p>You only have to sign up so that you can make annotations. Not sure, feel free to <a href="/main?guest=true">explore the site</a> before creating an account—but you won’t be able to comment.</p></div><div class="home-grid-item text-center"><h2><span class="fa fa-home" aria-hidden=true style="color: #6cb229"></span></h2><h3>Home feed</h3><p>A custom home feed brings in comments from the people you follow, your study groups, and your chosen hashtags so that when you open the Bible, you can enjoy yourself.</p></div><div class="home-grid-item text-center"><h2><span class="fa fa-star" aria-hidden=true style="color: #f9a11e"></span></h2><h3>Follow like-minded readers</h3><p>Follow hundreds of other readers through the text. Ask and answer questions real-time. Get updated when your favorite commentators add new material.</p></div><div class="home-grid-item text-center"><h2><span class="fa fa-users" aria-hidden=true style="color: #"></span></h2><h3>Create a study group</h3><p>Have all your friends come together and form a study group. Read each other\'s thoughts, share favorite verses, and engage in new ways with the text.</p></div><div class="home-grid-item text-center"><h2><span class="fa fa-video-camera" aria-hidden=true style="color: #3097D1"></span></h2><h3>Add media and references</h3><p>Connect your favorite books, sermons, blogs, poems, images, or YouTubes to specific verses of the Bible. Whatever takes your study to the next level.</p></div><div class="home-grid-item text-center"><h2><strong>#</strong></h2><h3>Track hashtags</h3><p>Use hashtags to track concepts, characters, and lines through the Bible. You can create new hashtags to organize your annotations and coordinate your efforts.</p></div><div class=clearfix></div></div><!-- /.home-grid --><div class="row get-started-cta"><div class="col-lg-6 col-lg-offset-3 col-md-8 col-md-offset-2 col-sm-12"><p class=pull-left>Begin a collaborative study of the Bible</p><a href=/main class="btn btn-cta pull-right">Open the Bible</a></div></div></div><!-- /.container --><div class=home-footer><div class=container><div class=col-md-6><p>&copy; Copyright everyword 2016</p></div><div class="col-md-6 footer-nav"><ul class=list-unstyled><li><a href=/support>Support us</a></li><li><a href="">Contact us</a></li><li><a href=mailto:everywordBible@gmail.com>Report an issue</a></li></ul></div></div></div></div><!-- /.home-intro-content --></div><!-- /.home-container --><!-- poster="../../assets/images/4126c743.everyword_logo.png" -->'),a.put("app/home/support-us.html",'<div class="container p-a-md"><div class=row style=background-color:#3097D1;color:#fff><h2 class="col-md-8 col-md-offset-2 text-xs-center">Supporters</h2><div id=support-list class="col-md-8 col-md-offset-2"><div class=text-xs-center ng-repeat="supporter in supporters">{{supporter.name}}<span ng-if="supporter.comment!==\'\'">:<br>{{supporter.comment}}</span></div><br></div></div></div>'),a.put("app/main/dailyReading.html",'<div class=modal-header><button type=button class=close ng-click=close()>&times;</button><h4 class=modal-title>Reading of the Day</h4></div><div id=passage style=width:100%;position:relative class="modal-body modal-body-scroller"><h1>{{book}} {{chapter}}</h1><hr><div ng-show=!loading id=verselist class=list-unstyled><div ng-repeat="v in verses" style=margin-bottom:8px><span uib-dropdown auto-close=disabled><a class=verse href="" id=verse{{v.verse}} uib-dropdown-toggle ng-click="selectedVerse=v;scrollToVerse(v)"><span ng-hide=!v.annoCount class="badge pull-right" style=background:lightGray;margin-right:10px>{{v.annoCount}}</span> {{v.verse}} - {{v.text}}</a><ul class=dropdown-menu uib-dropdown-menu template-url=tabs2.html aria-labelledby=verseSpan{{v.verse}}><!-- 		          <li ng-if="selectedVerse===v" role="menuitem"> --><!-- 			        <div ew-annotations  --><!-- 			            selected="selectedVerse===v" --><!-- 						book="book" --><!-- 				    	chapter="chapter" --><!-- 				    	verse="v" --><!-- 				    	user="currentUser" --><!-- 				    	following="following||[]" --><!-- 				    	 groups="groups||[]"> --><!-- 					</div> --><!-- 				  </li> --></ul></span></div></div></div><div class=modal-footer><button type=button class="btn btn-default" ng-click=close()>Close</button></div><script type=text/ng-template id=tabs2.html><li role="menuitem">\n	        <ew-annotations ng-if="selectedVerse===v"\n                selected="selectedVerse===v"\n				book="book"\n		    	chapter="chapter"\n		    	verse="v"\n		    	user="currentUser"\n		    	following="following||[]"\n		    	 groups="groups||[]"\n                update-callback="updateAnnoCounts">\n			</ew-annotations>\n		  </li></script>'),a.put("app/main/featuredComment.html",'<div class=modal-header><button type=button class=close ng-click=close()>&times;</button><h4 class=modal-title>Daily Devotional</h4></div><div id=comment style=width:100%;position:relative class="media-list media-list-stream modal-body modal-body-scroller"><a class=media-left href=#><img class=media-object style="border-radius: 10px" src={{featured.img}}></a><div class=media-body><div class=media-heading><span class=pull-right><a ng-if="anno!==undefined" id=reference{{featured.comment._id}} href=# ng-mouseover="showScripture(featured.comment._id, anno)" ng-click=gotoAnnotation(comment._id);close();><span class="glyphicon glyphicon-book"></span></a></span><h5><a href=javascript:void()>{{featured.user.name}}</a> - {{featured.date|date}}</h5></div><div ng-if=comment ew-comment comment=comment following="following || []" user=user like-callback=updateLikes fulltext></div><div ng-if=media ew-media-item media=media user=user following=following||[] like-callback=updateLikes full-image></div></div><div class=modal-footer><button type=button class="btn btn-default" ng-click=close()>Close</button></div></div>'),a.put("app/main/main.html",'<script>document.body.style.backgroundColor = "#f2f3f7";</script><div class="container p-t-md"><div class=row><div class=col-md-3><div class="panel panel-default panel-profile m-b-sm"><div class="panel-heading text-center" style="background-image: url(../../assets/images/ed1cc350.open-bible.jpg)"><h3 class=profile-header-user><em>Begin Reading</em></h3></div><div class="panel-body text-center"><!-- 		      <a ui-sref=\'testaments\' class="btn btn-primary" style=\'text-decoration:none;margin:0;\'>Begin Reading</a> --><ul class=panel-menu><li class=panel-menu-item><a ui-sref=ot>Old<br>Testament</a></li><li class=panel-menu-item><a ui-sref=nt>New<br>Testament</a></li></ul></div></div><div ng-if=verseOfTheDay class="panel panel-default m-b-md visible-xs visible-sm"><div class=panel-body><h5 class=m-t-0><strong><em>Verse of the Day</em></strong></h5><p><a href=# ng-click=viewDailyReading(verseOfTheDay.verse);$event.preventDefault()>{{verseOfTheDay.verse.book}} {{verseOfTheDay.verse.chapter}}<span ng-if="verseOfTheDay.verse.verses && verseOfTheDay.verse.verses.length!=0">:</span>{{verseOfTheDay.verse.verses}}</a><div ng-bind-html="verseOfTheDay.text | unsafe" style="overflow-y:hidden;text-overflow: ellipsis;height:85px"></div><a href=javascript:void(0) ng-click=viewDailyReading(verseOfTheDay.verse) class=small>More...</a></p><div class=small>Powered by <a rel=nofollow href="https://www.biblegateway.com/">BibleGateway.com</a></div></div></div><div ng-if=showChristmasMessage||readingOfDay class="panel panel-default panel-profile m-b-md visible-xs visible-sm"><div class="panel-heading text-center" style="background-image: url(../../assets/images/2c613829.open-book.jpg)"></div><div ng-if=showChristmasMessage class=panel-body><h2 class=m-t-0>Christmas Reading list:</h2><p>As an interfaith Bible study group, we will be studying the Christmas story this December. We\'ve attached an outline of our reading schedule. Please invite your friends, families, and neighbors to read along with us.</p><p>Check below to view the reading for the day.</p><a href=javascript:void(0) data-lity-target=../../assets/images/c47b6591.ChristmasReadinglist.png data-lity>Reading List</a></div><h5 class=m-t-0><strong>Today\'s Reading</strong></h5><p ng-repeat="v in readingOfDay.verses"><a href=# ng-click=viewDailyReading(v);$event.preventDefault()>{{v.book}} {{v.chapter}}<span ng-if="v.verses && v.verses.length!=0">:</span>{{v.verses}}</a></p><br></div><div ng-if=featureComment class="panel panel-default panel-profile m-b-md visible-xs visible-sm"><div class="panel-heading text-center" style="background-image: url({{featuredComment.img}})"></div><div class=panel-body><h4 class=m-t-0><strong>Daily Devotional</strong></h4><h4>{{featuredComment.Commenter}}</h4><section>{{featuredComment.Bio}}</section><div><h5 class=m-b-0><em>Verse(s)</em></h5><p ng-repeat="v in featuredComment.scriptures"><a href=# ng-click=viewDailyReading(v);$event.preventDefault()>{{v.book}} {{v.chapter}}<span ng-if="v.verses && v.verses.length!=0">:</span>{{v.verses}}</a></p></div><!-- 	          	<div class="more-text" content="featuredComment.comments" more-action="viewFeaturedComment" show-char="100" style="margin:0"></div> --><div><p ng-if=featuredComment.comment style="overflow-y:hidden;text-overflow: ellipsis;height:200px">{{featuredComment.comments}}</p><div ng-if=featuredComment.media><a href=# data-lity-target={{featuredComment.media.image.url}} data-lity><img class=img-responsive src={{featuredComment.media.image.url}} title={{featuredComment.media.name|unsafe}} data-action="zoom"></a></div><a href=javascript:void(0) ng-click=viewFeaturedComment() class=small>More...</a></div></div></div><div class="panel panel-default visible-sm-block visible-md-block visible-lg-block"><div class=panel-body style=display:none><p class=text-uppercase>Places</p><ul class=list-unstyled><li><a href=javascript:void(0) style=text-decoration:none>Last Visited</a></li><li><a href=javascript:void(0) style=text-decoration:none>Notebook</a></li></ul></div></div><div class="panel panel-default visible-sm-block visible-md-block visible-lg-block"><div class=panel-body><h5 class=m-t-0>Groups <small><a ng-hide="currentUser.role===\'guest\'" ui-sref=groups>Edit</a></small></h5><ul class="media-list media-list-stream"><li class="media m-b" ng-repeat="group in homebase.groups| limitTo: 10"><a href=/group/{{group._id}}><span class="fa fa-users"></span> {{group.name}}</a></li></ul><a ui-sref=groups ng-if="homebase.groups.length>10"><small>More</small></a></div></div><div class="panel panel-default m-b-md visible-sm-block visible-md-block visible-lg-block"><div class=panel-body><h5 class=m-t-0>Following <small><a ng-hide="currentUser.role===\'guest\'" ui-sref=following>Edit</a></small></h5><ul class="media-list media-list-stream"><li class="media m-b" ng-repeat="follow in homebase.following | limitTo: 10 track by $index"><a class=media-left href=#><img class="avatar-list-item img-circle" src=../../assets/images/d8794517.avatar_placeholder.png></a><div class=media-body><strong><a href="" ng-click="selectedUser=follow.name;filterByUser(follow.name)">{{follow.name}}</a></strong><div class=media-body-actions><button ng-hide="currentUser.role===\'guest\'" class="btn btn-primary-outline btn-sm" ng-click=unfollow(follow);><span class="icon icon-remove-user"></span>Unfollow</button></div></div></li></ul><a ui-sref=following ng-if="homebase.following.length>10"><small>More</small></a></div></div><div ng-if="currentUser.role!==\'guest\'" class="panel panel-default panel-link-list visible-sm-block visible-md-block visible-lg-block"><div class=panel-body><h5 class=m-t-0>Hashtags <small><a href=javascript:void(0) ng-click=showTags()>Edit</a></small>&nbsp;&nbsp;<small><a href=javascript:void(0) ng-click="tags.selectedTag=\'\'">Clear</a></small></h5><tag-links tags=homebase.tags selected-tag=tags.selectedTag></tag-links></div></div></div><div class=col-md-6><div ng-if="currentUser.role!==\'guest\'" class="panel panel-default panel-link-list visible-xs-block"><div class=panel-body><h5 class=m-t-0>Hashtags <small><a href=javascript:void(0) ng-click=showTags()>Edit</a></small>&nbsp;&nbsp;<small><a href=javascript:void(0) ng-click="tags.selectedTag=\'\'">Clear</a></small></h5><tag-links tags=homebase.tags selected-tag=tags.selectedTag></tag-links></div></div><div ng-if="selectedUser!==\'\'" class=pull-left><a href=# ng-click=clearFilter()>All</a></div><br ng-if="selectedUser!==\'\'"><ul class="list-group media-list media-list-stream" infinite-scroll=loadMore() infinite-scroll-disabled=loading infinite-scroll-distance=2><li ng-if=showChristmasMessage class="media list-group-item p-a hidden-xs hidden-sm"><div class=media-body><div class=media-heading><h2 class=m-t-0>Christmas Reading list:</h2><p>As an interfaith Bible study group, we will be studying the Christmas story this December. We\'ve attached an outline of our reading schedule. Please invite your friends, families, and neighbors to read along with us.</p><p>Check to the right to view the reading for the day.</p><a href=javascript:void(0) data-lity-target=../../assets/images/c47b6591.ChristmasReadinglist.png data-lity>Reading List</a></div></div></li><li ng-if=showWelcome class="media list-group-item p-a"><div class=media-body><div class=media-heading><h2 class=m-t-0>Welcome!</h2><p>Welcome to everywordBible! Go ahead and begin reading. Click on a verse of scripture to access footnotes or annotations from other users. Feel free to engage or just take a peek. If you like what someone else is saying, follow them and their comments will show up in your feed. When you comment, you can publish it publicly, privately, or within a study group. You can create your own study group and invite friends. Still unsure what to do? <a href=https://youtu.be/n6s3oXgCRzI data-lity>Watch this video for a quick tutorial</a>.</p></div></div></li><li class="media list-group-item p-a" ng-repeat="f in visibleFeed | filter:tags.selectedTag | filter:{\'postedBy\':selectedUser} track by $index"><a class=media-left href=#><img class="avatar-list-item img-circle" src=../../assets/images/d8794517.avatar_placeholder.png></a><div class=media-body><div class=media-heading><span class=pull-right><a ng-if=f.group id=groupLink{{f._id}} ng-mouseover=showGroup(f._id,f.group) href=/group/{{f.group._id}}><span class="fa fa-users"></span></a><br><a ng-if="f.anno!==undefined" id=reference{{f._id}} href=# ng-mouseover="showScripture(f._id, f.anno)" ng-click=gotoAnnotation(f._id)><span class="glyphicon glyphicon-book"></span></a></span><h5><a href="" ng-click="selectedUser=f.user.name;filterByUser(f.user.name)">{{f.user.name}}</a> - {{f.date|date}}</h5></div><div ng-if=f.comment ew-comment comment=f.comment following="homebase.following || []" user=currentUser update-callback=reload delete-callback=reload like-callback=updateLikes></div><!--                 <p ng-if="f.comment">{{f.comment.text}}</p> --><div ng-if=f.reference ew-reference reference=f.reference user=currentUser following=homebase.following||[] delete-callback=reload like-callback=updateLikes></div><div ng-if=f.media ew-media-item media=f.media user=currentUser following=homebase.following||[] delete-callback=reload like-callback=updateLikes></div></div></li><!--             </div> --><!--             </div> --></ul></div><!--     </div> --><div class=col-sm-3><div ng-if=verseOfTheDay class="panel panel-default m-b-md hidden-xs hidden-sm"><div class=panel-body><h5 class=m-t-0><strong><em>Verse of the Day</em></strong></h5><p><a href=# ng-click=viewDailyReading(verseOfTheDay.verse);$event.preventDefault()>{{verseOfTheDay.verse.book}} {{verseOfTheDay.verse.chapter}}<span ng-if="verseOfTheDay.verse.verses && verseOfTheDay.verse.verses.length!=0">:</span>{{verseOfTheDay.verse.verses}}</a><div ng-bind-html="verseOfTheDay.text | unsafe" style=overflow-y:hidden;height:85px></div><a href=javascript:void(0) ng-click=viewDailyReading(verseOfTheDay.verse) class=small>More...</a></p><div class=small>Powered by <a rel=nofollow href="https://www.biblegateway.com/">BibleGateway.com</a></div></div></div><div ng-if=readingOfDay class="panel panel-default panel-profile m-b-md hidden-xs hidden-sm"><div class="panel-heading text-center" style="background-image: url(../../assets/images/2c613829.open-book.jpg)"></div><div class=panel-body><h5 class=m-t-0><strong>Today\'s Reading</strong></h5><p ng-repeat="v in readingOfDay.verses"><a href=# ng-click=viewDailyReading(v);$event.preventDefault()>{{v.book}} {{v.chapter}}<span ng-if="v.verses && v.verses.length!=0">:</span>{{v.verses}}</a></p><br></div></div><div ng-if=featuredComment class="panel panel-default panel-profile m-b-md hidden-xs hidden-sm"><div class="panel-heading text-center" style="background-image: url({{featuredComment.img}});background-position: center"></div><div class=panel-body><h4 class=m-t-0><strong>Daily Devotional</strong></h4><h4>{{featuredComment.Commenter}}</h4><section>{{featuredComment.Bio}}</section><div><h5 class=m-b-0><em>Verse(s)</em></h5><p ng-repeat="v in featuredComment.scriptures"><a href=# ng-click=viewDailyReading(v);$event.preventDefault()>{{v.book}} {{v.chapter}}<span ng-if="v.verses && v.verses.length!=0">:</span>{{v.verses}}</a></p></div><!-- 	          	<div class="more-text" content="featuredComment.comments" more-action="viewFeaturedComment" show-char="100" style="margin:0"></div> --><div><p ng-if=featuredComment.comment style="overflow-y:hidden;text-overflow: ellipsis;height:200px">{{featuredComment.comments}}</p><div ng-if=featuredComment.media><a href=# data-lity-target={{featuredComment.media.image.url}} data-lity><img class=img-responsive src={{featuredComment.media.image.url}} title={{featuredComment.media.name|unsafe}} data-action="zoom"></a></div><a href=javascript:void(0) ng-click=viewFeaturedComment() class=small>More...</a></div></div></div></div><!--     <div class="col-sm-2"> --><!--       <span>Ad pane</span> --><!--     </div> --></div></div><!-- \n<header class="hero-unit" id="banner">\n  <div class="container">\n    <h1>\'Allo, \'Allo!</h1>\n    <p class="lead">Kick-start your next web app with Angular Fullstack</p>\n     <img src="assets/images/yeoman.png" alt="I\'m Yeoman">\n  </div>\n</header>\n\n<div class="container">\n  <div class="row">\n    <div class="col-lg-12">\n      <h1 class="page-header">Features:</h1>\n      <ul class="nav nav-tabs nav-stacked col-md-4 col-lg-4 col-sm-6" ng-repeat="thing in awesomeThings">\n        <li><a href="#" tooltip="{{thing.info}}">{{thing.name}}<button type="button" class="close" ng-click="deleteThing(thing)">&times;</button></a></li>\n      </ul>\n    </div>\n  </div>\n\n  <form class="thing-form">\n    <label>Syncs in realtime across clients</label>\n    <p class="input-group">\n      <input type="text" class="form-control" placeholder="Add a new thing here." ng-model="newThing">\n      <span class="input-group-btn">\n        <button type="submit" class="btn btn-primary" ng-click="addThing()">Add New</button>\n      </span>\n    </p>\n  </form>\n</div>\n\n<footer class="footer">\n  <div class="container">\n      <p>Angular Fullstack v2.1.1 |\n        <a href="https://twitter.com/tyhenkel">@tyhenkel</a> |\n         <a href="https://github.com/DaftMonk/generator-angular-fullstack/issues?state=open">Issues</a></p>\n  </div>\n</footer>\n-->'),a.put("app/messages/add_recipients.html",'<div class=modal-header><h3 class=modal-title>Add Recipient</h3></div><div class=modal-body><form role=form><label for=sel2>Select User(s):</label><!--       <select multiple class="form-control" id="sel2" --><!--           ng-options="" ng-model="selected"> --><!--       </select> --><div style="overflow-y:auto;overflow-x:hidden;height:200px;border:1px solid lightGray"><div class=list-group><div class="list-group-item row" ng-repeat="user in users track by user._id"><div class="col-sm-4 text-center">{{ user.name }}</div><div class=col-sm-4 ng-show="selected.indexOf(user) === -1 && recipients.indexOf(user) ===-1"><a href=# class="btn btn-primary btn-block" ng-click=selectUser(user)>Select</a></div><div class=col-sm-4 ng-show="selected.indexOf(user) !== -1 || recipients.indexOf(user) !== -1"><span class="text-muted pull-left">Selected</span> <button type=button ng-click=unselectUser(user) class=close>&times;</button></div></div></div></div><br><label for=emailForm>Add email:</label><div class=row><div class=col-sm-8><input class=form-control ng-model=inviteEmail></div><button class="btn btn-primary col-sm-2" type=button id=emailForm ng-click=addEmail(inviteEmail)>Add</button></div><br><div class=well style=height:100px><ul ng-repeat="member in emails.concat(newEmails)"><li>{{member}}</li></ul></div></form></div><div class=modal-footer style=text-align:center><button class="btn btn-primary" type=button ng-click=ok()>OK</button> <button class="btn btn-warning" type=button ng-click=cancel()>Cancel</button></div>'),a.put("app/messages/message-compose.html",'<form role=form name=form class="compose-form ng-pristine ng-valid" ng-submit=send(form) novalidate><div class=form-group><tags-input ng-model=recipients placeholder="Add Recipients" display-property=name key-property=name replace-spaces-with-dashes=false on-tag-added=updateRecipients($tag)><auto-complete source=loadUsers($query)></auto-complete></tags-input><!--         <a href=\'#\' style="display:block" ng-click="addRecipients()">\n         <input type="text" name="recipient" class="form-control" ng-model="message.recipients" placeholder="To:" required>\n        </a>\n --></div><!--     <div class="form-group">\n        <input type="text" class="form-control" ng-model="message.ccRecipient" placeholder="CC:">\n    </div>\n --><div class=form-group><input name=subject class=form-control ng-model=message.subject placeholder=Subject: required></div><div class=form-group><textarea id=wysiwyg name=body ng-model=message.body placeholder="Your message here..." class=form-control rows=20 required></textarea></div><div class="form-group has-error"><p class=help-block ng-show="form.recipient.$error.required && submitted">Please enter recipient name or email.</p><p class=help-block ng-show="form.subject.$error.required && submitted">Please enter a subject.</p><p class=help-block ng-show="form.body.$error.required && submitted">Please enter a message body.</p><p class=help-block>{{ errors.other }}</p></div><div class=form-group><button type=submit class="btn btn-primary btn-md" ng-disabled=!recipients.length||!message.body||!message.subject>Send</button> <button type=button class="btn btn-md" ng-click="$state.go(\'messages.list\')">Cancel</button></div></form>'),a.put("app/messages/message-main.html",'<script>document.body.style.backgroundColor = "#f2f3f7";</script><div class="content-wrapper container"><div class=row><div class=col-sm-12><div class=page-title><h1>{{title}}</h1></div></div></div><div class=row><div class=col-md-3><div class=mail-side-bar><div class="text-center margin-b-30"><a ui-sref=messages.compose ng-disabled="$state.current.name===\'messages.compose\'" class="btn btn-danger">Compose</a></div><ul class=list-unstyled><!-- list-group media-list media-list-stream" infinite-scroll=\'loadMore()\' infinite-scroll-disabled=\'loading\' infinite-scroll-distance=\'2\' --><li class=text-primary>Folders</li><li><a ui-sref=messages.list ng-click=showAllMessages()>Inbox</a> <span ng-show="(messages | unread).length>0"><div class=badge>{{(messages | unread).length}}</div></span></li><li><a href=#>Sent Mail</a></li><li><a href=#>Archives</a></li></ul><ul class=list-unstyled><li class=text-primary>Categories</li><li ng-repeat="item in menu.items"><a ui-sref=messages.list ng-click=filterMessages(item)>{{item}}s</a></li></ul><!-- 				<div class="panel-default" is-open="menu.open">\n			      <uib-accordion-heading>\n			       {{selectedType || "All Message"}}s<i class="pull-right glyphicon" ng-class="{\'glyphicon-chevron-down\': menu.open, \'glyphicon-chevron-right\': !menu.open}"></i>\n			      </uib-accordion-heading>\n			      \n			    </div>\n --></div></div><!-- 	</div> --><div class=col-md-9><div ui-view></div></div></div></div>'),a.put("app/messages/message-view.html",'<div class=col-md-9><div class=mail-box-header><div class=pull-right><a ui-sref="messages.compose({action: \'reply\', message: currentMessage})" class="btn btn-success btn-sm" data-toggle=tooltip data-placement=top title=Reply><i class="fa fa-reply"></i> Reply</a><!--                     <a href="#" class="btn btn-info btn-sm" data-toggle="tooltip" data-placement="top" title="Print email"><i class="fa fa-print"></i> </a> --> <a href=# class="btn btn-danger btn-sm" ng-click=deleteMessages([currentMessage]); data-toggle=tooltip data-placement=top title="Move to trash"><i class="fa fa-trash-o"></i></a></div><h2>{{currentMessage.subject}}</h2><div><!--                     <h3> --><!--                         <span>Subject: </span> randomised words --><!--                     </h3> --><h5><span class=pull-right>{{currentMessage.date | date}}</span> <span>From:</span>{{currentMessage.from.name}}</h5></div></div><div class="mail-box clearfix"><p ng-bind-html="currentMessage.body | unsafe"><br><div ng-show="currentMessage.hasAction && !actionComplete"><button type=button class="btn btn-primary" ng-click=performAction(currentMessage.action)>Accept</button>&nbsp;&nbsp; <button type=button class="btn btn-danger" ng-click=performAction(currentMessage.action,true)>Reject</button></div><div class="alert alert-success" ng-show=actionComplete><strong>Action Successful!</strong></div></p></div></div>'),a.put("app/messages/messages.html",'<div class=row><div class="col-sm-6 mail-box-row-2"><!--  					<div style="margin-right:10px" class="btn-group pull-left">\n                         <div class="btn btn-sm btn-default bg-amber" ng-click="showAllMessages()">\n                             <input type="checkbox" ng-click="selectAll()" style="margin:0 5px;padding:0;position:relative;top:2px;">\n                             <a href=\'#\' >All</a></div>\n                         <button type="button" class="btn btn-sm btn-default dropdown-toggle bg-amber" data-toggle="dropdown" aria-expanded="false">\n                             <span class="caret"></span>\n                             <span class="sr-only">Toggle Dropdown</span>\n                         </button>\n                         <ul class="dropdown-menu" role="menu">\n                             <li><a href="#">Read</a>\n                             </li>\n                             <li><a href="#">Unread</a>\n                             </li>\n                         </ul>\n                     </div>\n					 <div style="margin-right:10px" class="btn-group pull-left">\n                        <button ng-disabled="selectedMessages.length===0" type="button" class="btn btn-sm btn-default dropdown-toggle bg-amber" data-toggle="dropdown" aria-expanded="false">More\n                            <span class="caret"></span>\n                        </button>\n                        <ul class="dropdown-menu" role="menu" >\n                            <li><a href="#" ng-click="markAsRead(selectedMessages)"><i class="fa fa-pencil"></i> Mark as Read</a>\n                            </li>\n                            <li><a href="#" ng-click="archive(selectedMessages)"><i class="fa fa-ban"></i> Archive</a>\n                            </li>\n                            <li class="divider"></li>\n                            <li><a href="#" ng-click="deleteMessages(selectedMessages)"><i class="fa fa-trash-o"></i> Delete</a>\n                            </li>\n                        </ul>\n                    </div>\n --><button ng-click=refreshList() style=margin-right:10px type=button data-color=#39B3D7 data-opacity=0.95 class="btn btn-sm btn-default button test pull-left bg-amber"><span class="fa fa-refresh"></span>&nbsp;&nbsp;Refresh</button></div><!-- 			<div class="col-sm-6">\n                <div class="btn-group  pull-right ">\n                    <button type="button" class="btn btn-sm btn-default bg-amber">\n                        <span class="fa fa-angle-left"></span>\n                    </button>\n                    <button type="button" class="btn btn-default btn-sm bg-amber">\n                        <span class="fa fa-angle-right"></span>\n                    </button>\n                </div>\n                <div class="btn-group pull-right " style="margin-right:10px;">\n                    <button type="button" class="btn btn-default btn-sm bg-amber">1-50 of 124</button>\n                </div>\n            </div>\n --></div><div class=table-responsive><table class="table table-mailbox table-hover"><tbody><tr class=unread ng-click=rowClicked($event,internalIndex(message)) ng-repeat="message in filteredMessages track by $index"><!-- 						<td class="small-col"><input type="checkbox" ng-click="updateSelectedMessages($event,message)"></td> --><!-- 						<td class="small-col"><i class="fa fa-star"></i></td> --><td class=name><a href=#><img class="avatar-list-item img-circle" src=../../assets/images/d8794517.avatar_placeholder.png></a></td><td><a href=# ng-click=filterByUser(message.from)>{{message.from.name}}</a></td><td class=subject><p class=email-summary><a ui-sref="messages.view({ idx: internalIndex(message)})">{{message.subject}}</a></p></td><td class="time text-right">{{message.date | date}}</td><td class=small-col><button class="btn btn-danger btn-sm" ng-click=deleteMessages([message]) data-toggle=tooltip data-placement=top title="Move to trash"><i class="fa fa-trash-o"></i></button></td></tr></tbody></table></div><!-- 		<div class="panel panel-default" style="height:700px">\n		  <div class="panel-heading">\n		    <h3 class="panel-title">{{currentMessage.subject}}</h3>\n		  </div>\n		  <div class="panel-body">\n			<div class="page-header">\n			  <h4>From: <img class="avatar-list-item img-circle" src="../../assets/images/d8794517.avatar_placeholder.png"> <small>{{currentMessage.from.name}}</small></h4>\n			</div>		  \n		    <p ng-bind-html="currentMessage.body | unsafe"><br/>\n		    <div ng-show=\'currentMessage.hasAction && !actionComplete\'>\n		    	<button type="button" class="btn btn-primary" ng-click=\'performAction(currentMessage.action)\'>Accept</button>&nbsp;&nbsp;\n		    	<button type="button" class="btn btn-danger" ng-click=\'performAction(currentMessage.action,true)\'>Reject</button>\n		    </div>		\n			<div class="alert alert-success" ng-show=\'actionComplete\'>\n			  <strong>Action Successful!</strong>\n			</div>\n		  </div>\n		</div>\n --><!--  	</div>\n	</div>\n</div> -->'),
a.put("app/reading/books/books.html",'<div class="container p-t-md"><h1 id=books-title>{{testamentTitle}} Books</h1><div class=outer-container><div class="row list-container"><ul class=list-inline><li ng-repeat="book in books"><div class=books><div class=book-div><a href=/chapters/{{testament}}/{{book.name}}><img ng-if="testament===\'ot\'" class="img-responsive testament-icon" src=../../../assets/images/a108f6e9.old_testament_bible.svg onerror="this.src=\'../../../assets/images/6c6bf868.old_testament_bible.png\'"><img ng-if="testament===\'nt\'" class="img-responsive testament-icon" src=../../../assets/images/f9150cfc.bible_2.svg onerror="this.src=\'../../../assets/images/b7bb1b4c.bible_2.png\'"><span class=book-name>{{book.name}}</span></a></div></div></li></ul></div></div></div>'),a.put("app/reading/chapter/chapter.html",'<div class="container p-t-md"><h1 id=chapters-title>{{book}} Chapters</h1><div class=outer-container><div class="row list-container"><ul class=list-inline><li ng-repeat="chapter in chapters" style=width:100px;height:100px><div class=chapters><div class=chapter-div><a href=/scripture/{{testament}}/{{book}}/{{chapter}}><img class="img-responsive chapter-icon" src=../../../assets/images/2c200201.page-blank.svg onerror="this.src=\'../../../assets/images/74563b4a.page-blank.png\'" style=width:100%;height:100%><span class=chapter>{{chapter}}</span></a></div></div></li></ul></div></div></div>'),a.put("app/reading/scripture/annotations/annotations.html",'<uib-tabset><uib-tab ng-repeat="tab in tabs" active=tab.active ng-click=tabChanged()><uib-tab-heading><span><span ng-show="tabs[$index].annoCount>0" class=annotation_count>{{tabs[$index].annoCount}}</span> <img class=tab-image uib-tooltip={{tab.title}} tooltip-append-to-body=true tooltip-placement=right src={{tab.image}}></span></uib-tab-heading><div ng-include=tab.content ng-click=$event.stopPropagation()></div></uib-tab></uib-tabset>'),a.put("app/reading/scripture/comments/comment-form.html",'<div class="form-group panel panel-default"><div class=panel-body><textarea class=form-control placeholder="Add a new comment here." ng-model=newComment></textarea><br><div><button class="btn btn-primary pull-left" ng-show="newComment!=&quot;&quot;" ng-click=add()>Post</button><div class=pull-right><a ng-class="{\'text-muted\': !groupOnly}" href id=group-action ng-click=toggleVisibility(true,true);$event.stopPropagation() ng-show="newComment!=&quot;&quot;"><span class="fa fa-users" uib-tooltip={{groupFootnote}} tooltip-append-to-body=true tooltip-placement=bottom></span></a> &nbsp;&nbsp;</div><a ng-class="{\'text-muted\' : !privateComment || groupOnly}" class=pull-right href ng-click=toggleVisibility(true,false);$event.stopPropagation() ng-show="newComment!=&quot;&quot;"><span class="glyphicon glyphicon-eye-close" uib-tooltip="Only Visible to Me" tooltip-append-to-body=true tooltip-placement=bottom></span> &nbsp;&nbsp;</a> <a ng-class="{\'text-muted\' : privateComment || groupOnly}" class=pull-right href ng-click=toggleVisibility(false,false);$event.stopPropagation() ng-show="newComment!=&quot;&quot;"><span class="glyphicon glyphicon-eye-open" uib-tooltip="Visible to All" tooltip-append-to-body=true tooltip-placement=bottom></span> &nbsp;&nbsp;</a></div></div></div>'),a.put("app/reading/scripture/comments/comments.html",'<div ng-if=includeHeading class=media-heading href=#><img class="avatar-list-item img-circle" src=../../../../assets/images/d8794517.avatar_placeholder.png> <span class=text-primary>{{comment.user.name}}</span>&nbsp;&nbsp; <span class=text-muted>{{comment.date|date}}</span></div><div class=media-body><!--    <div ng-if=\'includeHeading\' class="media-heading">\n	   <span class=\'text-primary\'>{{comment.user.name}}</span>\n	   <span class=\'text-muted pull-right\'>{{comment.date|date}}</span>\n   </div>\n --><div ng-if=!isEditing><div class=more-text content=comment.text expandable=!fulltext style=margin:0></div><span class=comment-buttons><a ng-if=!isEditing href="" uib-tooltip=Edit tooltip-append-to-body=true tooltip-placement=bottom ng-hide="comment.user._id!==user._id" ng-click=toggleEditComment();$event.stopPropagation()><span class="fa fa-pencil" style=color:#428bca></span>&nbsp;</a> <a ng-if=!isEditing href="" uib-tooltip=Delete tooltip-append-to-body=true tooltip-placement=bottom ng-hide="comment.user._id!==user._id" ng-click=deleteComment(comment);$event.stopPropagation()><span class="fa fa-close" style=color:#428bca></span>&nbsp;</a> <a ng-hide="user.role===\'guest\'" ng-if="comment.user._id!==user._id && !isFollowing(comment.user)" href="" uib-tooltip=Follow tooltip-append-to-body=true tooltip-placement=bottom ng-click=follow(comment.user);$event.stopPropagation()><span class="fa fa-user" style=color:#428bca></span>&nbsp;</a> <a href=javascript:void(0) uib-tooltip=Remark tooltip-append-to-body=true tooltip-placement=bottom ng-click=toggleRemarkForm();$event.stopPropagation()><span class="fa fa-comment" style=color:#428bca></span>&nbsp;</a> <a ng-if="user.likes.indexOf(comment._id)===-1" href uib-tooltip=Like tooltip-append-to-body=true tooltip-placement=bottom ng-click=like();$event.stopPropagation()><span><span class="fa fa-thumbs-o-up" style=color:#428bca></span> <span ng-if="comment.likes>0" class=notification_count>{{comment.likes}}</span></span></a></span> <span ng-if="user.likes.indexOf(comment._id)!==-1" style=color:#428bca;font-weight:500;font-size:11px><span ng-show="comment.likes>0"><div class=badge>{{comment.likes}}</div>&nbsp;Likes</span></span></div><div ng-if=isEditing><div class=form-group><textarea class=form-control ng-model=editComment.text></textarea><button style=margin-top:5px class="btn btn-primary pull-right" ng-click=cancelEditComment();$event.stopPropagation()>Cancel</button> <button style=margin-top:5px class="btn btn-primary pull-right" ng-enable="comment.text && comment.text!=\'\'" ng-click=updateComment(comment)>Update</button> <a class=pull-right href ng-click="editComment.isPrivate = !editComment.isPrivate;$event.stopPropagation()" ng-show="comment.text!=&quot;&quot;"><span ng-if=!editComment.isPrivate class="glyphicon glyphicon-eye-open" style=color:#428bca uib-tooltip="Visible to All" tooltip-append-to-body=true tooltip-placement=bottom></span> <span ng-if=editComment.isPrivate class="glyphicon glyphicon-eye-close" style=color:#428bca uib-tooltip="Only Visible to Me" tooltip-append-to-body=true tooltip-placement=bottom></span></a></div></div><!--    <hr ng-if="comment.remarks && comment.remarks.length>0" style="background:lightgray;opacity:0.3; border:0; height:1px" /> --><ul ng-if="comment.remarks && comment.remarks.length>0" class="media-list media-list-stream"><li class=media ng-repeat="remark in comment.remarks"><div ng-if=includeHeading class=media-left style=padding-left:20px></div><div class=media-body style=clear:right><div class=media-heading href=#><img class="avatar-list-item img-circle" src=../../../../assets/images/d8794517.avatar_placeholder.png> <strong>{{remark.user.name}}</strong><span ng-if=remark.date>- {{remark.date | date}}</span></div><div class=more-text content=remark.remark style=margin:0></div></div></li></ul></div><div ng-if=remarkSent uib-alert close=acknowledge() dismiss-on-timeout=2000><strong>Remark has been submitted for approval</strong></div><div ng-if=remarkForm.isShowing id=remarkForm{{comment._id}}><div class=form-group><textarea class=form-control placeholder="Add remark here." ng-model=remarkForm.content></textarea><button style=margin-top:5px class="btn btn-primary pull-right" ng-disabled="!remarkForm.content || remarkForm.content===\'\'" ng-click=toggleRemarkForm()>Cancel</button> <button style=margin-top:5px class="btn btn-primary pull-right" ng-disabled="!remarkForm.content || remarkForm.content===\'\'" ng-click=addRemark()>Post</button></div></div>'),a.put("app/reading/scripture/media/media-item.html",'<div ng-if=includeHeading class=media-heading href=#><img class="avatar-list-item img-circle" src=../../../../assets/images/d8794517.avatar_placeholder.png> <span class=text-primary>{{media.user.name}}</span>&nbsp;&nbsp; <span class=text-muted>{{media.date|date}}</span></div><div class=media-body><div ng-if=media.image><a href=# data-lity-target={{media.image.url}} data-lity><img ng-if=!fullImage class=img-responsive src={{media.image.url}} title={{media.name|unsafe}} data-action="zoom"> <img ng-if=fullImage style=width:600px;height:800px src={{media.image.url}} title={{media.name|unsafe}} data-action="zoom"></a></div><div class="embed-responsive embed-responsive-16by9" ng-if="media.type===\'video\'"><embed-video ng-href={{media.url}} controls>Watch</embed-video></div><div ng-if=!isEditing><div class=more-text content=media.description style=margin:0></div><span class=comment-buttons><a ng-if=!isEditing href="" uib-tooltip=Edit tooltip-append-to-body=true tooltip-placement=bottom ng-hide="media.user._id!==user._id" ng-click=toggleEditComment();$event.stopPropagation()><span class="fa fa-pencil" style=color:#428bca></span>&nbsp;</a> <a ng-if=!isEditing href="" uib-tooltip=Delete tooltip-append-to-body=true tooltip-placement=bottom ng-hide="media.user._id!==user._id" ng-click=deleteComment(media);$event.stopPropagation()><span class="fa fa-close" style=color:#428bca></span>&nbsp;</a> <a ng-hide="user.role===\'guest\'" ng-if="media.user._id!==user._id && !isFollowing(media.user)" href="" uib-tooltip=Follow tooltip-append-to-body=true tooltip-placement=bottom ng-click=follow(media.user);$event.stopPropagation()><span class="fa fa-user" style=color:#428bca></span>&nbsp;</a> <a href="" uib-tooltip=Remark tooltip-append-to-body=true tooltip-placement=bottom ng-click=toggleRemarkForm();$event.stopPropagation()><span class="fa fa-comment" style=color:#428bca></span>&nbsp;</a> <a ng-if="user.likes.indexOf(media._id)===-1" href uib-tooltip=Like tooltip-append-to-body=true tooltip-placement=bottom ng-click=like();$event.stopPropagation()><span><span class="fa fa-thumbs-o-up" style=color:#428bca></span> <span ng-if="media.likes>0" class=notification_count>{{media.likes}}</span></span></a></span> <span ng-if="user.likes.indexOf(media._id)!==-1" style=color:#428bca;font-weight:500;font-size:11px><span ng-show="media.likes>0"><div class=badge>{{media.likes}}</div>&nbsp;Likes</span></span></div><div ng-if=isEditing><div class=form-group><textarea class=form-control ng-model=editComment.text></textarea><button style=margin-top:5px class="btn btn-primary pull-right" ng-click=cancelEditComment();$event.stopPropagation()>Cancel</button> <button style=margin-top:5px class="btn btn-primary pull-right" ng-enable="media.text && media.text!=\'\'" ng-click=updateComment(media)>Update</button> <a class=pull-right href ng-click="editComment.isPrivate = !editComment.isPrivate;$event.stopPropagation()" ng-show="editComment.text!=&quot;&quot;"><span ng-if=!editComment.isPrivate class="glyphicon glyphicon-eye-open" style=color:#428bca uib-tooltip="Visible to All" tooltip-append-to-body=true tooltip-placement=bottom></span> <span ng-if=editComment.isPrivate class="glyphicon glyphicon-eye-close" style=color:#428bca uib-tooltip="Only Visible to Me" tooltip-append-to-body=true tooltip-placement=bottom></span></a></div></div><!--    <hr ng-if="media.remarks && media.remarks.length>0" style="background:lightgray;opacity:0.3; border:0; height:1px" /> --><ul ng-if="media.remarks && media.remarks.length>0" class="media-list media-list-stream"><li class=media ng-repeat="remark in media.remarks"><div ng-if=includeHeading class=media-left style=padding-left:20px></div><div class=media-body style=clear:right><div class=media-heading href=#><img class="avatar-list-item img-circle" src=../../../../assets/images/d8794517.avatar_placeholder.png> <strong>{{remark.user.name}}</strong><span ng-if=remark.date>- {{remark.date | date}}</span></div><div class=more-text content=remark.remark style=margin:0></div></div></li></ul></div><div ng-if=remarkSent uib-alert close=acknowledge() dismiss-on-timeout=2000><strong>Remark has been submitted for approval</strong></div><div ng-if=remarkForm.isShowing id=remarkForm{{comment._id}}><div class=form-group><textarea class=form-control placeholder="Add remark here." ng-model=remarkForm.content></textarea><button style=margin-top:5px class="btn btn-primary pull-right" ng-disabled="!remarkForm.content || remarkForm.content===\'\'" ng-click=toggleRemarkForm()>Cancel</button> <button style=margin-top:5px class="btn btn-primary pull-right" ng-disabled="!remarkForm.content || remarkForm.content===\'\'" ng-click=addRemark()>Post</button></div></div>'),a.put("app/reading/scripture/media/media.html",'<div class=annotation><div><form name=urlForm role=form><div class=input-group><input id=inputUrl class=form-control placeholder="Add a video link here or select image file." ng-model=inputUrl><div class=input-group-btn uib-dropdown><button id=action type=button data-toggle=dropdown data-target=# class="btn btn-primary" ng-click=$event.stopPropagation();toggleMenu()>Action<span class=caret></span></button><ul class=dropdown-menu uib-dropdown-menu role=menu aria-labelledby=action><li role=menuitem><button class="btn btn-link" ng-disabled=!inputUrl ng-click=addUrl()>Add video</button></li><li role=menuitem><span class="btn btn-link btn-file">Select Image...<input type=file id=files name=files[]></span></li></ul></div></div></form><div ng-show="inputUrl && !validateUrl(inputUrl)" class="alert alert-danger" role=alert><strong>Error!</strong>"{{inputUrl}}" Not valid url!</div><div ng-show=errorOnSave class="alert alert-danger" role=alert><a ng-click="errorOnSave=false;$event.stopPropagation()" class=close data-dismiss=alert aria-label=close>&times;</a> <strong>Error!</strong>File could not be saved!</div><div id=drop_zone><img id=plus src="../../../../assets/images/ad55ea0c.media_download.png"><br>Drop videos or images here</div></div><ul class="list-group media-list media-list-stream"><li class="media list-group-item p-a" ng-repeat="m in media"><ew-media-item media=m user=currentUser with-heading following=following></ew-media-item><!--               <a class="media-left" href="#" ng-if=\'isAnnotation\'>\n              	<img class="avatar-list-item img-circle" src="../../assets/images/d8794517.avatar_placeholder.png">\n              </a>\n              <div class="media-body">\n              	<div class="media-heading" ng-if=\'isAnnotation\'>\n					<a href="#" class="pull-right">\n					  <span class="glyphicon glyphicon-flag" aria-hidden="true">Flag</span>\n					</a>              	\n					<h5><a href="#" >{{m.user.name}}</a> - {{m.date|date}}</h5>\n				</div>\n				<div class="more-text" content="m.description"></div>\n				<div class="thumbnail" ng-if="m.image" >\n					<img class="img-responsive" src="{{m.url}}" title="escape({{m.name}})"/>\n				</div>	\n				<div class="embed-responsive embed-responsive-16by9" ng-if="m.type===\'video\'">\n					<embed-video ng-href="{{m.url}}" controls=0 >Watch</embed-video>\n				</div>	\n			  </div>		\n --></li></ul><!-- 	<div class="row" ng-repeat=\'video in videos\'> --><!-- 		<div class=\'col-md-2\'></div> --><!-- 		<div class=\'col-md-8 nopadding\'> --><!-- 			<div class="text-primary">{{video.description}}</div> --><!-- 			<div class="embed-responsive embed-responsive-16by9"> --><!-- 				<embed-video ng-href="{{video.url}}" controls=0 >Watch</embed-video> --><!-- 			</div>	 --><!-- 		    <div style="padding-top:20px"></div> --><!-- 		</div>		 --><!-- 		<div class=\'col-md-2 nopadding\'> --><!-- 			<a href="#"> --><!-- 			  <span class="glyphicon glyphicon-flag" aria-hidden="true">Flag</span> --><!-- 			</a> --><!-- 		</div> --><!-- 	</div> --></div><script type=text/ng-template id=commentTemplate.html><div class="modal-header">\n    	<h4 class="modal-title">Enter comment or Description</h4>\n	</div>\n	<div class="modal-body">\n	   <textarea class="form-control" placeholder="Add comment here." ng-model="description"></textarea><br/>\n	</div>\n	<div class="modal-footer">\n    	<button class="btn btn-primary" type="button" ng-click="ok()">OK</button>\n    	<button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button>\n	</div></script>'),a.put("app/reading/scripture/partials/comment.html",'<div class=annotation id=comment-tab><!--   	<button class="btn btn-primary" type="button" ng-click="showGroups($event)">Show Groups</button> --><span><ew-comment-form user=model.currentUser show-group-menu=showGroups new-comment=model.newComment add-comment=addComment></ew-comment-form></span><ul class="list-group media-list media-list-stream"><li class="media list-group-item media-current-user" ng-repeat="comment in model.comments | orderBy: \'-date\'" ng-if=isViewable(comment)><!--           {{comment.text}}    --><!--           {{comment.user.name}} --><div ew-comment with-heading comment=comment following=following||[] user=model.currentUser update-callback=updateAnnotation delete-callback=deleteAnnotation></div><br></li></ul><div id=group-menu class="panel panel-default sidenav"><div class=panel-heading><strong>Groups</strong><a href="" class=close ng-click=hideGroups() aria-label=close>&times;</a></div><ul class=list-group><li class=list-group-item ng-repeat="g in groups"><span ng-show="model.selectedGroup && model.selectedGroup.name === g.name" class=badge style=background-color:#428bca><span class="glyphicon glyphicon-ok"></span></span> <a href="" ng-click="model.selectedGroup = g">{{g.name}}</a></li></ul><div class=panel-footer><button class="btn btn-primary btn-block" type=button ng-click=hideGroups(model.selectedGroup)>Done</button></div></div><script type=text/ng-template id=visibiltyPopoverTemplate.html><div class="form-group">\n          <ul  class="list-unstyled">\n            <li><a href="#" ng-click=\'toggleCommentVisiblity();  visibiltyPopover.isOpen = false\'>{{model.nextVisibility}}</a></li>            \n		  </ul>\n        </div></script></div>'),a.put("app/reading/scripture/partials/footnotes.html",'<div id=footnotes class=annotation><table class=table style=background:white;width:100% ng-repeat="fn in model.footnotes track by $index"><thead><tr><th>Word</th><th>Strong\'s Number</th><th>Original</th><th>Root</th><th>Definition</th><th>Transliteration</th></tr></thead><tbody><tr ng-repeat="note in fn.notes"><td><span class=text-primary>{{note.word}}</span></td><!--         <td> --><!-- table  class="table-condensed"--><!-- 	        	<tr>\n			        <th>Strong\'s Number</th>\n			        <th>Original</th>\n			        <th>Root</th>\n			        <th>Definition</th>\n			        <th>Transliteration</th>\n			   </tr>\n --><!-- tr ng-repeat="note in notes"--><td>{{note.strongs_num}}</td><td>{{note.original}}</td><td>{{note.lemma}}</td><td>{{note.strongs_def}}</td><td>{{note.transliteration}}</td><!-- /tr--><!--         	</table>\n       	</td>\n --></tr></tbody></table></div>'),a.put("app/reading/scripture/partials/media.html",'<ew-media media=model.media save=addMedia current-user=model.currentUser></ew-media><!-- <ew-media videos="model.media" save="addMedia"></ew-media> -->'),a.put("app/reading/scripture/partials/references.html",'<div class=annotation><form role=form><div class=form-group><input class=form-control placeholder="Add a reference link here." ng-model=model.referenceLink><br><textarea class=form-control placeholder="Describe reference link here." rows=4 ng-model=model.referenceDescription></textarea><br><button class="btn btn-primary" ng-disabled="!model.referenceLink || model.referenceLink===\'\'" ng-click=addReference()>Add</button> <button class="btn btn-primary" ng-disabled="!model.referenceLink || model.referenceLink===\'\'" ng-click="model.referenceLink=\'\';model.referenceDescription=\'\'">Cancel</button></div></form><ul class="list-group media-list media-list-stream" ng-repeat="reference in model.references track by $index"><li class="media list-group-item p-a"><ew-reference with-heading reference=reference user=model.currentUser following=following||[]></ew-reference></li></ul></div>'),a.put("app/reading/scripture/references/reference.html",'<div ng-if=includeHeading class=media-heading href=#><img class="avatar-list-item img-circle" src=../../../../assets/images/d8794517.avatar_placeholder.png> <span class=text-primary>{{reference.user.name}}</span>&nbsp;&nbsp; <span class=text-muted>{{reference.date|date}}</span></div><div class=media-body><div ng-if=!isEditing><div class=more-text content=reference.description style=margin:0></div><div class=reference-link><a href={{reference.url}} target=_blank>{{reference.url}}</a></div><span class=comment-buttons><a ng-if=!isEditing href="" uib-tooltip=Edit tooltip-append-to-body=true tooltip-placement=bottom ng-hide="reference.user._id!==user._id" ng-click=toggleEditReference();$event.stopPropagation()><span class="fa fa-pencil" style=color:#428bca></span>&nbsp;</a> <a ng-if=!isEditing href="" uib-tooltip=Delete tooltip-append-to-body=true tooltip-placement=bottom ng-hide="reference.user._id!==user._id" ng-click=deleteReference(reference);$event.stopPropagation()><span class="fa fa-close" style=color:#428bca></span>&nbsp;</a> <a ng-hide="user.role===\'guest\'" ng-if="reference.user._id!==user._id && !isFollowing(reference.user)" href="" uib-tooltip=Follow tooltip-append-to-body=true tooltip-placement=bottom ng-click=follow(reference.user);$event.stopPropagation()><span class="fa fa-user" style=color:#428bca></span>&nbsp;</a> <a href="" uib-tooltip=Remark tooltip-append-to-body=true tooltip-placement=bottom ng-click=toggleRemarkForm();$event.stopPropagation()><span class="fa fa-comment" style=color:#428bca></span>&nbsp;</a> <a ng-if="user.likes.indexOf(reference._id)===-1" href uib-tooltip=Like tooltip-append-to-body=true tooltip-placement=bottom ng-click=like();$event.stopPropagation()><span><span class="fa fa-thumbs-o-up" style=color:#428bca></span> <span ng-if="reference.likes>0" class=notification_count>{{reference.likes}}</span></span></a></span> <span ng-if="user.likes.indexOf(reference._id)!==-1" style=color:#428bca;font-weight:500;font-size:11px><span ng-show="reference.likes>0"><div class=badge>{{reference.likes}}</div>&nbsp;Likes</span></span></div><div ng-if=isEditing><div class=form-group><input class=form-control placeholder="Add a reference link here." ng-model=editReference.link><br><textarea class=form-control placeholder="Describe reference link here." rows=4 ng-model=editReference.text></textarea><br><button style=margin-top:5px class="btn btn-primary pull-right" ng-click=cancelEditReference();$event.stopPropagation()>Cancel</button> <button style=margin-top:5px class="btn btn-primary pull-right" ng-enable="editReference.text && editReference.text!=\'\'" ng-click=updateReference(reference)>Update</button> <a class=pull-right href ng-click="editReference.isPrivate = !editReference.isPrivate;$event.stopPropagation()" ng-show="editReference.text!=&quot;&quot;"><span ng-if=!editReference.isPrivate class="glyphicon glyphicon-eye-open" style=color:#428bca uib-tooltip="Visible to All" tooltip-append-to-body=true tooltip-placement=bottom></span> <span ng-if=editReference.isPrivate class="glyphicon glyphicon-eye-close" style=color:#428bca uib-tooltip="Only Visible to Me" tooltip-append-to-body=true tooltip-placement=bottom></span></a></div></div><!--    <hr ng-if="reference.remarks && reference.remarks.length>0" style="background:lightgray;opacity:0.3; border:0; height:1px" /> --><ul ng-if="reference.remarks && reference.remarks.length>0" class="media-list media-list-stream"><li class=media ng-repeat="remark in reference.remarks"><div ng-if=includeHeading class=media-left style=padding-left:20px></div><div class=media-body style=clear:right><div class=media-heading href=#><img class="avatar-list-item img-circle" src=../../../../assets/images/d8794517.avatar_placeholder.png> <strong>{{remark.user.name}}</strong><span ng-if=remark.date>- {{remark.date | date}}</span></div><div class=more-text content=remark.remark style=margin:0></div></div></li></ul></div><div ng-if=remarkSent uib-alert close=acknowledge() dismiss-on-timeout=2000><strong>Remark has been submitted for approval</strong></div><div ng-if=remarkForm.isShowing id=remarkForm{{reference._id}}><div class=form-group><textarea class=form-control placeholder="Add remark here." ng-model=remarkForm.content></textarea><button style=margin-top:5px class="btn btn-primary pull-right" ng-disabled="!remarkForm.content || remarkForm.content===\'\'" ng-click=toggleRemarkForm()>Cancel</button> <button style=margin-top:5px class="btn btn-primary pull-right" ng-disabled="!remarkForm.content || remarkForm.content===\'\'" ng-click=addRemark()>Post</button></div></div>'),a.put("app/reading/scripture/scripture.html",'<div id=page class="container p-t-md"><div class=row><div class="col-sm-2 navigation"><h4 class="text-primary hidden-xs" style=font-weight:400>Translation</h4><div class=row><div class="panel-heading hidden-xs"><h5><a class=version href ng-click=getVersion(&quot;KJV&quot;)>King James Version</a></h5><h5><a class=version href ng-click=getVersion(&quot;ASV&quot;)>American Standard Version</a></h5><!-- h5 class="text-uppercase"><a href=\'\' ng-click=\'getVersion("NET")\' style=\'text-decoration:none;\'>NET</a></h5--></div><div class="btn-group visible-xs" role=group aria-label=Navigate><button type=button class="btn btn-default text-uppercase" ng-click=getVersion(&quot;KJV&quot;)>KJV</button> <button type=button class="btn btn-default text-uppercase" ng-click=getVersion(&quot;KJV&quot;)>ASV</button><!-- 			  <button type="button" class="btn btn-default">NET</button> --></div></div></div><div class="col-sm-8 verses st-content"><a ng-if="prevChapter!==undefined" href="" ng-click=getChapter(prevChapter) class="pull-left prev-chapter"><span class="fa fa-chevron-circle-left" style=color:#428bca uib-tooltip="{{prevChapter.book}} {{prevChapter.chapter}}" tooltip-append-to-body=true tooltip-placement=left></span></a> <a ng-if="nextChapter!==undefined" href="" ng-click=getChapter(nextChapter) class="pull-right next-chapter"><span class="fa fa-chevron-circle-right" style=color:#428bca uib-tooltip="{{nextChapter.book}} {{nextChapter.chapter}}" tooltip-append-to-body=true tooltip-placement=right></span></a><div id=passage><h1>{{book}} {{chapter}}</h1><hr><div ng-show=!loading id=verselist class=list-unstyled><div ng-repeat="verse in verses" style=margin-bottom:8px><span uib-dropdown auto-close=disabled><a class=verse href="" id=verse{{verse.verse}} ng-class="{\'highlight\': verse.verse === highlightedVerse}" ng-click=showAnnotations(verse,$event);scrollToVerse(verse) uib-dropdown-toggle><span ng-hide=!verse.annoCount class="badge pull-right" style=background:#4eb76e;margin-right:-40px>{{verse.annoCount}}</span> {{verse.verse}} - {{verse.text}}</a><ul class=dropdown-menu uib-dropdown-menu template-url=tabs.html aria-labelledby=verseSpan{{verse.verse}}></ul></span></div></div></div></div></div><script type=text/ng-template id=tabs.html><li role="menuitem">\n		  <uib-tabset>\n		    <uib-tab ng-repeat="tab in tabs" active="tab.active" ng-click="tabChanged()">\n				<uib-tab-heading>\n					<span>\n					<span ng-show="tabs[$index].annoCount>0" class="annotation_count">{{tabs[$index].annoCount}}</span>\n						<img class="tab-image" uib-tooltip="{{tab.title}}" tooltip-append-to-body=\'true\' tooltip-placement=\'right\' src=\'{{tab.image}}\' >\n					</span>\n      			</uib-tab-heading>\n		      	<div ng-include="tab.content" ng-click="$event.stopPropagation()"></div>\n		    </uib-tab>\n		  </uib-tabset>\n		  </li></script><script>function myCallback(data){\n			 var scope = $(\'#verselist\').scope();\n			 scope.showData(data);\n		}</script></div>'),a.put("app/tags/tags.html",'<div class=modal-header><div class=col-xs-8><div class=row><h3 class=modal-title>Available Tags</h3></div><div class=row><form class=form-horizontal role=form><div class=form-group><label class="control-label col-sm-2" for=tagName>Search:</label><div class=col-sm-10><input id=query placeholder="Enter search text" ng-model=query onfocus="pxtrack.emit(\'counter\', \'1\')"></div></div></form></div></div></div><div class=modal-body><ul class=list-unstyled><li ng-repeat="tag in tags | filter:query track by $index"><div class=row><div class=col-xs-6>{{ tag.tag }}</div><div class=col-xs-2><a href=# class=pull-right ng-click=addTag(tag) ng-if="selected[tag._id]===undefined"><!-- 	   	 				<span class="badge" style="background-color:#428bca"> --><span class="glyphicon glyphicon-unchecked"></span><!-- 	   	 				</span> --></a> <a href=# class=pull-right ng-click=removeTag(tag) ng-if="selected[tag._id]!==undefined"><!-- 	   	 				<span class="badge" style="background-color:#428bca"> --><span class="glyphicon glyphicon-check"></span><!-- 	   	 				</span> --></a></div><!--         		<div class="col-xs-2"><button class="btn btn-primary"  ng-click="addTag(tag)">Add</button></div> --></div></li></ul></div><div class=modal-footer><button class="btn btn-primary" type=button ng-click=ok()>OK</button> <button class="btn btn-warning" type=button ng-click=cancel()>Cancel</button></div>'),a.put("app/testaments/testaments.html",'<script>document.body.style.backgroundColor = "#f2f3f7";</script><div class="col-sm-12 p-t-md outer" style=background:#f2f3f7><div class=row><div class="col-sm-6 image-box"><a ui-sref=ot><!--             <div class="ot-image-inside"></div> --><img src=../../assets/images/6934c367.OldTestament_new.jpg class=img-responsive alt="Old Testament"></a></div><div class="col-sm-6 image-box"><a ui-sref=nt><!--             <div class="nt-image-inside"></div> --><img src=../../assets/images/abe5b438.NewTestament_new.jpg class=img-responsive alt="New Testament"></a></div></div></div>'),a.put("components/modal/modal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class=modal-body><p ng-if=modal.text ng-bind=modal.text></p><div ng-if=modal.html ng-bind-html=modal.html></div></div><div class=modal-footer><button ng-repeat="button in modal.buttons" ng-class=button.classes ng-click=button.click($event) ng-bind=button.text class=btn></button></div>'),a.put("components/navbar/navbar.html",'<div ng-controller=NavbarCtrl><div ng-if="isLoggedIn() && !isGuest() && newMessages" class="growl growl-static" style=margin-top:25px;margin-left:auto><div class="alert alert-info alert-dismissable" role=alert><button type=button class=close data-dismiss=alert aria-label=Close><span aria-hidden=true>&times;</span></button> <strong>You have new messages!</strong></div></div><nav class="navbar navbar-inverse navbar-fixed-top" style=margin-bottom:10px><div class=container><div class=navbar-header><button ng-if="isLoggedIn() && !isGuest()" class=navbar-toggle type=button ng-click=toggleMenu()><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a href="/" class=navbar-brand><img src=../../../assets/images/7a157034.everyword-logomark.svg onerror="this.src=\'../../../assets/images/006cd9ba.everyword-logomark.png\'" alt=""></a><div class="button-group visible-xs pull-right" style=font-size:22px><button ng-if="isLoggedIn() && !isGuest()" type=button class="btn btn-link" ng-click="navigate(\'groups\');collapseMenu()"><span class="fa fa-users"></span></button> <button ng-if="isLoggedIn() && !isGuest()" type=button class="btn btn-link" ng-click="navigate(\'following\');collapseMenu()"><span class="icon icon-users"></span></button> <button ng-if="isLoggedIn() && !isGuest()" type=button class="btn btn-link" ng-click="navigate(\'messages\');collapseMenu()"><span class="fa fa-envelope"></span><div ng-show=messageCount class=message_count>{{messageCount}}</div></button> <button ng-if="!isLoggedIn() || isGuest()" type=button class="btn btn-link m-r" ng-click="login();isCollapsed=true">Login</button> <button ng-if="!isLoggedIn() || isGuest()" type=button class="btn btn-link m-r" ng-click="signup();isCollapsed=true">Sign up</button></div></div><div uib-collapse=isCollapsed class="navbar-collapse uib-collapse" id=navbar-main><ul class="nav navbar-nav"><li ng-repeat="item in menu" ng-class="{active: isActive(item.link), \'hidden-xs\': item.title !== \'Home\'}" ng-if="isLoggedIn() && !isGuest()"><a ng-href={{item.link}} ng-click=collapseMenu()>{{item.title}}</a></li><li ng-show=isAdmin() ng-class="{active: isActive(\'/admin\')}"><a href=/admin>Admin</a></li></ul><ul class="nav navbar-nav navbar-right m-r-0"><li ng-hide="isLoggedIn() && !isGuest()" ng-class="{active: isActive(\'/signup\')}"><a href=javascript:void(0) ng-click="signup();isCollapsed = true">Sign up</a></li><li ng-hide="isLoggedIn() && !isGuest()" ng-class="{active: isActive(\'/login\')}"><a href=javascript:void(0) ng-click="login();isCollapsed = true">Login</a></li><li ng-show="isLoggedIn() && !isGuest()"><p class=navbar-text>Hello {{ getCurrentUser().name }}</p></li><li ng-show="isLoggedIn() && !isGuest()" class="hidden-xs hidden-sm"><a ui-sref=messages ng-click="isCollapsed = true"><span class="fa fa-envelope"></span></a><div ng-show=messageCount class=message_count>{{messageCount}}</div></li><li ng-show="isLoggedIn() && !isGuest()" ng-class="{active: isActive(\'/settings\')}"><a href=/settings ng-click="isCollapsed = true"><span class="fa fa-cog hidden-xs hidden-sm"></span> <span class="visible-xs visible-sm">Settings</span></a></li><li ng-show="isLoggedIn() && !isGuest()" ng-class="{active: isActive(\'/logout\')}"><a href="" ng-click="logout();isCollapsed = true">Logout</a></li></ul></div></div></nav><div class=container><div ncy-breadcrumb ng-hide=!isCollapsed style=background-color:#b6e1fc></div></div></div>'),
a.put("components/progressbar/progressbar.html",'<div class=modal-header><h1>Loading...</h1></div><div class=modal-body><div class=progress><div class="progress-bar progress-bar-striped active" role=progressbar aria-valuenow=100 style=width:100%></div></div></div>')}]);