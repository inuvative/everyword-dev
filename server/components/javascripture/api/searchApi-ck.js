/*global console, javascripture*/javascripture.api.search={language:{kjv:javascripture.data.kjv,web:javascripture.data.web,greek:javascripture.data.greek,hebrew:javascripture.data.hebrew},books:{kjv:["Genesis","Exodus","Leviticus","Numbers","Deuteronomy","Joshua","Judges","Ruth","1 Samuel","2 Samuel","1 Kings","2 Kings","1 Chronicles","2 Chronicles","Ezra","Nehemiah","Esther","Job","Psalm","Proverbs","Ecclesiastes","Song of Songs","Isaiah","Jeremiah","Lamentations","Ezekiel","Daniel","Hosea","Joel","Amos","Obadiah","Jonah","Micah","Nahum","Habakkuk","Zephaniah","Haggai","Zechariah","Malachi","Matthew","Mark","Luke","John","Acts","Romans","1 Corinthians","2 Corinthians","Galatians","Ephesians","Philippians","Colossians","1 Thessalonians","2 Thessalonians","1 Timothy","2 Timothy","Titus","Philemon","Hebrews","James","1 Peter","2 Peter","1 John","2 John","3 John","Jude","Revelation"],web:["Genesis","Exodus","Leviticus","Numbers","Deuteronomy","Joshua","Judges","Ruth","1 Samuel","2 Samuel","1 Kings","2 Kings","1 Chronicles","2 Chronicles","Ezra","Nehemiah","Esther","Job","Psalm","Proverbs","Ecclesiastes","Song of Songs","Isaiah","Jeremiah","Lamentations","Ezekiel","Daniel","Hosea","Joel","Amos","Obadiah","Jonah","Micah","Nahum","Habakkuk","Zephaniah","Haggai","Zechariah","Malachi","Matthew","Mark","Luke","John","Acts","Romans","1 Corinthians","2 Corinthians","Galatians","Ephesians","Philippians","Colossians","1 Thessalonians","2 Thessalonians","1 Timothy","2 Timothy","Titus","Philemon","Hebrews","James","1 Peter","2 Peter","1 John","2 John","3 John","Jude","Revelation"],hebrew:["Genesis","Exodus","Leviticus","Numbers","Deuteronomy","Joshua","Judges","Ruth","1 Samuel","2 Samuel","1 Kings","2 Kings","1 Chronicles","2 Chronicles","Ezra","Nehemiah","Esther","Job","Psalm","Proverbs","Ecclesiastes","Song of Songs","Isaiah","Jeremiah","Lamentations","Ezekiel","Daniel","Hosea","Joel","Amos","Obadiah","Jonah","Micah","Nahum","Habakkuk","Zephaniah","Haggai","Zechariah","Malachi"],greek:["Matthew","Mark","Luke","John","Acts","Romans","1 Corinthians","2 Corinthians","Galatians","Ephesians","Philippians","Colossians","1 Thessalonians","2 Thessalonians","1 Timothy","2 Timothy","Titus","Philemon","Hebrews","James","1 Peter","2 Peter","1 John","2 John","3 John","Jude","Revelation"]},types:["word","lemma","morph"],results:{references:[],matches:{}},getReferences:function(e){var t=this;t.parameters=e;this.lookForTerm();return t.results.references},doesDataMatchTerm:function(e,t,n){var r=this;t=t.toLowerCase();n=n.toLowerCase();return t===n?!0:e!=="lemma"&&!r.parameters.strict&&t.search(n)>-1?!0:!1},resetMatches:function(){this.results.matches={}},addReference:function(e,t,n){this.results.references.push({book:e,chapter:t+1,verse:n+1})},lookForTerm:function(){var e=this,t=e.parameters;"undefined"==typeof t.language&&(t.language=e.inferLanguage(t));var n=this.language[t.language];e.results.references=[];e.resetMatches();var r=this.books[t.language];r.forEach(function(t,i){e.searchInABook(n,t,i,r)})},searchInABook:function(e,t,n,r){var i=this,s=i.parameters,o=e[t],u=0;for(var a in i.types){var f=i.types[a],l=s[f];if(l!==undefined&&l!==""){var c=l.split(" ");u+=c.length}}o.forEach(function(e,n){s.range==="chapter"&&s.clusivity==="exclusive"&&i.resetMatches();e.forEach(function(e,r){s.range==="verse"&&s.clusivity==="exclusive"&&i.resetMatches();e.forEach(function(e){s.range==="word"&&s.clusivity==="exclusive"&&i.resetMatches();var o,a;i.types.forEach(function(o,u){a=s[o];if(i.areTheTermStringAndWordObjectAreGoodToSearch(a,e,u)){var f=a.split(" "),l=e[u].split(" ");l.forEach(function(e){f.forEach(function(u){i.doesDataMatchTerm(o,e,u)&&(s.clusivity==="exclusive"?i.results.matches[u]=!0:i.addReference(t,n,r))})})}});if(s.clusivity==="exclusive"){o=0;o=Object.keys(i.results.matches).length;if(o>0&&o>=u){i.addReference(t,n,r);i.resetMatches()}}})})});n===r.length-1},standarizeWordEndings:function(e){return e.replace(/ם/gi,"מ")},inferLanguage:function(e){var t="kjv";e.lemma.substr(0,1)==="H"&&(t="hebrew");e.lemma.substr(0,1)==="G"&&(t="greek");return t},areTheTermStringAndWordObjectAreGoodToSearch:function(e,t,n){return e!==undefined&&e!==""&&t!==undefined&&typeof t[n]!="undefined"},countResults:function(){return this.results.references.length}};